import{r as e,j as t,P as r}from"./vendor-react-DYPeng9G.js";import{f as n,B as s,s as i,t as a}from"./index-0LlzAmpO.js";import{i as l,h as o}from"./permissionsUtils-VRGcIqVs.js";import{m as d,X as c,n as p,u as m,F as x,a5 as b,q as u,a8 as h,i as g,l as j,j as f,b as y,I as v,d as N}from"./vendor-ui-DYDeDtSQ.js";import"./vendor-supabase-DEEIiAjM.js";function w(e){if(0===e)return"z√©ro";const t=["","un","deux","trois","quatre","cinq","six","sept","huit","neuf"],r=["dix","onze","douze","treize","quatorze","quinze","seize","dix-sept","dix-huit","dix-neuf"],n=["","dix","vingt","trente","quarante","cinquante","soixante","soixante-dix","quatre-vingt","quatre-vingt-dix"];function s(e){if(e<10)return t[e];if(e<20)return r[e-10];if(e<70||e>79&&e<90){const r=Math.floor(e/10),s=e%10;return 1===s&&8!==r?`${n[r]}-et-un`:`${n[r]}${s>0?"-"+t[s]:""}`}if(e<80)return`${n[6]}-${r[e-70]}`;if(e<100)return`${n[8]}-${r[e-90]}`;if(e<200)return"cent"+(e>100?" "+s(e%100):"");if(e<1e3){const r=Math.floor(e/100),n=e%100;return`${t[r]} cent${n>0?" "+s(n):r>1?"s":""}`}return""}function i(e,t,r){if(0===e)return"";let n="";return e>1?(n=s(e)+" "+t,r&&(n+="s")):n=("mille"===t?"":"un ")+t,n}let a=[];const l=Math.floor(e/1e9),o=Math.floor(e%1e9/1e6),d=Math.floor(e%1e6/1e3),c=e%1e3;l>0&&a.push(i(l,"milliard",l>1)),o>0&&a.push(i(o,"million",o>1)),d>0&&(1===d?a.push("mille"):a.push(s(d).replace(/un$/,"")+" mille")),c>0&&a.push(s(c));let p=a.join(" ").trim();return p=p.replace(/quatre-vingt un/g,"quatre-vingt-un"),p=p.replace(/cent s/g,"cents"),p=p.replace(/vingt un/g,"vingt-et-un"),p}const C=e=>{if(""===e||null==e)return"";const t=Number(e);return isNaN(t)?"0":new Intl.NumberFormat("fr-FR").format(t)},F=e=>{if("string"!=typeof e)return 0;const t=Number(e.replace(/\s/g,"").replace(/[^0-9]/g,""));return isNaN(t)?0:t},A=({invoice:r,onSubmit:a,onCancel:u,onPrint:h,currentUser:g})=>{const{companyInfo:j}=n(),f=l(g),y=g?.permissions||{},v=f||o(y,"billing","edit")||"Avocat"===g?.function||"avocat"===g?.role||"Secretaire"===g?.function||"secretaire"===g?.role;f||o(y,"billing","create");const[N,A]=e.useState([]),[k,T]=e.useState(!1),[D,S]=e.useState({clientName:"",caseId:"",caseTitle:"",invoice_type:"definitive",debours:{entrevue:0,dossier:0,plaidoirie:0,huissier:0,deplacement:0},honoraires:{forfait:0,tauxHoraire:0,base:0,resultat:0},payment:{method:"virement",provision:!1,provisionAmount:0}});e.useEffect(()=>{(async()=>{T(!0);try{const{data:e,error:t}=await i.from("cases").select("id, title").order("created_at",{ascending:!1});t||A(e||[])}catch(e){}finally{T(!1)}})()},[]),e.useEffect(()=>{r&&S(r)},[r]);const I=(e,t,r)=>{const n=F(r);S(r=>({...r,[e]:{...r[e],[t]:n}}))},E=e=>{const{name:t,value:r,type:n}=e.target,s="provision"===t;S(e=>{let n={...e.payment};return s?n.provision="true"===r:n[t]="provisionAmount"===t?F(r):r,{...e,payment:n}})},{totalDebours:R,totalHonoraires:z,totalHT:_,tva:M,totalTTC:O,resteAPayer:P}=e.useMemo(()=>{const e=Object.values(D.debours).reduce((e,t)=>e+(Number(t)||0),0),t=Object.values(D.honoraires).reduce((e,t)=>e+(Number(t)||0),0),r=e+t,n=.18*r,s=r+n;return{totalDebours:e,totalHonoraires:t,totalHT:r,tva:n,totalTTC:s,resteAPayer:D.payment.provision?s-(Number(D.payment.provisionAmount)||0):s}},[D.debours,D.honoraires,D.payment.provision,D.payment.provisionAmount]),L=(e,r,n,s)=>t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("label",{className:"text-slate-300 flex items-center print:text-black",children:[t.jsx("input",{type:"checkbox",className:"mr-3 h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 print:hidden"}),e]}),t.jsxs("div",{className:"relative w-48",children:[t.jsx("input",{type:"text",name:r,value:C(n),onChange:s,disabled:!v,className:"w-full pl-3 pr-14 py-2 border rounded-lg text-right placeholder-slate-400 focus:outline-none print:bg-white print:text-black print:border-gray-300 "+(v?"bg-slate-700/50 border-slate-600 text-white focus:ring-2 focus:ring-indigo-500":"bg-slate-600/50 border-slate-500 text-slate-300 cursor-not-allowed"),placeholder:"0"}),t.jsx("span",{className:"absolute inset-y-0 right-3 flex items-center text-slate-400 text-sm print:text-gray-500",children:"F CFA"})]})]});return t.jsx(d.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50 print:hidden",children:t.jsxs(d.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-slate-800 border border-slate-700 rounded-xl p-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto print:bg-white print:border-none print:shadow-none print:max-h-full print:overflow-visible",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6 print:hidden",children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:"Honoraires et Conditions d'Intervention"}),t.jsx(s,{variant:"ghost",size:"icon",onClick:u,className:"text-slate-400 hover:text-white",children:t.jsx(c,{className:"w-5 h-5"})})]}),!v&&t.jsxs("div",{className:"mb-6 flex items-center gap-3 p-4 bg-yellow-500/20 border border-yellow-500/30 rounded-lg print:hidden",children:[t.jsx(p,{className:"w-5 h-5 text-yellow-400 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-yellow-300 font-medium",children:"Acc√®s en lecture seule"}),t.jsx("p",{className:"text-yellow-200/80 text-sm",children:"Vous pouvez consulter cette facture mais ne pouvez pas modifier les montants. Contactez un administrateur pour effectuer des modifications."})]})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault();const t={...D,totalTTC:Number.isNaN(O)?0:O};a(t)},className:"space-y-6",children:[t.jsx("div",{className:"border-b border-slate-700 pb-6 mb-6 print:border-gray-300",children:t.jsxs("div",{className:"flex items-start justify-between gap-6",children:[j?.logo_url&&t.jsx("div",{className:"flex-shrink-0",children:t.jsx("img",{src:j.logo_url,alt:j.name||"Logo",className:"h-20 w-auto object-contain",onError:e=>e.target.style.display="none"})}),t.jsxs("div",{className:"flex-grow text-right",children:[t.jsx("h1",{className:"text-2xl font-bold text-white mb-2 print:text-black",children:j?.name||"‚Äî"}),j?.slogan&&t.jsx("p",{className:"text-slate-400 text-sm italic mb-3 print:text-gray-600",children:j.slogan}),t.jsxs("div",{className:"space-y-1 text-sm text-slate-300 print:text-gray-700",children:[j?.address&&t.jsx("p",{children:j.address}),j?.phone&&t.jsxs("p",{children:["T√©l : ",j.phone]}),j?.email&&t.jsxs("p",{children:["Email : ",j.email]})]})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2 print:text-black",children:[t.jsx(m,{className:"w-4 h-4 inline mr-2"}),"Client"]}),t.jsx("input",{type:"text",name:"clientName",value:D.clientName,onChange:e=>S({...D,clientName:e.target.value}),disabled:!v,className:"w-full px-4 py-3 border rounded-lg print:bg-white print:text-black print:border-gray-300 "+(v?"bg-slate-700/50 border-slate-600 text-white":"bg-slate-600/50 border-slate-500 text-slate-300 cursor-not-allowed"),placeholder:"Nom du client"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2 print:text-black",children:[t.jsx(x,{className:"w-4 h-4 inline mr-2"}),"Dossier"]}),t.jsxs("select",{name:"caseId",value:D.caseId,onChange:e=>{const t=N.find(t=>t.id===e.target.value);S({...D,caseId:e.target.value,caseTitle:t?.title||""})},disabled:!v||k,className:"w-full px-4 py-3 border rounded-lg print:bg-white print:text-black print:border-gray-300 "+(v?"bg-slate-700/50 border-slate-600 text-white":"bg-slate-600/50 border-slate-500 text-slate-300 cursor-not-allowed"),children:[t.jsx("option",{value:"",disabled:!0,children:k?"Chargement...":0===N.length?"Aucun dossier disponible":"S√©lectionner un dossier"}),N.map(e=>t.jsx("option",{value:e.id,children:e.title},e.id))]})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2 print:text-black",children:[t.jsx(x,{className:"w-4 h-4 inline mr-2"}),"Type de facture *"]}),t.jsxs("select",{name:"invoice_type",value:D.invoice_type,onChange:e=>S({...D,invoice_type:e.target.value}),disabled:!v,required:!0,className:"w-full px-4 py-3 border rounded-lg print:bg-white print:text-black print:border-gray-300 "+(v?"bg-slate-700/50 border-slate-600 text-white":"bg-slate-600/50 border-slate-500 text-slate-300 cursor-not-allowed"),children:[t.jsx("option",{value:"proforma",children:"Facture Proforma"}),t.jsx("option",{value:"definitive",children:"Facture D√©finitive"})]}),t.jsx("p",{className:"text-xs text-slate-500 mt-1 print:text-gray-500",children:"proforma"===D.invoice_type?"üìÑ Facture provisoire √† titre indicatif":"‚úÖ Facture d√©finitive √† r√©gler"})]}),t.jsxs("div",{className:"space-y-4 p-4 border border-slate-700 rounded-lg print:border-gray-300",children:[t.jsx("h3",{className:"text-lg font-semibold text-indigo-400 print:text-indigo-600",children:"D√©bours"}),L("Frais d'entrevue","entrevue",D.debours.entrevue,e=>I("debours","entrevue",e.target.value)),L("Frais de dossier","dossier",D.debours.dossier,e=>I("debours","dossier",e.target.value)),L("Frais de timbre de plaidoirie","plaidoirie",D.debours.plaidoirie,e=>I("debours","plaidoirie",e.target.value)),L("Frais d'actes d'Huissier","huissier",D.debours.huissier,e=>I("debours","huissier",e.target.value)),L("Frais de d√©placement, de s√©jour et de vacation","deplacement",D.debours.deplacement,e=>I("debours","deplacement",e.target.value))]}),t.jsxs("div",{className:"space-y-4 p-4 border border-slate-700 rounded-lg print:border-gray-300",children:[t.jsx("h3",{className:"text-lg font-semibold text-purple-400 print:text-purple-600",children:"Honoraires"}),L("Forfait","forfait",D.honoraires.forfait,e=>I("honoraires","forfait",e.target.value)),L("Taux horaire","tauxHoraire",D.honoraires.tauxHoraire,e=>I("honoraires","tauxHoraire",e.target.value)),L("Honoraires de base","base",D.honoraires.base,e=>I("honoraires","base",e.target.value)),L("Honoraires de r√©sultat","resultat",D.honoraires.resultat,e=>I("honoraires","resultat",e.target.value))]}),t.jsxs("div",{className:"space-y-2 p-4 bg-slate-900/50 border border-slate-700 rounded-lg print:bg-gray-100 print:border-gray-300",children:[t.jsx("h3",{className:"text-lg font-semibold text-white mb-4 print:text-black",children:"Total"}),t.jsxs("div",{className:"flex justify-between text-slate-300 print:text-black",children:[t.jsx("p",{children:"Montant HT d√ª"}),t.jsxs("p",{children:[C(_)," F CFA"]})]}),t.jsxs("div",{className:"flex justify-between text-slate-300 print:text-black",children:[t.jsx("p",{children:"Montant TVA (18%)"}),t.jsxs("p",{children:[C(M)," F CFA"]})]}),t.jsx("div",{className:"border-t border-slate-600 my-2 print:border-gray-300"}),t.jsxs("div",{className:"flex justify-between text-white font-bold text-lg print:text-black",children:[t.jsx("p",{children:"Total TTC"}),t.jsxs("p",{children:[C(O)," F CFA"]})]}),t.jsxs("p",{className:"text-sm text-slate-400 italic capitalize print:text-gray-600",children:[w(O)," francs CFA"]})]}),t.jsxs("div",{className:"space-y-4 p-4 border border-slate-700 rounded-lg print:border-gray-300",children:[t.jsx("h3",{className:"text-lg font-semibold text-green-400 print:text-green-600",children:"Paiement"}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2 print:text-black",children:"Mode de paiement envisag√©"}),t.jsx("div",{className:"flex flex-wrap gap-4",children:["Virement","Ch√®que","Carte bancaire","Esp√®ces","Autre"].map(e=>t.jsxs("label",{className:"flex items-center print:text-black "+(v?"text-slate-300":"text-slate-400"),children:[t.jsx("input",{type:"radio",name:"method",value:e.toLowerCase().replace(" ",""),checked:D.payment.method===e.toLowerCase().replace(" ",""),onChange:E,disabled:!v,className:"mr-2 h-4 w-4 text-indigo-600 focus:ring-indigo-500 print:hidden disabled:opacity-50"}),e]},e))})]}),t.jsxs("div",{children:[t.jsx("div",{className:"block text-sm font-medium text-slate-300 mb-2 print:text-black",children:"D√©p√¥t de provision / Avance sur frais demand√©(e)"}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("label",{className:"flex items-center print:text-black "+(v?"text-slate-300":"text-slate-400"),children:[t.jsx("input",{type:"radio",name:"provision",value:"true",checked:!0===D.payment.provision,onChange:E,disabled:!v,className:"mr-2 h-4 w-4 text-indigo-600 focus:ring-indigo-500 print:hidden disabled:opacity-50"}),"Oui"]}),t.jsxs("label",{className:"flex items-center print:text-black "+(v?"text-slate-300":"text-slate-400"),children:[t.jsx("input",{type:"radio",name:"provision",value:"false",checked:!1===D.payment.provision,onChange:E,disabled:!v,className:"mr-2 h-4 w-4 text-indigo-600 focus:ring-indigo-500 print:hidden disabled:opacity-50"}),"Non"]}),D.payment.provision&&t.jsxs("div",{className:"relative flex-1",children:[t.jsx("input",{type:"text",name:"provisionAmount",value:C(D.payment.provisionAmount),onChange:E,disabled:!v,className:"w-full pl-3 pr-14 py-2 border rounded-lg text-right print:bg-white print:text-black print:border-gray-300 "+(v?"bg-slate-700/50 border-slate-600 text-white":"bg-slate-600/50 border-slate-500 text-slate-300 cursor-not-allowed"),placeholder:"Montant"}),t.jsx("span",{className:"absolute inset-y-0 right-3 flex items-center text-slate-400 text-sm print:text-gray-500",children:"F CFA"})]})]})]}),D.payment.provision&&t.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-700 print:border-gray-300",children:[t.jsxs("div",{className:"flex justify-between text-green-400 font-bold text-lg print:text-green-600",children:[t.jsx("p",{children:"Reste √† payer"}),t.jsxs("p",{children:[C(P)," F CFA"]})]}),t.jsxs("p",{className:"text-sm text-slate-400 italic capitalize print:text-gray-600",children:[w(P)," francs CFA"]})]})]}),t.jsx("div",{className:"mt-8 pt-6 border-t border-slate-700 print:border-gray-300",children:t.jsx("div",{className:"flex justify-end",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-sm font-medium text-slate-400 mb-4 print:text-gray-600",children:"Signature"}),j?.signature_url?t.jsx("img",{src:j.signature_url,alt:"Signature",className:"h-16 w-auto object-contain mx-auto mb-2",onError:e=>e.target.style.display="none"}):t.jsx("div",{className:"h-16 flex items-center justify-center",children:t.jsx("p",{className:"text-xs text-slate-500 italic print:text-gray-500",children:"Signature non fournie"})}),t.jsx("div",{className:"border-t border-slate-600 w-48 mx-auto mt-2 print:border-gray-400"}),t.jsx("p",{className:"text-xs text-slate-400 mt-2 print:text-gray-600",children:j?.name||"Cabinet"})]})})}),t.jsxs("div",{className:"flex gap-4 pt-6 print:hidden",children:[v?t.jsx(s,{type:"submit",className:"flex-1 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700",children:r?"Mettre √† jour":"Cr√©er la Facture"}):t.jsx(s,{type:"button",disabled:!0,className:"flex-1 bg-slate-600 text-slate-400 cursor-not-allowed",children:"Modification non autoris√©e"}),t.jsx(s,{type:"button",variant:"outline",onClick:u,className:"flex-1 border-slate-600 text-slate-300 hover:bg-slate-700",children:"Annuler"}),t.jsxs(s,{type:"button",variant:"outline",onClick:h,className:"border-blue-500 text-blue-400 hover:bg-blue-500/20",children:[t.jsx(b,{className:"w-4 h-4 mr-2"}),"Imprimer"]})]})]})]})})},k=e=>Number.isNaN(e)||null===e?"0":new Intl.NumberFormat("fr-FR").format(e),T=e=>{if(!e)return"Non d√©finie";return new Date(e).toLocaleDateString("fr-FR")},D=({invoices:e,onClose:r})=>{const n=e.length,i=e.reduce((e,t)=>e+(t.totalTTC||0),0),a=e.filter(e=>"r√©gl√©e totalement"===e.status).length,l=e.filter(e=>"r√©gl√©e partiellement"===e.status).length,o=e.filter(e=>"non r√©gl√©e"===e.status).length,d=e.reduce((e,t)=>t.payment?.provision&&t.payment?.provisionAmount?e+t.payment.provisionAmount:e,0);return t.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 print:bg-white print:relative print:inset-auto print:p-0",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-7xl max-h-[90vh] overflow-y-auto print:shadow-none print:rounded-none print:max-w-none print:max-h-none print:overflow-visible",children:[t.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 flex justify-between items-center print:hidden",children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Aper√ßu d'impression - Facturation"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(s,{onClick:()=>{globalThis.print()},className:"bg-blue-600 hover:bg-blue-700",children:"Imprimer"}),t.jsxs(s,{variant:"outline",onClick:r,children:[t.jsx(c,{className:"w-4 h-4 mr-2"}),"Fermer"]})]})]}),t.jsxs("div",{className:"p-8 print:p-[10mm]",children:[t.jsxs("div",{className:"text-center mb-4 print:mb-3 border-b-2 border-gray-300 pb-3 print:pb-2 print:break-inside-avoid",children:[t.jsx("h1",{className:"text-xl print:text-lg font-bold text-gray-900 mb-1",children:"CABINET D'AVOCATS"}),t.jsx("h2",{className:"text-lg print:text-base font-semibold text-gray-700 mb-2 print:mb-1",children:"RAPPORT DE FACTURATION"}),t.jsx("div",{className:"text-sm print:text-xs text-gray-600",children:t.jsxs("p",{children:["G√©n√©r√© le ",(new Date).toLocaleDateString("fr-FR")," √† ",(new Date).toLocaleTimeString("fr-FR")]})})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 print:gap-2 mb-4 print:mb-3 text-sm print:text-xs print:break-inside-avoid",children:[t.jsxs("div",{className:"bg-gray-50 p-3 print:p-2 rounded-lg border",children:[t.jsx("div",{className:"font-semibold text-gray-700",children:"Total Factures"}),t.jsx("div",{className:"text-xl print:text-lg font-bold text-gray-900",children:n})]}),t.jsxs("div",{className:"bg-gray-50 p-3 print:p-2 rounded-lg border",children:[t.jsx("div",{className:"font-semibold text-gray-700",children:"Montant Total"}),t.jsxs("div",{className:"text-base print:text-sm font-bold text-gray-900 whitespace-nowrap",children:[k(i)," F CFA"]})]}),t.jsxs("div",{className:"bg-gray-50 p-3 print:p-2 rounded-lg border",children:[t.jsx("div",{className:"font-semibold text-gray-700",children:"Montant Encaiss√©"}),t.jsxs("div",{className:"text-base print:text-sm font-bold text-green-600 whitespace-nowrap",children:[k(d)," F CFA"]})]}),t.jsxs("div",{className:"bg-gray-50 p-3 print:p-2 rounded-lg border",children:[t.jsx("div",{className:"font-semibold text-gray-700",children:"Reste √† Encaisser"}),t.jsxs("div",{className:"text-base print:text-sm font-bold text-red-600 whitespace-nowrap",children:[k(i-d)," F CFA"]})]})]}),t.jsxs("div",{className:"mb-3 print:mb-2 print:break-inside-avoid",children:[t.jsx("h3",{className:"font-semibold text-gray-800 mb-2 print:mb-1 text-sm print:text-xs",children:"R√©partition par Statut"}),t.jsxs("div",{className:"grid grid-cols-3 gap-3 print:gap-2 text-sm print:text-xs",children:[t.jsxs("div",{className:"flex items-center justify-between p-2 print:p-1 bg-green-50 rounded border",children:[t.jsx("span",{children:"R√©gl√©es totalement"}),t.jsx("span",{className:"font-bold text-green-700",children:a})]}),t.jsxs("div",{className:"flex items-center justify-between p-2 print:p-1 bg-yellow-50 rounded border",children:[t.jsx("span",{children:"R√©gl√©es partiellement"}),t.jsx("span",{className:"font-bold text-yellow-700",children:l})]}),t.jsxs("div",{className:"flex items-center justify-between p-2 print:p-1 bg-red-50 rounded border",children:[t.jsx("span",{children:"Non r√©gl√©es"}),t.jsx("span",{className:"font-bold text-red-700",children:o})]})]})]}),t.jsx("div",{className:"overflow-x-auto print:overflow-visible",children:t.jsxs("table",{className:"w-full border-collapse border border-gray-300 text-sm print:text-[7pt]",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gray-100",children:[t.jsx("th",{className:"border border-gray-300 px-2 print:px-1 py-2 print:py-1 text-left font-semibold text-gray-800",children:"N¬∞ Facture"}),t.jsx("th",{className:"border border-gray-300 px-2 print:px-1 py-2 print:py-1 text-left font-semibold text-gray-800",children:"Client"}),t.jsx("th",{className:"border border-gray-300 px-2 print:px-1 py-2 print:py-1 text-left font-semibold text-gray-800",children:"Date"}),t.jsx("th",{className:"border border-gray-300 px-2 print:px-1 py-2 print:py-1 text-right font-semibold text-gray-800",children:"Montant TTC"}),t.jsx("th",{className:"border border-gray-300 px-2 print:px-1 py-2 print:py-1 text-right font-semibold text-gray-800",children:"Provision"}),t.jsx("th",{className:"border border-gray-300 px-2 print:px-1 py-2 print:py-1 text-center font-semibold text-gray-800",children:"Statut"}),t.jsx("th",{className:"border border-gray-300 px-2 print:px-1 py-2 print:py-1 text-center font-semibold text-gray-800",children:"Paiement"})]})}),t.jsx("tbody",{children:e.map((e,r)=>{return t.jsxs("tr",{className:(r%2==0?"bg-white":"bg-gray-50")+" print:break-inside-avoid",children:[t.jsx("td",{className:"border border-gray-300 px-2 print:px-1 py-1 font-medium text-gray-900",children:e.invoiceNumber}),t.jsx("td",{className:"border border-gray-300 px-2 print:px-1 py-1 text-gray-700 max-w-[120px] truncate",title:e.clientName,children:e.clientName}),t.jsx("td",{className:"border border-gray-300 px-2 print:px-1 py-1 text-gray-700 whitespace-nowrap",children:T(e.date)}),t.jsx("td",{className:"border border-gray-300 px-2 print:px-1 py-1 text-right font-medium text-gray-900 whitespace-nowrap",children:k(e.totalTTC)}),t.jsx("td",{className:"border border-gray-300 px-2 print:px-1 py-1 text-right text-gray-700 whitespace-nowrap",children:e.payment?.provision?k(e.payment.provisionAmount||0):"-"}),t.jsx("td",{className:"border border-gray-300 px-2 print:px-1 py-1 text-center",children:t.jsx("span",{className:"inline-block px-1 py-0.5 rounded text-[10px] print:text-[7pt] font-medium text-white",style:{backgroundColor:(n=e.status,{"r√©gl√©e totalement":"#22c55e","r√©gl√©e partiellement":"#f59e0b","non r√©gl√©e":"#ef4444"}[n]||"#6b7280")},children:"r√©gl√©e totalement"===e.status?"R√©gl√©e":"r√©gl√©e partiellement"===e.status?"Partielle":"Non r√©gl√©e"})}),t.jsx("td",{className:"border border-gray-300 px-2 print:px-1 py-1 text-center text-gray-700 capitalize text-xs print:text-[7pt]",children:e.payment?.method||"-"})]},e.id);var n})})]})}),t.jsx("div",{className:"mt-4 print:mt-3 pt-3 print:pt-2 border-t-2 border-gray-300 print:break-inside-avoid",children:t.jsxs("div",{className:"grid grid-cols-2 gap-4 print:gap-3 text-sm print:text-xs",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-gray-800 mb-2 print:mb-1",children:"R√©sum√© Financier"}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Chiffre d'affaires factur√© :"}),t.jsxs("span",{className:"font-medium whitespace-nowrap",children:[k(i)," F CFA"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Montant encaiss√© :"}),t.jsxs("span",{className:"font-medium text-green-600 whitespace-nowrap",children:[k(d)," F CFA"]})]}),t.jsxs("div",{className:"flex justify-between border-t pt-1",children:[t.jsx("span",{className:"text-gray-600 font-semibold",children:"Reste √† encaisser :"}),t.jsxs("span",{className:"font-bold text-red-600 whitespace-nowrap",children:[k(i-d)," F CFA"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Taux d'encaissement :"}),t.jsxs("span",{className:"font-medium",children:[i>0?Math.round(d/i*100):0,"%"]})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-gray-800 mb-2 print:mb-1",children:"Informations"}),t.jsxs("div",{className:"space-y-0.5 text-gray-600",children:[t.jsx("p",{children:"‚Ä¢ Rapport g√©n√©r√© automatiquement"}),t.jsxs("p",{children:["‚Ä¢ Donn√©es au ",(new Date).toLocaleDateString("fr-FR")]}),t.jsxs("p",{children:["‚Ä¢ Total de ",n," facture(s) incluse(s)"]}),t.jsx("p",{children:"‚Ä¢ Montants exprim√©s en Francs CFA"})]})]})]})})]}),t.jsx("div",{className:"border-t border-gray-200 p-4 text-center text-sm text-gray-500 print:fixed print:bottom-0 print:left-0 print:right-0 print:bg-white",children:t.jsxs("p",{children:["Page 1/1 - Rapport de facturation g√©n√©r√© le ",(new Date).toLocaleDateString("fr-FR")," - Cabinet d'Avocats"]})})]}),t.jsx("style",{children:"\n          @media print {\n            @page {\n              margin: 8mm 10mm;\n              size: A4 portrait;\n            }\n            \n            body {\n              print-color-adjust: exact;\n              -webkit-print-color-adjust: exact;\n              font-size: 8pt;\n              line-height: 1.2;\n            }\n            \n            * {\n              box-sizing: border-box;\n            }\n            \n            /* Emp√™cher les coupures */\n            .print\\:break-inside-avoid {\n              page-break-inside: avoid !important;\n              break-inside: avoid !important;\n            }\n            \n            /* Optimiser espaces */\n            .print\\:p-\\[10mm\\] {\n              padding: 10mm !important;\n            }\n            \n            .print\\:p-2 {\n              padding: 0.3rem !important;\n            }\n            \n            .print\\:p-1 {\n              padding: 0.2rem !important;\n            }\n            \n            .print\\:px-1 {\n              padding-left: 0.2rem !important;\n              padding-right: 0.2rem !important;\n            }\n            \n            .print\\:py-1 {\n              padding-top: 0.2rem !important;\n              padding-bottom: 0.2rem !important;\n            }\n            \n            .print\\:pb-2 {\n              padding-bottom: 0.3rem !important;\n            }\n            \n            .print\\:mb-3 {\n              margin-bottom: 0.5rem !important;\n            }\n            \n            .print\\:mb-2 {\n              margin-bottom: 0.3rem !important;\n            }\n            \n            .print\\:mb-1 {\n              margin-bottom: 0.2rem !important;\n            }\n            \n            .print\\:mt-3 {\n              margin-top: 0.5rem !important;\n            }\n            \n            .print\\:mt-2 {\n              margin-top: 0.3rem !important;\n            }\n            \n            .print\\:pt-2 {\n              padding-top: 0.3rem !important;\n            }\n            \n            .print\\:gap-2 {\n              gap: 0.3rem !important;\n            }\n            \n            .print\\:gap-3 {\n              gap: 0.5rem !important;\n            }\n            \n            .print\\:text-lg {\n              font-size: 10pt !important;\n            }\n            \n            .print\\:text-base {\n              font-size: 8pt !important;\n            }\n            \n            .print\\:text-sm {\n              font-size: 7pt !important;\n            }\n            \n            .print\\:text-xs {\n              font-size: 6.5pt !important;\n            }\n            \n            .print\\:text-\\[7pt\\] {\n              font-size: 7pt !important;\n            }\n            \n            .print\\:overflow-visible {\n              overflow: visible !important;\n            }\n            \n            /* Optimiser tableaux */\n            table {\n              page-break-inside: auto;\n            }\n            \n            tr {\n              page-break-inside: avoid;\n              page-break-after: auto;\n            }\n            \n            thead {\n              display: table-header-group;\n            }\n            \n            /* Conserver couleurs */\n            .bg-gray-50,\n            .bg-gray-100,\n            .bg-green-50,\n            .bg-yellow-50,\n            .bg-red-50 {\n              print-color-adjust: exact;\n              -webkit-print-color-adjust: exact;\n            }\n          }\n        "})]})},S=e=>Number.isNaN(e)||null===e?"0":new Intl.NumberFormat("fr-FR").format(e),I=e=>{if(!e)return"Non d√©finie";return new Date(e).toLocaleDateString("fr-FR")},E=({invoice:e,onClose:r})=>{const{companyInfo:i}=n();if(!e)return null;const a=Object.values(e.debours||{}).reduce((e,t)=>e+(t||0),0)+Object.values(e.honoraires||{}).reduce((e,t)=>e+(t||0),0),l=.18*a,o=e.totalTTC||a+l;return t.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 print:bg-white print:relative print:inset-auto print:p-0",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto print:shadow-none print:rounded-none print:max-w-none print:max-h-none print:overflow-visible",children:[t.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 flex justify-between items-center print:hidden",children:[t.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:["Aper√ßu d'impression - ",e.invoiceNumber]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(s,{onClick:()=>{globalThis.print()},className:"bg-blue-600 hover:bg-blue-700",children:"Imprimer"}),t.jsxs(s,{variant:"outline",onClick:r,children:[t.jsx(c,{className:"w-4 h-4 mr-2"}),"Fermer"]})]})]}),t.jsxs("div",{className:"p-8 print:p-[12mm] bg-white",children:[t.jsxs("div",{className:"mb-4 print:mb-3 print:break-inside-avoid",children:[t.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 h-16 print:h-14 rounded-t-lg print:rounded-none flex items-center px-6 print:px-4",children:t.jsxs("div",{className:"text-white",children:[t.jsx("h1",{className:"text-xl print:text-lg font-bold",children:i?.name||"CABINET D'AVOCATS"}),t.jsx("p",{className:"text-sm print:text-xs text-purple-100",children:i?.slogan||"Excellence Juridique & Conseil"})]})}),t.jsx("div",{className:"bg-gray-50 p-4 print:p-3 rounded-b-lg print:rounded-none border-l-4 border-purple-600",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 print:gap-2 text-sm print:text-xs",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-semibold text-gray-800",children:"Adresse du Cabinet"}),t.jsx("p",{className:"text-gray-600",children:i?.address||"123 Avenue des Avocats"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"font-semibold text-gray-800",children:"Contact"}),t.jsxs("p",{className:"text-gray-600",children:["T√©l: ",i?.phone||"+33 1 23 45 67 89"]}),t.jsxs("p",{className:"text-gray-600",children:["Email: ",i?.email||"contact@cabinet-avocats.fr"]})]})]})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 print:gap-4 mb-4 print:mb-3 print:break-inside-avoid",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-base print:text-sm font-bold text-gray-800 mb-2 print:mb-1 border-b-2 border-purple-600 pb-1",children:"FACTURE"}),t.jsxs("div",{className:"space-y-1 text-sm print:text-xs",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"font-medium text-gray-600",children:"Num√©ro:"}),t.jsx("span",{className:"font-bold text-gray-900",children:e.invoiceNumber})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"font-medium text-gray-600",children:"Date:"}),t.jsx("span",{className:"text-gray-900",children:I(e.date)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"font-medium text-gray-600",children:"Dossier:"}),t.jsx("span",{className:"text-gray-900 truncate ml-2",title:e.caseTitle||e.caseId||"N/A",children:e.caseTitle||e.caseId||"N/A"})]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base print:text-sm font-bold text-gray-800 mb-2 print:mb-1 border-b-2 border-purple-600 pb-1",children:"CLIENT"}),t.jsxs("div",{className:"bg-gray-50 p-3 print:p-2 rounded-lg",children:[t.jsx("p",{className:"font-bold text-gray-900 text-base print:text-sm",children:e.clientName}),t.jsx("p",{className:"text-gray-600 text-xs mt-1",children:"Adresse client"}),t.jsx("p",{className:"text-gray-600 text-xs",children:"Code postal, Ville"})]})]})]}),t.jsxs("div",{className:"mb-4 print:mb-3 print:break-inside-avoid",children:[t.jsx("h3",{className:"text-base print:text-sm font-bold text-gray-800 mb-2 print:mb-1 border-b-2 border-purple-600 pb-1",children:"D√âTAIL DES PRESTATIONS"}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full border-collapse border border-gray-300 text-sm print:text-xs",children:[t.jsx("thead",{className:"bg-gray-100",children:t.jsxs("tr",{children:[t.jsx("th",{className:"border border-gray-300 px-3 print:px-2 py-2 print:py-1 text-left font-semibold text-gray-800",children:"Description"}),t.jsx("th",{className:"border border-gray-300 px-3 print:px-2 py-2 print:py-1 text-right font-semibold text-gray-800 w-32 print:w-28",children:"Montant (F CFA)"})]})}),t.jsxs("tbody",{children:[e.honoraires&&Object.entries(e.honoraires).map(([e,r])=>r>0&&t.jsxs("tr",{className:"print:break-inside-avoid",children:[t.jsxs("td",{className:"border border-gray-300 px-3 print:px-2 py-2 print:py-1 text-gray-700",children:["Honoraires - ","forfait"===e?"Forfait":"tauxHoraire"===e?"Taux horaire":"base"===e?"Base":"R√©sultat"]}),t.jsx("td",{className:"border border-gray-300 px-3 print:px-2 py-2 print:py-1 text-right font-medium text-gray-900 whitespace-nowrap",children:S(r)})]},e)),e.debours&&Object.entries(e.debours).map(([e,r])=>r>0&&t.jsxs("tr",{className:"print:break-inside-avoid",children:[t.jsxs("td",{className:"border border-gray-300 px-3 print:px-2 py-2 print:py-1 text-gray-700",children:["D√©bours - ","entrevue"===e?"Entrevue":"dossier"===e?"Dossier":"plaidoirie"===e?"Plaidoirie":"huissier"===e?"Huissier":"D√©placement"]}),t.jsx("td",{className:"border border-gray-300 px-3 print:px-2 py-2 print:py-1 text-right font-medium text-gray-900 whitespace-nowrap",children:S(r)})]},e))]})]})})]}),t.jsx("div",{className:"flex justify-end mb-4 print:mb-3 print:break-inside-avoid",children:t.jsx("div",{className:"w-full max-w-sm",children:t.jsx("div",{className:"bg-gray-50 p-4 print:p-3 rounded-lg border-2 border-purple-600",children:t.jsxs("div",{className:"space-y-2 print:space-y-1 text-sm print:text-xs",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"font-medium text-gray-600",children:"SOUS-TOTAL:"}),t.jsxs("span",{className:"font-semibold text-gray-900 whitespace-nowrap",children:[S(a)," F CFA"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"font-medium text-gray-600",children:"TVA (18%):"}),t.jsxs("span",{className:"font-semibold text-gray-900 whitespace-nowrap",children:[S(l)," F CFA"]})]}),t.jsx("div",{className:"border-t border-gray-300 pt-2 print:pt-1",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"font-bold text-base print:text-sm text-gray-800",children:"TOTAL D√õ:"}),t.jsxs("span",{className:"font-bold text-lg print:text-base text-purple-600 whitespace-nowrap",children:[S(o)," F CFA"]})]})})]})})})}),e.payment&&t.jsxs("div",{className:"mb-4 print:mb-3 print:break-inside-avoid",children:[t.jsx("h3",{className:"text-base print:text-sm font-bold text-gray-800 mb-2 print:mb-1 border-b-2 border-purple-600 pb-1",children:"INFORMATIONS DE PAIEMENT"}),t.jsxs("div",{className:"bg-blue-50 p-3 print:p-2 rounded-lg",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 print:gap-2 text-sm print:text-xs",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium text-gray-600",children:"Mode de paiement:"}),t.jsx("span",{className:"ml-2 text-gray-900 capitalize",children:e.payment.method||"Non d√©fini"})]}),e.payment.provision&&t.jsxs("div",{children:[t.jsx("span",{className:"font-medium text-gray-600",children:"Provision vers√©e:"}),t.jsxs("span",{className:"ml-2 text-gray-900 whitespace-nowrap",children:[S(e.payment.provisionAmount||0)," F CFA"]})]})]}),e.payment.provisionAmount<o&&t.jsx("div",{className:"mt-2 print:mt-1 p-2 print:p-1 bg-yellow-100 border border-yellow-300 rounded",children:t.jsxs("p",{className:"text-yellow-800 font-medium text-sm print:text-xs",children:["Solde restant d√ª: ",S(o-(e.payment.provisionAmount||0))," F CFA"]})})]})]}),t.jsxs("div",{className:"border-t-2 border-gray-300 pt-4 print:pt-3 print:break-before-auto",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 print:gap-3 text-sm print:text-xs print:break-inside-avoid",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-bold text-gray-800 mb-2 print:mb-1",children:"CONDITIONS DE PAIEMENT"}),t.jsxs("div",{className:"text-gray-600 space-y-0.5",children:[t.jsx("p",{children:"‚Ä¢ Paiement sous 30 jours √† r√©ception"}),t.jsx("p",{children:"‚Ä¢ Virements accept√©s sur compte bancaire"}),t.jsx("p",{children:"‚Ä¢ Retard de paiement: p√©nalit√©s de 3% par mois"}),t.jsx("p",{children:"‚Ä¢ TVA non applicable - Article 293 B du CGI"})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-bold text-gray-800 mb-2 print:mb-1",children:"COORDONN√âES BANCAIRES"}),t.jsxs("div",{className:"text-gray-600 space-y-0.5",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Banque:"})," Cr√©dit Agricole Paris"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"IBAN:"})," FR76 1234 5678 9012 3456 789"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"BIC:"})," AGRIFRPP"]})]})]})]}),t.jsxs("div",{className:"mt-4 print:mt-3 text-center p-3 print:p-2 bg-purple-50 rounded-lg border-l-4 border-purple-600 print:break-inside-avoid",children:[t.jsx("p",{className:"text-gray-700 text-sm print:text-xs italic",children:'"Nous vous remercions de votre confiance et restons √† votre disposition pour tout renseignement compl√©mentaire."'}),t.jsxs("p",{className:"text-purple-600 font-semibold text-sm print:text-xs mt-1",children:[i?.name||"Cabinet d'Avocats"," - ",i?.slogan||"Excellence Juridique"]})]})]}),t.jsx("div",{className:"flex justify-end mt-6 print:mt-4 print:break-inside-avoid",children:t.jsxs("div",{className:"text-center",children:[t.jsxs("p",{className:"text-gray-600 text-sm print:text-xs mb-6 print:mb-4",children:["Fait √† Paris, le ",I((new Date).toISOString())]}),t.jsx("div",{className:"border-t border-gray-400 w-40 print:w-32 mx-auto pt-2 print:pt-1",children:t.jsx("p",{className:"text-gray-700 text-sm print:text-xs font-medium",children:"Signature et cachet"})})]})})]}),t.jsx("div",{className:"border-t border-gray-200 p-4 text-center text-sm text-gray-500 print:fixed print:bottom-0 print:left-0 print:right-0 print:bg-white",children:t.jsxs("p",{children:[i?.name||"Cabinet d'Avocats"," - ",i?.address||"123 Avenue des Avocats, 75001 Paris"," - T√©l: ",i?.phone||"+33 1 23 45 67 89"]})})]}),t.jsx("style",{children:"\n          @media print {\n            @page {\n              margin: 10mm 12mm;\n              size: A4 portrait;\n            }\n            \n            body {\n              print-color-adjust: exact;\n              -webkit-print-color-adjust: exact;\n              font-size: 9pt;\n              line-height: 1.3;\n            }\n            \n            * {\n              box-sizing: border-box;\n            }\n            \n            /* Classes utilitaires print */\n            .print\\:hidden {\n              display: none !important;\n            }\n            \n            .print\\:bg-white {\n              background: white !important;\n            }\n            \n            .print\\:relative {\n              position: relative !important;\n            }\n            \n            .print\\:inset-auto {\n              inset: auto !important;\n            }\n            \n            .print\\:p-0 {\n              padding: 0 !important;\n            }\n            \n            .print\\:p-\\[12mm\\] {\n              padding: 12mm !important;\n            }\n            \n            .print\\:p-3 {\n              padding: 0.5rem !important;\n            }\n            \n            .print\\:p-2 {\n              padding: 0.35rem !important;\n            }\n            \n            .print\\:p-1 {\n              padding: 0.2rem !important;\n            }\n            \n            .print\\:px-4 {\n              padding-left: 0.75rem !important;\n              padding-right: 0.75rem !important;\n            }\n            \n            .print\\:px-2 {\n              padding-left: 0.35rem !important;\n              padding-right: 0.35rem !important;\n            }\n            \n            .print\\:py-1 {\n              padding-top: 0.2rem !important;\n              padding-bottom: 0.2rem !important;\n            }\n            \n            .print\\:pt-3 {\n              padding-top: 0.5rem !important;\n            }\n            \n            .print\\:pt-1 {\n              padding-top: 0.2rem !important;\n            }\n            \n            .print\\:mb-3 {\n              margin-bottom: 0.5rem !important;\n            }\n            \n            .print\\:mb-1 {\n              margin-bottom: 0.2rem !important;\n            }\n            \n            .print\\:mt-3 {\n              margin-top: 0.5rem !important;\n            }\n            \n            .print\\:mt-4 {\n              margin-top: 0.75rem !important;\n            }\n            \n            .print\\:mt-1 {\n              margin-top: 0.2rem !important;\n            }\n            \n            .print\\:gap-4 {\n              gap: 0.75rem !important;\n            }\n            \n            .print\\:gap-3 {\n              gap: 0.5rem !important;\n            }\n            \n            .print\\:gap-2 {\n              gap: 0.35rem !important;\n            }\n            \n            .print\\:space-y-1 > * + * {\n              margin-top: 0.2rem !important;\n            }\n            \n            .print\\:h-14 {\n              height: 3.5rem !important;\n            }\n            \n            .print\\:w-28 {\n              width: 7rem !important;\n            }\n            \n            .print\\:w-32 {\n              width: 8rem !important;\n            }\n            \n            .print\\:text-lg {\n              font-size: 10pt !important;\n            }\n            \n            .print\\:text-sm {\n              font-size: 8pt !important;\n            }\n            \n            .print\\:text-xs {\n              font-size: 7pt !important;\n            }\n            \n            .print\\:text-base {\n              font-size: 9pt !important;\n            }\n            \n            .print\\:shadow-none {\n              box-shadow: none !important;\n            }\n            \n            .print\\:rounded-none {\n              border-radius: 0 !important;\n            }\n            \n            .print\\:max-w-none {\n              max-width: none !important;\n            }\n            \n            .print\\:max-h-none {\n              max-height: none !important;\n            }\n            \n            .print\\:overflow-visible {\n              overflow: visible !important;\n            }\n            \n            .print\\:fixed {\n              position: fixed !important;\n            }\n            \n            .print\\:bottom-0 {\n              bottom: 0 !important;\n            }\n            \n            .print\\:left-0 {\n              left: 0 !important;\n            }\n            \n            .print\\:right-0 {\n              right: 0 !important;\n            }\n            \n            /* Emp√™cher les coupures de page */\n            .print\\:break-inside-avoid {\n              page-break-inside: avoid !important;\n              break-inside: avoid !important;\n            }\n            \n            .print\\:break-before-auto {\n              page-break-before: auto !important;\n              break-before: auto !important;\n            }\n            \n            /* Optimisations sp√©cifiques */\n            h1, h2, h3, h4, h5, h6 {\n              page-break-after: avoid;\n              break-after: avoid;\n            }\n            \n            table {\n              page-break-inside: auto;\n            }\n            \n            tr {\n              page-break-inside: avoid;\n              page-break-after: auto;\n            }\n            \n            thead {\n              display: table-header-group;\n            }\n            \n            tfoot {\n              display: table-footer-group;\n            }\n            \n            /* Assurer la visibilit√© des couleurs */\n            .bg-gradient-to-r,\n            .bg-gray-50,\n            .bg-blue-50,\n            .bg-purple-50,\n            .bg-yellow-100 {\n              print-color-adjust: exact;\n              -webkit-print-color-adjust: exact;\n            }\n            \n            /* Optimiser les marges pour √©viter d√©bordements */\n            .overflow-x-auto {\n              overflow: visible !important;\n            }\n          }\n        "})]})},R=e=>Number.isNaN(e)||null===e?"0":new Intl.NumberFormat("fr-FR").format(e),z=e=>{const t=e.totalTTC||0,r=e.payment?.provisionAmount||0;return!e.payment?.provision||r<=0?"non r√©gl√©e":r>=t?"r√©gl√©e totalement":"r√©gl√©e partiellement"},_=({currentUser:r})=>{const[n,c]=e.useState([]),[m,b]=e.useState(!1),[w,C]=e.useState(null),[F,k]=e.useState(""),[T,S]=e.useState("all"),[I,_]=e.useState(!1),[M,O]=e.useState(!1),[P,L]=e.useState(null),q=l(r),H=r?.permissions||{},$=q||o(H,"billing","create");q||o(H,"billing","edit"),q||o(H,"billing","delete");const U=q||o(H,"billing")||"Avocat"===r?.function||"avocat"===r?.role;e.useEffect(()=>{B()},[]),e.useEffect(()=>{const e=e=>{M&&!e.target.closest(".relative")&&O(!1)};if(M)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[M]);const B=async()=>{try{const{data:e,error:t}=await i.from("invoices").select("*").order("invoice_date",{ascending:!1});if(t)return void a({variant:"destructive",title:"‚ùå Erreur",description:"Impossible de charger les factures."});const r=(e||[]).map(e=>({id:e.id,invoiceNumber:e.invoice_number,clientName:e.client_name,caseId:e.case_id,caseTitle:e.case_title,totalTTC:e.total_ttc,date:e.invoice_date,invoice_type:e.invoice_type||"definitive",debours:e.debours||{},honoraires:e.honoraires||{},payment:e.payment||{},status:e.status||z(e)}));c(r)}catch(e){a({variant:"destructive",title:"‚ùå Erreur",description:"Une erreur s'est produite lors du chargement des factures."})}},V=e.useMemo(()=>{const e=n.reduce((e,t)=>e+(t.totalTTC||0),0),t=n.filter(e=>"non r√©gl√©e"===e.status||"r√©gl√©e partiellement"===e.status).reduce((e,t)=>e+(t.totalTTC||0),0),r=new Date;return{total:e,pendingAmount:t,overdueAmount:n.filter(e=>{if("r√©gl√©e totalement"===e.status)return!1;const t=new Date(e.date);return Math.floor((r-t)/864e5)>30}).reduce((e,t)=>e+(t.totalTTC||0),0),thisMonthAmount:n.filter(e=>{const t=new Date(e.date);return t.getMonth()===r.getMonth()&&t.getFullYear()===r.getFullYear()}).reduce((e,t)=>e+(t.totalTTC||0),0),totalChange:18,pendingChange:5,overdueChange:-12,thisMonthChange:22}},[n]),G=e.useMemo(()=>n.filter(e=>e.clientName?.toLowerCase().includes(F.toLowerCase())||e.invoiceNumber?.toLowerCase().includes(F.toLowerCase())).filter(e=>"all"===T||e.status===T),[n,F,T]);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between print:hidden",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Facturation & Comptabilit√©"}),t.jsx("p",{className:"text-slate-400",children:"G√©rez les factures et les rapports financiers"}),!$&&U&&t.jsxs("div",{className:"flex items-center gap-2 mt-2 p-2 bg-yellow-500/20 border border-yellow-500/30 rounded-lg",children:[t.jsx(p,{className:"w-4 h-4 text-yellow-400"}),t.jsx("span",{className:"text-sm text-yellow-300",children:"Acc√®s en lecture seule - Contactez un administrateur pour cr√©er des factures"})]})]}),$&&t.jsxs(s,{onClick:()=>{C(null),b(!0)},className:"bg-blue-600 hover:bg-blue-700",children:[t.jsx(u,{className:"w-4 h-4 mr-2"}),"Nouvelle Facture"]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 print:hidden",children:[t.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("p",{className:"text-sm text-slate-400",children:"Revenu Total"}),t.jsx("div",{className:"p-2 bg-green-500 rounded-lg",children:t.jsx(h,{className:"w-5 h-5 text-white"})})]}),t.jsxs("p",{className:"text-3xl font-bold text-white mb-2",children:[R(V.total)," F CFA"]}),t.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[t.jsx(g,{className:"w-4 h-4 text-green-400"}),t.jsxs("span",{className:"text-green-400 font-medium",children:["+",V.totalChange,"%"]})]})]}),t.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("p",{className:"text-sm text-slate-400",children:"Factures en attente"}),t.jsx("div",{className:"p-2 bg-yellow-500 rounded-lg",children:t.jsx(j,{className:"w-5 h-5 text-white"})})]}),t.jsxs("p",{className:"text-3xl font-bold text-white mb-2",children:[R(V.pendingAmount)," F CFA"]}),t.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[t.jsx(g,{className:"w-4 h-4 text-green-400"}),t.jsxs("span",{className:"text-green-400 font-medium",children:["+",V.pendingChange,"%"]})]})]}),t.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("p",{className:"text-sm text-slate-400",children:"En retard"}),t.jsx("div",{className:"p-2 bg-red-500 rounded-lg",children:t.jsx(p,{className:"w-5 h-5 text-white"})})]}),t.jsxs("p",{className:"text-3xl font-bold text-white mb-2",children:[R(V.overdueAmount)," F CFA"]}),t.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[t.jsx(f,{className:"w-4 h-4 text-red-400"}),t.jsxs("span",{className:"text-red-400 font-medium",children:[V.overdueChange,"%"]})]})]}),t.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("p",{className:"text-sm text-slate-400",children:"Ce mois-ci"}),t.jsx("div",{className:"p-2 bg-blue-600 rounded-lg",children:t.jsx(y,{className:"w-5 h-5 text-white"})})]}),t.jsxs("p",{className:"text-3xl font-bold text-white mb-2",children:[R(V.thisMonthAmount)," F CFA"]}),t.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[t.jsx(g,{className:"w-4 h-4 text-green-400"}),t.jsxs("span",{className:"text-green-400 font-medium",children:["+",V.thisMonthChange,"%"]})]})]})]}),t.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl print:hidden",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-700/50",children:[t.jsx("h2",{className:"text-xl font-bold text-white",children:"Factures R√©centes"}),t.jsxs(s,{variant:"outline",onClick:()=>{a({title:"Export en cours",description:"Les factures sont en cours d'exportation..."})},className:"border-slate-600 text-slate-300 hover:bg-slate-700",children:[t.jsx(v,{className:"w-4 h-4 mr-2"}),"Exporter"]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-slate-900/50 border-b border-slate-700/30",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider",children:"ID Facture"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider",children:"Client"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider",children:"Dossier"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider",children:"Montant"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider",children:"Date"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider",children:"√âch√©ance"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider",children:"Statut"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-slate-700/30",children:G.length>0?G.slice(0,10).map((e,r)=>{const n=new Date(e.date);n.setDate(n.getDate()+30);const i=n.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});return t.jsxs(d.tr,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.05*r},className:"hover:bg-slate-700/30",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:e.invoiceNumber}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-300",children:e.clientName}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-300",children:e.caseTitle||e.caseId||"‚Äî"}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:[R(e.totalTTC)," F CFA"]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-300",children:new Date(e.date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-300",children:i}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium "+("r√©gl√©e totalement"===e.status?"bg-green-500/20 text-green-300 border border-green-500/30":"r√©gl√©e partiellement"===e.status||"non r√©gl√©e"===e.status?"bg-yellow-500/20 text-yellow-300 border border-yellow-500/30":"bg-red-500/20 text-red-300 border border-red-500/30"),children:"r√©gl√©e totalement"===e.status?"Pay√©e":"non r√©gl√©e"===e.status?"En attente":"En retard"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-400",children:t.jsx(s,{variant:"ghost",size:"icon",onClick:()=>(e=>{L(e),a({title:"üìÑ Ouverture de l'aper√ßu",description:`Pr√©paration de la facture ${e.invoiceNumber} pour l'impression.`})})(e),className:"hover:bg-slate-600",children:t.jsx(x,{className:"w-4 h-4 text-slate-400"})})})]},e.id)}):t.jsx("tr",{children:t.jsxs("td",{colSpan:"8",className:"px-6 py-12 text-center",children:[t.jsx(N,{className:"w-12 h-12 text-slate-600 mx-auto mb-3"}),t.jsx("p",{className:"text-slate-400",children:"Aucune facture trouv√©e"})]})})})]})})]}),m&&t.jsx(A,{invoice:w,onSubmit:w?async e=>{try{const t=z(e),r={client_name:e.clientName,case_id:e.caseId,case_title:e.caseTitle,total_ttc:Number(e.totalTTC)||0,invoice_date:e.date,invoice_type:e.invoice_type||"definitive",debours:e.debours||{},honoraires:e.honoraires||{},payment:e.payment||{},status:t},{data:n,error:s}=await i.from("invoices").update(r).eq("id",e.id).select();if(s)return void a({variant:"destructive",title:"‚ùå Erreur",description:"Impossible de modifier la facture."});await B(),C(null),b(!1),a({title:"‚úÖ Facture modifi√©e",description:`La facture ${e.invoiceNumber} a √©t√© mise √† jour.`})}catch(t){a({variant:"destructive",title:"‚ùå Erreur",description:"Une erreur s'est produite lors de la modification de la facture."})}}:async e=>{try{const t=`FACT-${(new Date).getFullYear()}-${String(n.length+1).padStart(3,"0")}`,s=z(e),l={invoice_number:t,client_name:e.clientName,case_id:e.caseId,case_title:e.caseTitle,total_ttc:Number(e.totalTTC)||0,invoice_date:(new Date).toISOString().split("T")[0],invoice_type:e.invoice_type||"definitive",debours:e.debours||{},honoraires:e.honoraires||{},payment:e.payment||{},status:s,created_by:r?.id},{data:o,error:d}=await i.from("invoices").insert([l]).select();if(d)return void a({variant:"destructive",title:"‚ùå Erreur",description:"Impossible de cr√©er la facture."});await B(),b(!1),a({title:"‚úÖ Facture cr√©√©e",description:`La facture ${t} a √©t√© cr√©√©e avec succ√®s.`})}catch(t){a({variant:"destructive",title:"‚ùå Erreur",description:"Une erreur s'est produite lors de la cr√©ation de la facture."})}},onCancel:()=>{b(!1),C(null)},onPrint:()=>{a({title:"Impression en cours...",description:"Pr√©paration de la facture pour l'impression."}),globalThis.print()},currentUser:r}),I&&t.jsx(D,{invoices:G,onClose:()=>_(!1)}),P&&t.jsx(E,{invoice:P,onClose:()=>L(null)})]})};_.propTypes={currentUser:r.shape({id:r.string,name:r.string,email:r.string,role:r.string,function:r.string,permissions:r.object})};export{_ as default};
