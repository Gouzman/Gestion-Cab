import{r as e,j as s}from"./vendor-react-DYPeng9G.js";import{u as t,B as a,e as l,s as r,t as i,f as n,h as c,i as o,j as d,k as m,l as x}from"./index-0LlzAmpO.js";import{L as u,C as p}from"./label-BZj4Sq3D.js";import{u as h,d as b}from"./permissionsUtils-VRGcIqVs.js";import{m as g,o as j,aq as v,ar as f,w as N,r as y,X as w,as as C,q as k,U as _,at as S,M as A,au as E,av as z,K as P,l as q,u as F,a1 as L,aw as I,am as T,ax as U,ay as $,az as M,aA as G,J as D,aB as R,aC as V,aD as J,aE as B,aF as O,an as H,aG as K}from"./vendor-ui-DYDeDtSQ.js";import"./vendor-supabase-DEEIiAjM.js";const Q=({onClose:l})=>{const{createUser:r}=h(),{toast:i}=t(),[n,c]=e.useState({email:"",name:"",role:"user",function:""}),[o,d]=e.useState(!1),[m,x]=e.useState(!1),[p,b]=e.useState(""),[k,_]=e.useState(""),[S,A]=e.useState(!1),E=()=>{x(!1),b(""),_(""),A(!1),l&&l()},z=(e,s)=>{c(t=>({...t,[e]:s}))};return s.jsxs(g.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-slate-700/50 border border-slate-600 rounded-lg p-6 mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx(j,{className:"w-6 h-6 text-green-400"}),s.jsx("h3",{className:"text-xl font-semibold text-white",children:"Créer un nouvel utilisateur"})]}),s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),d(!0);const s=await r(n);s.success&&(b(s.initialPassword),_(n.name),x(!0),c({email:"",name:"",role:"user",function:""})),d(!1)},className:"space-y-4",children:[s.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(u,{htmlFor:"user-email",className:"text-slate-300 mb-2 block",children:"Adresse email *"}),s.jsx("input",{id:"user-email",type:"email",required:!0,value:n.email,onChange:e=>z("email",e.target.value),placeholder:"utilisateur@cabinet.com",className:"w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-green-500"})]}),s.jsxs("div",{children:[s.jsx(u,{htmlFor:"user-name",className:"text-slate-300 mb-2 block",children:"Nom complet *"}),s.jsx("input",{id:"user-name",type:"text",required:!0,value:n.name,onChange:e=>z("name",e.target.value),placeholder:"Nom Prénom",className:"w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-green-500"})]})]}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(u,{htmlFor:"user-role-select",className:"text-slate-300 mb-2 block",children:"Rôle *"}),s.jsxs("select",{id:"user-role-select",value:n.role,onChange:e=>z("role",e.target.value),className:"w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500",children:[s.jsx("option",{value:"user",children:"Utilisateur"}),s.jsx("option",{value:"secretaire",children:"Secrétaire"}),s.jsx("option",{value:"avocat",children:"Avocat"}),s.jsx("option",{value:"gerant",children:"Gérant"}),s.jsx("option",{value:"admin",children:"Administrateur"})]})]}),s.jsxs("div",{children:[s.jsx(u,{htmlFor:"user-function-input",className:"text-slate-300 mb-2 block",children:"Titre / Fonction"}),s.jsxs("select",{id:"user-function-input",value:n.function,onChange:e=>z("function",e.target.value),className:"w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500 cursor-pointer",children:[s.jsx("option",{value:"",children:"Sélectionner un titre"}),s.jsx("option",{value:"Associé principal",children:"Associé principal"}),s.jsx("option",{value:"Associé",children:"Associé"}),s.jsx("option",{value:"Avocat senior",children:"Avocat senior"}),s.jsx("option",{value:"Avocat",children:"Avocat"}),s.jsx("option",{value:"Avocat stagiaire",children:"Avocat stagiaire"}),s.jsx("option",{value:"Juriste senior",children:"Juriste senior"}),s.jsx("option",{value:"Juriste",children:"Juriste"}),s.jsx("option",{value:"Secrétaire juridique",children:"Secrétaire juridique"}),s.jsx("option",{value:"Secrétaire",children:"Secrétaire"}),s.jsx("option",{value:"Assistant(e) juridique",children:"Assistant(e) juridique"}),s.jsx("option",{value:"Assistant(e)",children:"Assistant(e)"}),s.jsx("option",{value:"Comptable",children:"Comptable"}),s.jsx("option",{value:"Responsable administratif",children:"Responsable administratif"})]}),s.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Position hiérarchique et rôle au cabinet"})]})]}),s.jsxs("div",{className:"p-3 bg-slate-600/30 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(v,{className:"w-4 h-4 text-blue-400"}),s.jsx("span",{className:"text-sm font-medium text-blue-300",children:"Informations importantes"})]}),s.jsxs("ul",{className:"text-sm text-slate-400 space-y-1",children:[s.jsx("li",{children:"• L'utilisateur devra définir son mot de passe lors de sa première connexion"}),s.jsx("li",{children:"• Les permissions par défaut seront appliquées selon le rôle choisi"}),s.jsx("li",{children:"• Vous pourrez modifier les permissions individuellement après création"})]})]}),s.jsxs("div",{className:"flex justify-end gap-3",children:[l&&s.jsx(a,{type:"button",onClick:l,disabled:o,className:"bg-slate-600 hover:bg-slate-700",children:"Annuler"}),s.jsx(a,{type:"submit",disabled:o||!n.email||!n.name,className:"bg-green-600 hover:bg-green-700",children:o?s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Création..."]}):s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(f,{className:"w-4 h-4"}),"Créer l'utilisateur"]})})]})]}),s.jsx(N,{children:m&&s.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:E,children:s.jsxs(g.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:e=>e.stopPropagation(),className:"bg-slate-800 border-2 border-green-500/50 rounded-xl p-8 max-w-md w-full shadow-2xl",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-3 bg-green-500/20 rounded-lg",children:s.jsx(y,{className:"w-8 h-8 text-green-400"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-bold text-white",children:"Utilisateur créé !"}),s.jsx("p",{className:"text-sm text-slate-400",children:k})]})]}),s.jsx("button",{onClick:E,className:"p-2 hover:bg-slate-700 rounded-lg transition-colors",children:s.jsx(w,{className:"w-5 h-5 text-slate-400"})})]}),s.jsxs("div",{className:"bg-slate-700/50 border border-slate-600 rounded-lg p-4 mb-4",children:[s.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Mot de passe initial (à communiquer à l'utilisateur) :"}),s.jsxs("div",{className:"flex items-center gap-3 bg-slate-900/50 p-4 rounded-lg border border-slate-500",children:[s.jsx("code",{className:"text-lg font-mono text-green-400 flex-1 break-all",children:p}),s.jsx(a,{onClick:()=>{navigator.clipboard.writeText(p),A(!0),i({title:"✅ Mot de passe copié",description:"Le mot de passe a été copié dans le presse-papier"}),setTimeout(()=>A(!1),2e3)},className:"flex-shrink-0 "+(S?"bg-green-600 hover:bg-green-600":"bg-blue-600 hover:bg-blue-700"),children:S?s.jsxs(s.Fragment,{children:[s.jsx(y,{className:"w-4 h-4 mr-2"}),"Copié !"]}):s.jsxs(s.Fragment,{children:[s.jsx(C,{className:"w-4 h-4 mr-2"}),"Copier"]})})]})]}),s.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-4 mb-6",children:s.jsxs("p",{className:"text-sm text-amber-200",children:["⚠️ ",s.jsx("strong",{children:"Important :"})," L'utilisateur devra changer ce mot de passe lors de sa première connexion."]})}),s.jsx(a,{onClick:E,className:"w-full bg-slate-600 hover:bg-slate-700",children:"Fermer"})]})})})]})},W=[{id:"dashboard",label:"Tableau de Bord",actions:[]},{id:"tasks",label:"Tâches",actions:["create","edit","delete","reassign"]},{id:"clients",label:"Clients",actions:["create","edit","delete"]},{id:"cases",label:"Dossiers",actions:["create","edit","delete"]},{id:"calendar",label:"Agenda",actions:["create","edit","delete"]},{id:"documents",label:"Documents",actions:["upload","delete"]},{id:"billing",label:"Facturation",actions:["create","edit","delete"]},{id:"team",label:"Collaborateurs",actions:["create","edit","delete"]},{id:"reports",label:"Rapports",actions:[]},{id:"settings",label:"Paramètres",actions:[]}],X={create:"Créer",edit:"Modifier",delete:"Supprimer",reassign:"Réassigner",upload:"Télécharger"},Y=()=>{const{users:t,loading:l,fetchUsers:r,getUserPermissions:i,saveUserPermissions:n}=h(),[c,o]=e.useState(null),[d,m]=e.useState(null),[x,j]=e.useState(!1);e.useEffect(()=>{r()},[]),e.useEffect(()=>{(async()=>{if(c){const e=await i(c.id);m(e||b[c.role]||b.user)}else m(null)})()},[c]);const N=(e,s,t=null)=>{m(a=>{const l=structuredClone(a);return l[e]||(l[e]={visible:!1,actions:{}}),"visible"===s?(l[e].visible=!l[e].visible,l[e].visible||Object.keys(l[e].actions||{}).forEach(s=>{l[e].actions[s]=!1})):"action"===s&&t&&(l[e].actions||(l[e].actions={}),l[e].actions[t]=!l[e].actions[t]),l})};return l?s.jsxs("div",{className:"flex items-center justify-center py-8",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"}),s.jsx("span",{className:"ml-2 text-slate-300",children:"Chargement..."})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(v,{className:"w-6 h-6 text-purple-400"}),s.jsx("h2",{className:"text-xl font-semibold text-white",children:"Gestion des Permissions"})]}),s.jsxs(a,{onClick:()=>j(!x),className:"bg-green-600 hover:bg-green-700",children:[s.jsx(k,{className:"w-4 h-4 mr-2"}),"Nouvel utilisateur"]})]}),x&&s.jsx(Q,{onClose:()=>{j(!1),r()}}),s.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"lg:col-span-1",children:[s.jsxs("h3",{className:"text-white font-medium mb-3 flex items-center",children:[s.jsx(_,{className:"w-5 h-5 mr-2"}),"Utilisateurs (",t.length,")"]}),s.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:t.map(e=>{const a=(e=>{const s=b[e.role]||b.user;return{visibleModules:Object.values(s).filter(e=>e.visible).length,totalActions:Object.values(s).reduce((e,s)=>e+Object.values(s.actions||{}).filter(Boolean).length,0)}})(e),l=c?.id===e.id;return s.jsx(g.div,{whileHover:{scale:1.02},className:"p-3 rounded-lg cursor-pointer transition-all "+(l?"bg-purple-600/30 border-purple-500 border":"bg-slate-700/30 hover:bg-slate-700/50"),onClick:()=>(e=>{const s=t.find(s=>s.id===e);o(s||null)})(e.id),children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"font-medium text-white truncate",children:e.name}),s.jsx("p",{className:"text-sm text-slate-300 truncate",children:e.email}),s.jsx("div",{className:"flex items-center gap-2 mt-1",children:s.jsx("span",{className:"px-2 py-0.5 rounded text-xs font-medium "+("admin"===e.role||"gerant"===e.role?"bg-red-500/20 text-red-300":"avocat"===e.role?"bg-blue-500/20 text-blue-300":"secretaire"===e.role?"bg-green-500/20 text-green-300":"bg-gray-500/20 text-gray-300"),children:e.role})}),s.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:[a.visibleModules," modules • ",a.totalActions," actions"]})]}),l&&s.jsx(S,{className:"w-5 h-5 text-purple-400 flex-shrink-0"})]})},e.id)})})]}),s.jsx("div",{className:"lg:col-span-2",children:c?s.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[s.jsxs("div",{className:"p-4 bg-slate-700/30 rounded-lg border-l-4 border-purple-500",children:[s.jsxs("h3",{className:"text-white font-semibold mb-3 flex items-center",children:[s.jsx(S,{className:"w-5 h-5 mr-2"}),"Configuration pour ",c.name]}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(u,{htmlFor:"user-role",className:"text-slate-300 mb-1 block",children:"Rôle"}),s.jsxs("select",{id:"user-role",value:c.role||"",onChange:e=>(e=>{o(s=>({...s,role:e}));const s=b[e]||b.user;m(s)})(e.target.value),className:"w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:[s.jsx("option",{value:"user",children:"Utilisateur"}),s.jsx("option",{value:"avocat",children:"Avocat"}),s.jsx("option",{value:"secretaire",children:"Secrétaire"}),s.jsx("option",{value:"gerant",children:"Gérant"}),s.jsx("option",{value:"admin",children:"Administrateur"})]})]}),s.jsxs("div",{children:[s.jsx(u,{htmlFor:"user-function",className:"text-slate-300 mb-1 block",children:"Fonction"}),s.jsx("input",{id:"user-function",type:"text",value:c.function||"",onChange:e=>o(s=>({...s,function:e.target.value})),placeholder:"Ex: Avocat principal, Assistant...",className:"w-full px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]})]}),d&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h3",{className:"text-white font-semibold flex items-center",children:[s.jsx(v,{className:"w-5 h-5 mr-2"}),"Permissions par Module"]}),W.map(e=>s.jsxs("div",{className:"p-4 bg-slate-700/30 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs(u,{className:"text-lg font-medium text-white flex items-center",children:[d[e.id]?.visible?s.jsx(A,{className:"w-4 h-4 mr-2 text-green-400"}):s.jsx(E,{className:"w-4 h-4 mr-2 text-red-400"}),e.label]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(u,{htmlFor:`visible-${e.id}`,className:"text-slate-300",children:"Module visible"}),s.jsx(p,{id:`visible-${e.id}`,checked:d[e.id]?.visible||!1,onCheckedChange:()=>N(e.id,"visible")})]})]}),e.actions.length>0&&d[e.id]?.visible&&s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mt-4 pt-3 border-t border-slate-600/50",children:e.actions.map(t=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(p,{id:`${e.id}-${t}`,checked:d[e.id]?.actions?.[t]||!1,onCheckedChange:()=>N(e.id,"action",t)}),s.jsx(u,{htmlFor:`${e.id}-${t}`,className:"text-sm text-slate-300",children:X[t]||t})]},t))})]},e.id)),s.jsx("div",{className:"flex justify-end mt-6",children:s.jsxs(a,{onClick:async()=>{if(!c||!d)return;if((await n(c.id,d,c.role,c.function)).success){await r();const e=t.find(e=>e.id===c.id);e&&o(e)}},className:"bg-purple-600 hover:bg-purple-700",children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),"Sauvegarder les Permissions"]})})]})]}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx(_,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-xl font-medium text-white mb-2",children:"Aucun utilisateur sélectionné"}),s.jsx("p",{className:"text-slate-400",children:"Sélectionnez un utilisateur dans la liste pour configurer ses permissions."})]})})]})]})},Z=()=>{const{user:t}=l(),[n,c]=e.useState([]),[o,d]=e.useState(!1),[m,x]=e.useState(!1),u="admin"===t?.role;e.useEffect(()=>{u&&p()},[u]);const p=async()=>{d(!0);try{const{data:e,error:s}=await r.auth.admin.listUsers();if(s)throw new Error(`Erreur Auth: ${s.message}`);const{data:t,error:a}=await r.from("profiles").select('id, email, name, role, "function", created_at, updated_at');if(a)throw new Error(`Erreur données: ${a.message}`);const l=t.map(s=>{const t=e.users.find(e=>e.email===s.email);return{id:s.id,email:s.email,name:s.name||"Nom non défini",role:s.role||"user",function:s.function||"Non définie",created_at:s.created_at,updated_at:s.updated_at,isFirstLogin:!1,auth_id:t?.id||null,last_sign_in_at:t?.last_sign_in_at||null,email_confirmed_at:t?.email_confirmed_at||null,password_updated_at:t?.user_metadata?.password_updated_at||null,password_hash:"gerant"===s.role||"Gerant"===s.function?"*** MASQUÉ POUR SÉCURITÉ ***":t?.encrypted_password?"Mot de passe hashé (bcrypt)":"Non défini",is_password_hashed:Boolean(t?.encrypted_password)}});c(l)}catch(e){i({variant:"destructive",title:"Erreur",description:`Impossible de charger l'historique des comptes: ${e.message}`})}finally{d(!1)}},h=e=>e?new Date(e).toLocaleString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Non disponible",b=e=>{switch(e){case"admin":return"bg-red-500/20 text-red-300 border-red-500/30";case"gerant":return"bg-purple-500/20 text-purple-300 border-purple-500/30";case"avocat":return"bg-blue-500/20 text-blue-300 border-blue-500/30";case"secretaire":return"bg-green-500/20 text-green-300 border-green-500/30";default:return"bg-gray-500/20 text-gray-300 border-gray-500/30"}};return u?o?s.jsxs("div",{className:"flex items-center justify-center py-8",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"}),s.jsx("span",{className:"ml-2 text-slate-300",children:"Chargement de l'historique..."})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(z,{className:"w-6 h-6 text-purple-400"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-white",children:"Historique des Comptes"}),s.jsx("p",{className:"text-slate-400 text-sm",children:"Liste complète de tous les utilisateurs et leurs informations de sécurité"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs(a,{onClick:()=>x(!m),variant:"outline",size:"sm",className:"border-slate-600",children:[m?s.jsx(E,{className:"w-4 h-4 mr-2"}):s.jsx(A,{className:"w-4 h-4 mr-2"}),m?"Masquer mots de passe":"Voir mots de passe"]}),s.jsxs(a,{onClick:p,className:"bg-purple-600 hover:bg-purple-700",children:[s.jsx(z,{className:"w-4 h-4 mr-2"}),"Actualiser"]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 border border-slate-700",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(_,{className:"w-8 h-8 text-blue-400"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-400",children:"Total Utilisateurs"}),s.jsx("p",{className:"text-2xl font-bold text-white",children:n.length})]})]})}),s.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 border border-slate-700",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(v,{className:"w-8 h-8 text-red-400"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-400",children:"Administrateurs"}),s.jsx("p",{className:"text-2xl font-bold text-white",children:n.filter(e=>"admin"===e.role).length})]})]})}),s.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 border border-slate-700",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(P,{className:"w-8 h-8 text-yellow-400"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-400",children:"Première Connexion"}),s.jsx("p",{className:"text-2xl font-bold text-white",children:"0"})]})]})}),s.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 border border-slate-700",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(q,{className:"w-8 h-8 text-green-400"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-400",children:"Mots de passe hashés"}),s.jsx("p",{className:"text-2xl font-bold text-white",children:n.filter(e=>e.is_password_hashed).length})]})]})})]}),s.jsx("div",{className:"space-y-4",children:0===n.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(_,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-xl font-medium text-white mb-2",children:"Aucun utilisateur trouvé"}),s.jsx("p",{className:"text-slate-400",children:"L'historique des comptes est vide."})]}):n.map(e=>s.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(F,{className:"w-8 h-8 text-purple-400"}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-white",children:e.name}),s.jsxs("p",{className:"text-slate-300 flex items-center gap-1",children:[s.jsx(L,{className:"w-4 h-4"}),e.email]})]})]}),s.jsx("div",{className:"flex flex-col gap-2",children:s.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${b(e.role)}`,children:e.role})})]}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-slate-400",children:"Fonction:"}),s.jsx("span",{className:"text-slate-300",children:e.function})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-slate-400",children:"Compte créé:"}),s.jsx("span",{className:"text-slate-300",children:h(e.created_at)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-slate-400",children:"Dernière modification:"}),s.jsx("span",{className:"text-slate-300",children:h(e.updated_at)})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx(P,{className:"w-5 h-5 text-amber-400"}),s.jsx("h4",{className:"font-medium text-white",children:"Informations de Sécurité"})]}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-slate-400",children:"Dernière connexion:"}),s.jsx("span",{className:"text-slate-300",children:h(e.last_sign_in_at)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-slate-400",children:"Email confirmé:"}),s.jsx("span",{className:e.email_confirmed_at?"text-green-300":"text-red-300",children:e.email_confirmed_at?h(e.email_confirmed_at):"Non confirmé"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-slate-400",children:"MDP mis à jour:"}),s.jsx("span",{className:"text-slate-300",children:h(e.password_updated_at)})]})]}),s.jsxs("div",{className:"pt-3 border-t border-slate-600/50",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(v,{className:"w-4 h-4 text-red-400"}),s.jsx("span",{className:"text-slate-400 text-sm",children:"Mot de passe:"})]}),m?s.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-3",children:[s.jsx("p",{className:"text-slate-300 text-sm font-mono break-all",children:e.password_hash}),e.is_password_hashed&&s.jsx("p",{className:"text-amber-400 text-xs mt-1",children:"⚠️ Mot de passe crypté - Ne peut pas être déchiffré"})]}):s.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-3",children:[s.jsx("p",{className:"text-slate-500 text-sm",children:"••••••••••••••••"}),s.jsx("p",{className:"text-slate-400 text-xs mt-1",children:'Cliquez sur "Voir mots de passe" pour afficher'})]})]})]})]}),("gerant"===e.role||"Gerant"===e.function)&&s.jsx("div",{className:"mt-4 p-3 bg-purple-500/10 border border-purple-500/30 rounded-lg",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(v,{className:"w-4 h-4 text-purple-400"}),s.jsx("span",{className:"text-purple-300 text-sm font-medium",children:"Sécurité renforcée : Les informations sensibles du gérant sont masquées"})]})})]},e.id))})]}):s.jsxs("div",{className:"text-center py-20",children:[s.jsx(v,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Accès Restreint"}),s.jsx("p",{className:"text-slate-400 mb-2",children:"Seuls les Administrateurs peuvent accéder à l'historique des comptes."}),s.jsxs("p",{className:"text-slate-500 text-sm",children:["Votre rôle actuel : ",t?.role||"Non défini"]})]})},ee=()=>{const{companyInfo:t,loading:l}=n(),[o,d]=e.useState({name:"",logo_url:"",address:"",phone:"",email:"",slogan:"",description:""}),[m,x]=e.useState(!1),[u,p]=e.useState(!1),[h,b]=e.useState(null),j=e.useRef(null);e.useEffect(()=>{t&&(d(t),b(t.logo_url||null))},[t]);const v=(e,s)=>{d(t=>({...t,[e]:s}))};return l?s.jsx("div",{className:"text-slate-400 text-center py-8",children:"Chargement..."}):s.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx(I,{className:"w-6 h-6 text-purple-400"}),s.jsx("h2",{className:"text-xl font-semibold text-white",children:"Informations de l'entreprise"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Nom de l'entreprise"}),s.jsx("input",{type:"text",value:o.name,onChange:e=>v("name",e.target.value),placeholder:"Cabinet d'Avocats...",className:"w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Logo de l'entreprise"}),s.jsx("p",{className:"text-xs text-slate-400 mb-3",children:"Le logo apparaîtra sur l'écran de connexion, dans la barre latérale et sur les documents exportés"}),h&&s.jsxs("div",{className:"mb-4 relative inline-block",children:[s.jsx("div",{className:"bg-white/10 p-4 rounded-lg border border-slate-600",children:s.jsx("img",{src:h,alt:"Logo de l'entreprise",className:"h-24 max-w-[200px] object-contain",onError:e=>{e.target.src="",e.target.alt="Erreur de chargement"}})}),s.jsx(a,{onClick:()=>{d(e=>({...e,logo_url:""})),b(null),j.current&&(j.current.value="")},variant:"ghost",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full bg-red-500 hover:bg-red-600 text-white",children:s.jsx(w,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{ref:j,type:"file",accept:"image/png,image/jpeg,image/jpg,image/svg+xml",onChange:async e=>{const s=e.target.files?.[0];if(!s)return;if(["image/png","image/jpeg","image/jpg","image/svg+xml"].includes(s.type))if(s.size>2097152)i({variant:"destructive",title:"❌ Fichier trop volumineux",description:"La taille maximale est de 2 Mo."});else{p(!0);try{const e=s.name.trim().replace(/[\)\]\}]+\s*$/g,""),t=e.lastIndexOf(".");let a="png";if(t>0){a=e.substring(t+1).replace(/[^a-z0-9]/gi,"").toLowerCase()}const l=`company-logos/${`logo-${Date.now()}.${a}`}`,{data:n,error:c}=await r.storage.from("attachments").upload(l,s,{cacheControl:"3600",upsert:!1});if(c)throw c;const{data:o}=r.storage.from("attachments").getPublicUrl(l),m=o.publicUrl;d(e=>({...e,logo_url:m})),b(m),i({title:"✅ Logo téléchargé",description:"Le logo a été uploadé avec succès. N'oubliez pas de sauvegarder."})}catch(t){i({variant:"destructive",title:"❌ Erreur d'upload",description:"Impossible de télécharger le logo."})}finally{p(!1)}}else i({variant:"destructive",title:"❌ Format invalide",description:"Seuls les formats PNG, JPG, JPEG et SVG sont acceptés."})},className:"hidden"}),s.jsxs(a,{type:"button",onClick:()=>j.current?.click(),disabled:u,variant:"outline",className:"border-slate-600 text-slate-300 hover:bg-slate-700",children:[s.jsx(T,{className:"w-4 h-4 mr-2"}),u?"Upload en cours...":"Télécharger un fichier"]}),s.jsxs("span",{className:"flex items-center text-xs text-slate-500",children:[s.jsx(U,{className:"w-3 h-3 mr-1"}),"PNG, JPG, SVG (max 2 Mo)"]})]}),s.jsxs("div",{className:"mt-3",children:[s.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Ou entrez une URL"}),s.jsx("input",{type:"text",value:o.logo_url,onChange:e=>{v("logo_url",e.target.value),b(e.target.value||null)},placeholder:"https://exemple.com/logo.png",className:"w-full px-3 py-2 text-sm bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Adresse"}),s.jsx("textarea",{value:o.address,onChange:e=>v("address",e.target.value),placeholder:"123 Rue de la Justice, 75001 Paris",rows:3,className:"w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Téléphone"}),s.jsx("input",{type:"tel",value:o.phone,onChange:e=>v("phone",e.target.value),placeholder:"+33 1 23 45 67 89",className:"w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Email"}),s.jsx("input",{type:"email",value:o.email,onChange:e=>v("email",e.target.value),placeholder:"contact@cabinet.fr",className:"w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Slogan"}),s.jsx("input",{type:"text",value:o.slogan,onChange:e=>v("slogan",e.target.value),placeholder:"Votre partenaire juridique de confiance",className:"w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Description"}),s.jsx("textarea",{value:o.description,onChange:e=>v("description",e.target.value),placeholder:"Description détaillée de votre cabinet...",rows:4,className:"w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),s.jsx("div",{className:"flex justify-end pt-4",children:s.jsxs(a,{onClick:async()=>{x(!0);(await c(o)).success?i({title:"✅ Informations sauvegardées",description:"Les informations de l'entreprise ont été mises à jour."}):i({variant:"destructive",title:"❌ Erreur",description:"Impossible de sauvegarder les informations."}),x(!1)},disabled:m,size:"lg",className:"bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700",children:[s.jsx(f,{className:"w-5 h-5 mr-2"}),m?"Sauvegarde...":"Sauvegarder"]})})]})},se=()=>{const{menuConfig:t,loading:l}=o(),[r,n]=e.useState([]),[c,m]=e.useState(!1);e.useEffect(()=>{t?.items&&n([...t.items].sort((e,s)=>e.order-s.order))},[t]);const x=(e,s)=>{const t=[...r],a="up"===s?e-1:e+1;a<0||a>=t.length||([t[e],t[a]]=[t[a],t[e]],t.forEach((e,s)=>{e.order=s+1}),n(t))};return l?s.jsx("div",{className:"text-slate-400 text-center py-8",children:"Chargement..."}):s.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx($,{className:"w-6 h-6 text-blue-400"}),s.jsx("h2",{className:"text-xl font-semibold text-white",children:"Configuration du menu"})]}),s.jsx("div",{className:"bg-slate-700/30 rounded-lg p-4 mb-6",children:s.jsx("p",{className:"text-slate-300 text-sm",children:"✨ Activez/désactivez les sections du menu et réorganisez leur ordre d'affichage."})}),s.jsx("div",{className:"space-y-3",children:r.map((e,t)=>s.jsxs(g.div,{layout:!0,className:"flex items-center gap-3 p-4 rounded-lg border "+(e.enabled?"bg-slate-700/50 border-slate-600":"bg-slate-800/30 border-slate-700/50 opacity-60"),children:[s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("button",{onClick:()=>x(t,"up"),disabled:0===t,className:"text-slate-500 hover:text-slate-300 disabled:opacity-30 disabled:cursor-not-allowed",children:s.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{d:"M10 5l-7 7h14l-7-7z"})})}),s.jsx(M,{className:"w-4 h-4 text-slate-500"}),s.jsx("button",{onClick:()=>x(t,"down"),disabled:t===r.length-1,className:"text-slate-500 hover:text-slate-300 disabled:opacity-30 disabled:cursor-not-allowed",children:s.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{d:"M10 15l7-7H3l7 7z"})})})]}),s.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-slate-600 text-slate-300 text-sm font-semibold",children:e.order}),s.jsxs("div",{className:"flex-grow",children:[s.jsx("span",{className:"font-medium "+(e.enabled?"text-white":"text-slate-500"),children:e.label}),s.jsxs("span",{className:"ml-2 text-xs text-slate-500",children:["(",e.id,")"]})]}),s.jsx(a,{onClick:()=>{return s=e.id,void n(e=>e.map(e=>e.id===s?{...e,enabled:!e.enabled}:e));var s},variant:e.enabled?"outline":"ghost",size:"sm",className:e.enabled?"border-green-500 text-green-400":"text-slate-500",children:e.enabled?s.jsxs(s.Fragment,{children:[s.jsx(A,{className:"w-4 h-4 mr-2"}),"Activé"]}):s.jsxs(s.Fragment,{children:[s.jsx(E,{className:"w-4 h-4 mr-2"}),"Désactivé"]})})]},e.id))}),s.jsx("div",{className:"bg-slate-700/30 rounded-lg p-4 border border-slate-600",children:s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsxs("span",{className:"text-slate-400",children:["Total : ",s.jsx("span",{className:"text-white font-semibold",children:r.length})," sections"]}),s.jsxs("span",{className:"text-slate-400",children:["Activées : ",s.jsx("span",{className:"text-green-400 font-semibold",children:r.filter(e=>e.enabled).length})]}),s.jsxs("span",{className:"text-slate-400",children:["Désactivées : ",s.jsx("span",{className:"text-red-400 font-semibold",children:r.filter(e=>!e.enabled).length})]})]})}),s.jsx("div",{className:"flex justify-end pt-4",children:s.jsxs(a,{onClick:async()=>{m(!0);(await d({items:r})).success?i({title:"✅ Configuration sauvegardée",description:"La configuration du menu a été mise à jour."}):i({variant:"destructive",title:"❌ Erreur",description:"Impossible de sauvegarder la configuration."}),m(!1)},disabled:c,size:"lg",className:"bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-600 hover:to-cyan-700",children:[s.jsx(f,{className:"w-5 h-5 mr-2"}),c?"Sauvegarde...":"Sauvegarder"]})})]})},te=()=>{const{categoriesConfig:t,loading:l}=m(),[r,n]=e.useState({task_categories:[],case_types:[],document_types:[],user_roles:[],task_statuses:[],case_statuses:[]}),[c,o]=e.useState("task_categories"),[d,u]=e.useState({value:"",label:"",color:""}),[p,h]=e.useState(!1);e.useEffect(()=>{t&&n(t)},[t]);if(l)return s.jsx("div",{className:"text-slate-400 text-center py-8",children:"Chargement..."});const b=[{key:"task_categories",label:"Catégories de tâches",hasColor:!1},{key:"case_types",label:"Types de dossiers",hasColor:!1},{key:"document_types",label:"Types de document",hasColor:!1},{key:"user_roles",label:"Rôles utilisateurs",hasColor:!1},{key:"task_statuses",label:"Statuts de tâches",hasColor:!0},{key:"case_statuses",label:"Statuts de dossiers",hasColor:!0}],j=b.find(e=>e.key===c);return s.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx(G,{className:"w-6 h-6 text-green-400"}),s.jsx("h2",{className:"text-xl font-semibold text-white",children:"Gestion des catégories"})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(e=>s.jsx("button",{onClick:()=>o(e.key),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors "+(c===e.key?"bg-green-500 text-white":"bg-slate-700/50 text-slate-300 hover:bg-slate-700"),children:e.label},e.key))}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("h3",{className:"text-lg font-medium text-white",children:j?.label}),r[c]?.map(e=>s.jsxs("div",{className:"flex items-center justify-between bg-slate-700/50 p-3 rounded-lg border border-slate-600",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[e.color&&s.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:e.color}}),s.jsxs("div",{children:[s.jsx("span",{className:"text-white font-medium",children:e.label}),s.jsxs("span",{className:"ml-2 text-xs text-slate-500",children:["(",e.value,")"]})]})]}),s.jsx(a,{onClick:()=>{return s=c,t=e.value,void n(e=>({...e,[s]:e[s].filter(e=>e.value!==t)}));var s,t},variant:"ghost",size:"icon",className:"text-red-400 hover:text-red-300",children:s.jsx(D,{className:"w-4 h-4"})})]},e.value)),0===r[c]?.length&&s.jsx("div",{className:"text-center py-8 text-slate-500",children:"Aucun élément. Ajoutez-en un ci-dessous."})]}),s.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4 border border-slate-600",children:[s.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-3",children:"Ajouter un nouvel élément"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[s.jsx("input",{type:"text",value:d.label,onChange:e=>u(s=>({...s,label:e.target.value})),placeholder:"Label (ex: Avocat Senior)",className:"px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-green-500"}),s.jsx("input",{type:"text",value:d.value,onChange:e=>u(s=>({...s,value:e.target.value})),placeholder:"Valeur (ex: avocat_senior) - optionnel",className:"px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-green-500"})]}),j?.hasColor&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("label",{className:"text-sm text-slate-400",children:"Couleur :"}),s.jsx("input",{type:"color",value:d.color||"#6366f1",onChange:e=>u(s=>({...s,color:e.target.value})),className:"h-10 w-20 rounded border border-slate-600 cursor-pointer"}),s.jsx("span",{className:"text-xs text-slate-500",children:d.color||"#6366f1"})]}),s.jsxs(a,{onClick:()=>{if(!d.label.trim())return void i({variant:"destructive",title:"Erreur",description:"Le label est requis."});const e={value:d.value||d.label.toLowerCase().replace(/\s+/g,"_"),label:d.label,...d.color&&{color:d.color}};n(s=>({...s,[c]:[...s[c],e]})),u({value:"",label:"",color:""})},className:"w-full bg-green-500 hover:bg-green-600",children:[s.jsx(k,{className:"w-4 h-4 mr-2"}),"Ajouter"]})]})]}),s.jsx("div",{className:"flex justify-end pt-4",children:s.jsxs(a,{onClick:async()=>{h(!0);(await x(r)).success?i({title:"✅ Catégories sauvegardées",description:"Les catégories ont été mises à jour."}):i({variant:"destructive",title:"❌ Erreur",description:"Impossible de sauvegarder les catégories."}),h(!1)},disabled:p,size:"lg",className:"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700",children:[s.jsx(f,{className:"w-5 h-5 mr-2"}),p?"Sauvegarde...":"Sauvegarder toutes les catégories"]})})]})},ae=[{id:"dashboard",label:"Tableau de Bord"},{id:"tasks",label:"Tâches"},{id:"clients",label:"Clients"},{id:"cases",label:"Dossiers"},{id:"calendar",label:"Agenda"},{id:"documents",label:"Documents"},{id:"billing",label:"Facturation"},{id:"team",label:"Collaborateurs"},{id:"reports",label:"Statistiques"},{id:"settings",label:"Paramètres"}],le=[{id:"admin",label:"Administrateur",color:"red"},{id:"gerant",label:"Gérant",color:"red"},{id:"avocat",label:"Avocat",color:"blue"},{id:"secretaire",label:"Secrétaire",color:"green"},{id:"user",label:"Utilisateur",color:"gray"}],re=()=>{const{users:t,fetchUsers:l,saveUserPermissions:r}=h(),[n,c]=e.useState("avocat"),[o,d]=e.useState({}),[m,x]=e.useState(!1);e.useEffect(()=>{l()},[]),e.useEffect(()=>{const e=b[n]||{};d(e),x(!1)},[n]);const j=le.find(e=>e.id===n),v=Object.values(o).filter(e=>e.visible).length;return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(R,{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"}),s.jsxs("div",{className:"text-sm text-slate-300",children:[s.jsx("p",{className:"font-medium text-white mb-1",children:"Gestion des permissions par rôle"}),s.jsx("p",{children:"Configurez les modules du menu visibles pour chaque rôle. Les modifications s'appliquent à tous les utilisateurs du rôle sélectionné."})]})]})}),s.jsxs("div",{children:[s.jsx(u,{className:"text-slate-300 mb-3 block",children:"Sélectionner un rôle"}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:le.map(e=>{const a=t.filter(s=>s.role===e.id).length,l=n===e.id;return s.jsxs(g.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>c(e.id),className:"p-4 rounded-lg border-2 transition-all "+(l?`border-${e.color}-500 bg-${e.color}-500/20`:"border-slate-600 bg-slate-700/30 hover:border-slate-500"),children:[s.jsx("p",{className:"font-medium "+(l?"text-white":"text-slate-300"),children:e.label}),s.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:[a," utilisateur",1!==a?"s":""]})]},e.id)})})]}),s.jsxs("div",{className:"border-t border-slate-700 pt-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-white font-semibold text-lg",children:['Modules du menu pour "',j?.label,'"']}),s.jsxs("p",{className:"text-sm text-slate-400 mt-1",children:[v,"/",ae.length," modules visibles"]})]}),m&&s.jsxs(a,{onClick:async()=>{try{const e=t.filter(e=>e.role===n);if(0===e.length)return void i({title:"⚠️ Aucun utilisateur",description:`Aucun utilisateur n'a le rôle "${le.find(e=>e.id===n)?.label}".`});let s=0;for(const t of e){(await r(t.id,o)).success&&s++}s===e.length?(i({title:"✅ Permissions appliquées",description:`${s} utilisateur(s) mis à jour avec succès.`}),x(!1)):i({variant:"destructive",title:"⚠️ Application partielle",description:`${s}/${e.length} utilisateurs mis à jour.`})}catch(e){i({variant:"destructive",title:"Erreur",description:"Impossible de sauvegarder les permissions."})}},className:"bg-green-600 hover:bg-green-700",children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),"Sauvegarder"]})]}),s.jsx("div",{className:"grid gap-3",children:ae.map(e=>{const t=o[e.id]?.visible||!1;return s.jsx(g.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"p-4 rounded-lg border transition-all "+(t?"bg-slate-700/50 border-slate-600":"bg-slate-800/30 border-slate-700/50 opacity-60"),children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[t?s.jsx(A,{className:"w-5 h-5 text-green-400"}):s.jsx(E,{className:"w-5 h-5 text-slate-500"}),s.jsx(u,{className:"text-white font-medium cursor-pointer",children:e.label})]}),s.jsx(p,{checked:t,onCheckedChange:()=>{return s=e.id,d(e=>{const t=structuredClone(e);return t[s]||(t[s]={visible:!1,actions:{}}),t[s].visible=!t[s].visible,!t[s].visible&&t[s].actions&&Object.keys(t[s].actions).forEach(e=>{t[s].actions[e]=!1}),t}),void x(!0);var s}})]})},e.id)})})]}),m&&s.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(R,{className:"w-5 h-5 text-yellow-400 flex-shrink-0"}),s.jsxs("p",{className:"text-sm text-slate-300",children:["Vous avez des modifications non sauvegardées. Cliquez sur ",s.jsx("strong",{children:"Sauvegarder"})," pour les appliquer."]})]})})]})},ie=()=>{const[t,l]=e.useState("dark"),[r,n]=e.useState("blue"),[c,o]=e.useState(15),[d,m]=e.useState(!1);e.useEffect(()=>{const e=localStorage.getItem("app_theme")||"dark",s=localStorage.getItem("app_accent_color")||"blue",t=localStorage.getItem("app_auto_logout_minutes")||"15";l(e),n(s),o(parseInt(t))},[]);const x=[{value:"light",label:"Clair",icon:J,description:"Fond clair avec texte sombre"},{value:"dark",label:"Sombre",icon:B,description:"Fond sombre avec texte clair"},{value:"auto",label:"Automatique",icon:O,description:"Suit les préférences système"}],u=[{value:"blue",label:"Bleu",color:"#3b82f6",bgClass:"bg-blue-500"},{value:"green",label:"Vert",color:"#10b981",bgClass:"bg-green-500"},{value:"purple",label:"Violet",color:"#8b5cf6",bgClass:"bg-purple-500"},{value:"red",label:"Rouge",color:"#ef4444",bgClass:"bg-red-500"},{value:"yellow",label:"Jaune",color:"#f59e0b",bgClass:"bg-yellow-500"}];return s.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-8",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx(V,{className:"w-6 h-6 text-purple-400"}),s.jsx("h2",{className:"text-xl font-semibold text-white",children:"Apparence"})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Thème"}),s.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"Choisissez le thème d'affichage de l'application"})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:x.map(e=>{const a=e.icon,r=t===e.value;return s.jsxs(g.button,{onClick:()=>l(e.value),whileHover:{scale:1.02},whileTap:{scale:.98},className:"relative p-4 rounded-xl border-2 transition-all "+(r?"border-purple-500 bg-purple-500/10":"border-slate-700 bg-slate-800/50 hover:border-slate-600"),children:[r&&s.jsx("div",{className:"absolute top-3 right-3",children:s.jsx("div",{className:"w-6 h-6 rounded-full bg-purple-500 flex items-center justify-center",children:s.jsx(H,{className:"w-4 h-4 text-white"})})}),s.jsxs("div",{className:"flex flex-col items-center text-center space-y-3",children:[s.jsx("div",{className:"p-3 rounded-lg "+(r?"bg-purple-500/20":"bg-slate-700/50"),children:s.jsx(a,{className:"w-8 h-8 "+(r?"text-purple-400":"text-slate-400")})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium "+(r?"text-purple-300":"text-white"),children:e.label}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:e.description})]})]})]},e.value)})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Couleur d'accentuation"}),s.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"Personnalisez la couleur principale de l'interface"})]}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:u.map(e=>{const t=r===e.value;return s.jsxs(g.button,{onClick:()=>n(e.value),whileHover:{scale:1.05},whileTap:{scale:.95},className:"relative p-4 rounded-xl border-2 transition-all "+(t?"border-slate-400 bg-slate-700/50":"border-slate-700 bg-slate-800/50 hover:border-slate-600"),children:[t&&s.jsx("div",{className:"absolute top-2 right-2",children:s.jsx("div",{className:"w-5 h-5 rounded-full bg-white flex items-center justify-center",children:s.jsx(H,{className:"w-3 h-3 text-slate-900"})})}),s.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[s.jsx("div",{className:`w-12 h-12 rounded-full ${e.bgClass} shadow-lg`,style:{backgroundColor:e.color}}),s.jsx("p",{className:"text-sm font-medium "+(t?"text-white":"text-slate-300"),children:e.label})]})]},e.value)})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Déconnexion automatique"}),s.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"Configurez le délai d'inactivité avant déconnexion automatique pour plus de sécurité"})]}),s.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"Délai d'inactivité"}),s.jsxs("select",{value:c,onChange:e=>o(parseInt(e.target.value)),className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500 cursor-pointer",children:[s.jsx("option",{value:5,children:"5 minutes"}),s.jsx("option",{value:10,children:"10 minutes"}),s.jsx("option",{value:15,children:"15 minutes (recommandé)"}),s.jsx("option",{value:30,children:"30 minutes"}),s.jsx("option",{value:60,children:"60 minutes"})]}),s.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"⚠️ Un avertissement apparaîtra 1 minute avant la déconnexion"})]})]}),s.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6",children:[s.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-4",children:"Aperçu des préférences"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`w-4 h-4 rounded-full ${u.find(e=>e.value===r)?.bgClass}`}),s.jsxs("span",{className:"text-sm text-slate-400",children:["Couleur d'accentuation : ",s.jsx("span",{className:"text-white font-medium",children:u.find(e=>e.value===r)?.label})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:["light"===t&&s.jsx(J,{className:"w-4 h-4 text-slate-400"}),"dark"===t&&s.jsx(B,{className:"w-4 h-4 text-slate-400"}),"auto"===t&&s.jsx(O,{className:"w-4 h-4 text-slate-400"}),s.jsxs("span",{className:"text-sm text-slate-400",children:["Thème : ",s.jsx("span",{className:"text-white font-medium",children:x.find(e=>e.value===t)?.label})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(q,{className:"w-4 h-4 text-slate-400"}),s.jsxs("span",{className:"text-sm text-slate-400",children:["Déconnexion auto : ",s.jsxs("span",{className:"text-white font-medium",children:[c," minutes"]})]})]})]})]}),s.jsx("div",{className:"flex justify-end pt-4",children:s.jsxs(a,{onClick:async()=>{m(!0),localStorage.setItem("app_theme",t),localStorage.setItem("app_accent_color",r),localStorage.setItem("app_auto_logout_minutes",c.toString()),await new Promise(e=>setTimeout(e,500)),i({title:"✅ Apparence sauvegardée",description:"Vos préférences ont été enregistrées. Rechargez la page pour appliquer le délai de déconnexion."}),m(!1)},disabled:d,size:"lg",className:"bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700",children:[s.jsx(f,{className:"w-5 h-5 mr-2"}),d?"Sauvegarde...":"Enregistrer les préférences"]})})]})},ne=()=>{const{user:t}=l(),[n,c]=e.useState([]),[o,d]=e.useState(""),[m,x]=e.useState("permissions"),u=t&&("Gerant"===t.function||"Associe Emerite"===t.function||"admin"===t.role||"gerant"===t.role),p="admin"===t?.role;e.useEffect(()=>{u&&h()},[u]);const h=async()=>{const{data:e,error:s}=await r.from("app_settings").select("categories_config").single();s||e?.categories_config?.task_categories&&c(e.categories_config.task_categories)};return u?s.jsxs("div",{className:"space-y-8",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Paramètres"}),s.jsx("p",{className:"text-slate-400",children:"Gérez les configurations de l'application."}),s.jsx("div",{className:"mt-2 inline-flex items-center gap-2 px-3 py-1.5 bg-purple-500/10 border border-purple-500/30 rounded-lg",children:s.jsxs("span",{className:"text-xs text-purple-300",children:["💡 ",s.jsx("strong",{children:"Info :"})," Cette section gère les ",s.jsx("strong",{children:"paramètres système"})," de l'application (entreprise, apparence, permissions)"]})})]}),s.jsx("div",{className:"border-b border-slate-700",children:s.jsxs("nav",{className:"flex flex-wrap space-x-4 md:space-x-8",children:[s.jsxs("button",{onClick:()=>x("company"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("company"===m?"border-purple-500 text-purple-400":"border-transparent text-slate-400 hover:text-slate-300"),children:[s.jsx(I,{className:"w-4 h-4 inline mr-2"}),"Entreprise"]}),s.jsxs("button",{onClick:()=>x("menu"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("menu"===m?"border-blue-500 text-blue-400":"border-transparent text-slate-400 hover:text-slate-300"),children:[s.jsx($,{className:"w-4 h-4 inline mr-2"}),"Menu"]}),s.jsxs("button",{onClick:()=>x("advanced-categories"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("advanced-categories"===m?"border-green-500 text-green-400":"border-transparent text-slate-400 hover:text-slate-300"),children:[s.jsx(G,{className:"w-4 h-4 inline mr-2"}),"Catégories avancées"]}),s.jsxs("button",{onClick:()=>x("appearance"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("appearance"===m?"border-purple-500 text-purple-400":"border-transparent text-slate-400 hover:text-slate-300"),children:[s.jsx(V,{className:"w-4 h-4 inline mr-2"}),"Apparence"]}),s.jsxs("button",{onClick:()=>x("permissions"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("permissions"===m?"border-orange-500 text-orange-400":"border-transparent text-slate-400 hover:text-slate-300"),children:[s.jsx(v,{className:"w-4 h-4 inline mr-2"}),"Permissions"]}),s.jsxs("button",{onClick:()=>x("menu-permissions"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("menu-permissions"===m?"border-indigo-500 text-indigo-400":"border-transparent text-slate-400 hover:text-slate-300"),children:[s.jsx($,{className:"w-4 h-4 inline mr-2"}),"Permissions Menu"]}),p&&s.jsxs("button",{onClick:()=>x("admin"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("admin"===m?"border-red-500 text-red-400":"border-transparent text-slate-400 hover:text-slate-300"),children:[s.jsx(z,{className:"w-4 h-4 inline mr-2"}),"Admin"]}),s.jsxs("button",{onClick:()=>x("categories"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("categories"===m?"border-cyan-500 text-cyan-400":"border-transparent text-slate-400 hover:text-slate-300"),children:[s.jsx(K,{className:"w-4 h-4 inline mr-2"}),"Catégories (legacy)"]})]})}),"company"===m&&s.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6",children:s.jsx(ee,{})}),"menu"===m&&s.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6",children:s.jsx(se,{})}),"advanced-categories"===m&&s.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6",children:s.jsx(te,{})}),"appearance"===m&&s.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6",children:s.jsx(ie,{})}),"permissions"===m&&s.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6",children:s.jsx(Y,{})}),"menu-permissions"===m&&s.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6",children:s.jsx(re,{})}),"admin"===m&&p&&s.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6",children:s.jsx(Z,{})}),"categories"===m&&s.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx(K,{className:"w-6 h-6 text-blue-400"}),s.jsx("h2",{className:"text-xl font-semibold text-white",children:"Catégories de Tâches"})]}),s.jsx("div",{className:"space-y-3 mb-4",children:n.map(e=>s.jsxs("div",{className:"flex items-center justify-between bg-slate-700/50 p-3 rounded-lg",children:[s.jsx("span",{className:"text-slate-300",children:e.label}),s.jsx(a,{variant:"ghost",size:"icon",onClick:()=>{var s;window.confirm(`Voulez-vous vraiment supprimer la catégorie "${e.label}" ?\n\nCette action est irréversible.`)&&(s=e.value,c(n.filter(e=>e.value!==s)))},children:s.jsx(D,{className:"w-4 h-4 text-red-500"})})]},e.value))}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:o,onChange:e=>d(e.target.value),placeholder:"Nouvelle catégorie...",className:"flex-grow px-3 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsxs(a,{onClick:()=>{if(""===o.trim())return;const e={value:o.toLowerCase().replaceAll(/\s+/g,"-"),label:o};n.some(s=>s.value===e.value)?i({variant:"destructive",title:"Catégorie existante"}):(c([...n,e]),d(""))},className:"bg-blue-500 hover:bg-blue-600",children:[s.jsx(k,{className:"w-4 h-4 mr-2"})," Ajouter"]})]})]}),"categories"===m&&s.jsx("div",{className:"flex justify-end",children:s.jsxs(a,{onClick:async()=>{const{error:e}=await r.from("app_settings").upsert({id:1,categories_config:{task_categories:n}});if(e){if("PGRST205"===e.code||"42P01"===e.code)return void i({title:"⚠️ Fonctionnalité non disponible",description:"La table app_settings n'existe pas encore."});i({variant:"destructive",title:"Erreur",description:"Impossible de sauvegarder les paramètres."})}else i({title:"✅ Paramètres sauvegardés",description:"Vos modifications ont été enregistrées."})},size:"lg",className:"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700",children:[s.jsx(f,{className:"w-5 h-5 mr-2"})," Sauvegarder les Paramètres Généraux"]})})]}):s.jsxs("div",{className:"text-center py-20",children:[s.jsx(v,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Accès non autorisé"}),s.jsx("p",{className:"text-slate-400 mb-2",children:"Seuls les Gérants peuvent accéder à cette page."}),s.jsxs("p",{className:"text-slate-500 text-sm",children:["Votre rôle actuel : ",t?.role||"Non défini"," | Fonction : ",t?.function||"Non définie"]})]})};export{ne as default};
