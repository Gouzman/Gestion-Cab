import{r as e,f as s}from"./vendor-react-CWhE6-Gf.js";import{B as o,s as n,t,d as a}from"./index-BzUzpWLW.js";import{m as i,X as r,ao as l,F as m,ae as c,ap as u,a7 as d,_ as b,c as N,M as f,I as p,aq as v,J as x}from"./vendor-ui-BBpB3Q8s.js";import{c as g}from"./filePreviewUtils-C0dV8HzJ.js";import"./sentry-CxmcrLP_.js";import"./vendor-supabase-CR9Q8AJ3.js";import"./vendor-charts-BY8kkf7J.js";const D=({currentUser:a,onCancel:m,onDocumentUploaded:c})=>{const[u,d]=e.useState({document_reference:"",linked_case_id:"",category:"",description:"",file:null}),[b,N]=e.useState([]),[f,p]=e.useState(!1),v=e.useRef(null);e.useEffect(()=>{(async()=>{const{data:e,error:s}=await n.from("cases").select("id, title").order("created_at",{ascending:!1});s||N(e||[])})()},[]);const x=e=>{const{name:s,value:o}=e.target;d(e=>({...e,[s]:o}))},g=e=>{["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/png","image/jpeg"].includes(e.type)?e.size>10485760?t({variant:"destructive",title:"Fichier trop volumineux",description:"La taille maximale autorisÃ©e est de 10 Mo."}):(d(s=>({...s,file:e})),t({title:"ðŸ“Ž Fichier sÃ©lectionnÃ©",description:e.name})):t({variant:"destructive",title:"Format non autorisÃ©",description:"Seuls les formats PDF, DOCX, PNG et JPG sont acceptÃ©s."})};return s.jsxDEV(i.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",onClick:m,children:s.jsxDEV(i.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-slate-800 border border-slate-700 rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[s.jsxDEV("div",{className:"flex items-center justify-between mb-6",children:[s.jsxDEV("h2",{className:"text-2xl font-bold text-white",children:"TransfÃ©rer un document"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:251,columnNumber:11},void 0),s.jsxDEV(o,{variant:"ghost",size:"icon",onClick:m,className:"text-slate-400 hover:text-white",children:s.jsxDEV(r,{className:"w-5 h-5"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:258,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:252,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:250,columnNumber:9},void 0),s.jsxDEV("form",{onSubmit:async e=>{if(e.preventDefault(),u.document_reference.trim())if(u.category)if(u.file)try{const e=u.file.name.split(".").pop(),s=`documents/${`${Date.now()}-${Math.random().toString(36).substring(7)}.${e}`}`,o=await u.file.arrayBuffer(),{data:i,error:r}=await n.storage.from("task-files").upload(s,o,{cacheControl:"3600",upsert:!1,contentType:u.file.type});if(r){let e="Impossible de tÃ©lÃ©verser le fichier vers le stockage.";return r.message?.includes("Bucket not found")?e='Le bucket de stockage "task-files" n\'existe pas. Veuillez le crÃ©er dans Supabase Storage.':r.message?.includes("new row violates")&&(e="Erreur de permissions. VÃ©rifiez les politiques RLS du bucket."),void t({variant:"destructive",title:"Erreur d'upload",description:e})}const{data:{publicUrl:l}}=n.storage.from("task-files").getPublicUrl(s),d={task_id:null,case_id:u.linked_case_id||null,file_name:u.file.name,file_url:l,file_type:u.file.type,file_size:u.file.size,document_category:u.category,created_by:a.id},{data:b,error:N}=await n.from("tasks_files").insert([d]).select().single();if(N)return await n.storage.from("task-files").remove([s]),void t({variant:"destructive",title:"Erreur de sauvegarde",description:"Impossible d'enregistrer les mÃ©tadonnÃ©es du document."});t({title:"âœ… Document transfÃ©rÃ©",description:`"${u.file.name}" a Ã©tÃ© ajoutÃ© avec succÃ¨s.`}),c&&c(b),m()}catch(s){t({variant:"destructive",title:"Erreur",description:"Impossible de transfÃ©rer le document."})}else t({variant:"destructive",title:"Fichier manquant",description:"Veuillez sÃ©lectionner un fichier Ã  transfÃ©rer."});else t({variant:"destructive",title:"Champs requis",description:"Veuillez sÃ©lectionner une catÃ©gorie."});else t({variant:"destructive",title:"Champs requis",description:"La rÃ©fÃ©rence du document est obligatoire."})},className:"space-y-6",children:[s.jsxDEV("div",{onDragOver:e=>{e.preventDefault(),p(!0)},onDragLeave:e=>{e.preventDefault(),p(!1)},onDrop:e=>{e.preventDefault(),p(!1);const s=e.dataTransfer.files;s.length>0&&g(s[0])},className:"border-2 border-dashed rounded-lg p-12 text-center transition-colors "+(f?"border-indigo-500 bg-indigo-500/10":"border-slate-600 bg-slate-700/30"),children:[s.jsxDEV(l,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:274,columnNumber:13},void 0),s.jsxDEV("p",{className:"text-slate-300 mb-1",children:[s.jsxDEV("button",{type:"button",onClick:()=>v.current?.click(),className:"text-indigo-400 hover:text-indigo-300 hover:underline font-medium",children:"Cliquez pour transfÃ©rer"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:276,columnNumber:15},void 0)," ","ou glissez-dÃ©posez"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:275,columnNumber:13},void 0),s.jsxDEV("p",{className:"text-sm text-slate-400",children:"PDF, DOCX, PNG, JPG (MAX. 10MB)"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:285,columnNumber:13},void 0),u.file&&s.jsxDEV("p",{className:"mt-3 text-sm text-green-400 font-medium",children:["âœ“ ",u.file.name]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:289,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:264,columnNumber:11},void 0),s.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxDEV("div",{children:[s.jsxDEV("label",{htmlFor:"document-reference",className:"block text-sm font-medium text-slate-300 mb-2",children:"RÃ©f. Document *"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:298,columnNumber:15},void 0),s.jsxDEV("input",{type:"text",id:"document-reference",name:"document_reference",value:u.document_reference,onChange:x,required:!0,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"RÃ©fÃ©rence interne"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:301,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:297,columnNumber:13},void 0),s.jsxDEV("div",{children:[s.jsxDEV("label",{htmlFor:"linked-case",className:"block text-sm font-medium text-slate-300 mb-2",children:"Dossier associÃ©"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:315,columnNumber:15},void 0),s.jsxDEV("select",{id:"linked-case",name:"linked_case_id",value:u.linked_case_id,onChange:x,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[s.jsxDEV("option",{value:"",children:"Choisir un dossier..."},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:325,columnNumber:17},void 0),b.map(e=>s.jsxDEV("option",{value:e.id,children:[e.id," - ",e.title]},e.id,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:327,columnNumber:19},void 0))]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:318,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:314,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:295,columnNumber:11},void 0),s.jsxDEV("div",{children:[s.jsxDEV("label",{htmlFor:"category",className:"block text-sm font-medium text-slate-300 mb-2",children:"CatÃ©gorie *"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:337,columnNumber:13},void 0),s.jsxDEV("select",{id:"category",name:"category",value:u.category,onChange:x,required:!0,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[s.jsxDEV("option",{value:"",children:"SÃ©lectionner une catÃ©gorie..."},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:348,columnNumber:15},void 0),[{value:"Documents de suivi et facturation",label:"Documents de suivi et facturation"},{value:"PiÃ¨ces",label:"PiÃ¨ces"},{value:"Ã‰critures",label:"Ã‰critures"},{value:"Courriers",label:"Courriers"},{value:"Observations et notes",label:"Observations et notes"},{value:"Autres",label:"Autres"}].map(e=>s.jsxDEV("option",{value:e.value,children:e.label},e.value,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:350,columnNumber:17},void 0))]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:340,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:336,columnNumber:11},void 0),s.jsxDEV("div",{children:[s.jsxDEV("label",{htmlFor:"description",className:"block text-sm font-medium text-slate-300 mb-2",children:"Description"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:359,columnNumber:13},void 0),s.jsxDEV("textarea",{id:"description",name:"description",value:u.description,onChange:x,rows:4,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Ajouter une brÃ¨ve description du document..."},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:362,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:358,columnNumber:11},void 0),s.jsxDEV("input",{ref:v,type:"file",className:"hidden",accept:".pdf,.docx,.png,.jpg,.jpeg",onChange:e=>{const s=e.target.files;s.length>0&&g(s[0])}},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:374,columnNumber:11},void 0),s.jsxDEV("div",{className:"flex gap-4 pt-4",children:[s.jsxDEV(o,{type:"button",variant:"outline",onClick:m,className:"flex-1 border-slate-600 text-slate-300 hover:bg-slate-700",children:"Annuler"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:384,columnNumber:13},void 0),s.jsxDEV(o,{type:"submit",className:"flex-1 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white",children:"TransfÃ©rer"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:392,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:383,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:262,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:243,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentUploadModal.jsx",lineNumber:236,columnNumber:5},void 0)},h=({document:a,onCancel:l,onTransferred:u})=>{const[d,b]=e.useState(""),[N,f]=e.useState(!0),[p,v]=e.useState([]),[x,g]=e.useState(!1);e.useEffect(()=>{(async()=>{if(!a.caseId)return void t({variant:"destructive",title:"Erreur",description:"Ce document n'est pas liÃ© Ã  un dossier."});const{data:e,error:s}=await n.from("tasks").select("id, title, status").eq("case_id",a.caseId).order("created_at",{ascending:!1});s?t({variant:"destructive",title:"Erreur",description:"Impossible de charger les tÃ¢ches du dossier."}):v(e||[])})()},[a.caseId]);return s.jsxDEV(i.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:l,children:s.jsxDEV(i.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:e=>e.stopPropagation(),className:"bg-slate-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-slate-700",children:[s.jsxDEV("div",{className:"sticky top-0 bg-slate-800 border-b border-slate-700 px-6 py-4 flex items-center justify-between",children:[s.jsxDEV("div",{className:"flex items-center gap-3",children:[s.jsxDEV("div",{className:"w-10 h-10 bg-blue-500/10 rounded-lg flex items-center justify-center",children:s.jsxDEV(m,{className:"w-5 h-5 text-blue-400"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:163,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:162,columnNumber:13},void 0),s.jsxDEV("div",{children:[s.jsxDEV("h2",{className:"text-xl font-bold text-white",children:"TransfÃ©rer vers une tÃ¢che"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:166,columnNumber:15},void 0),s.jsxDEV("p",{className:"text-sm text-slate-400",children:a.name},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:167,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:165,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:161,columnNumber:11},void 0),s.jsxDEV(o,{variant:"ghost",size:"icon",onClick:l,children:s.jsxDEV(r,{className:"w-5 h-5 text-slate-400"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:171,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:170,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:160,columnNumber:9},void 0),s.jsxDEV("div",{className:"p-6 space-y-6",children:[s.jsxDEV("div",{children:[s.jsxDEV("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"TÃ¢che de destination *"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:179,columnNumber:13},void 0),s.jsxDEV("select",{value:d,onChange:e=>b(e.target.value),className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:x,children:[s.jsxDEV("option",{value:"",children:"SÃ©lectionner une tÃ¢che..."},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:188,columnNumber:15},void 0),p.map(e=>s.jsxDEV("option",{value:e.id,children:[e.title," (",e.status,")"]},e.id,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:190,columnNumber:17},void 0))]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:182,columnNumber:13},void 0),0===p.length&&s.jsxDEV("p",{className:"text-sm text-slate-500 mt-2",children:"Aucune tÃ¢che disponible dans ce dossier."},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:196,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:178,columnNumber:11},void 0),s.jsxDEV("div",{className:"bg-slate-700/30 rounded-lg p-4 border border-slate-600/50",children:s.jsxDEV("label",{className:"flex items-start gap-3 cursor-pointer",children:[s.jsxDEV("div",{className:"relative flex items-center",children:[s.jsxDEV("input",{type:"checkbox",checked:N,onChange:e=>f(e.target.checked),className:"sr-only peer",disabled:x},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:206,columnNumber:17},void 0),s.jsxDEV("div",{className:"w-5 h-5 border-2 border-slate-500 rounded peer-checked:bg-blue-500 peer-checked:border-blue-500 flex items-center justify-center transition-colors",children:N&&s.jsxDEV(c,{className:"w-3.5 h-3.5 text-white"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:214,columnNumber:42},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:213,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:205,columnNumber:15},void 0),s.jsxDEV("div",{className:"flex-1",children:[s.jsxDEV("div",{className:"font-medium text-white",children:"Visible par l'assignÃ© de la tÃ¢che"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:218,columnNumber:17},void 0),s.jsxDEV("div",{className:"text-sm text-slate-400 mt-1",children:"Si cochÃ©e, le document apparaÃ®tra dans l'onglet Documents de la tÃ¢che pour l'utilisateur assignÃ©. Sinon, le document reste liÃ© uniquement au dossier."},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:219,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:217,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:204,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:203,columnNumber:11},void 0),s.jsxDEV("div",{className:"bg-slate-700/20 rounded-lg p-4 border border-slate-600/30",children:[s.jsxDEV("h3",{className:"text-sm font-medium text-slate-300 mb-3",children:"Informations du document"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:229,columnNumber:13},void 0),s.jsxDEV("div",{className:"space-y-2 text-sm",children:[a.caseTitle&&s.jsxDEV("div",{className:"flex justify-between",children:[s.jsxDEV("span",{className:"text-slate-400",children:"Dossier :"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:233,columnNumber:19},void 0),s.jsxDEV("span",{className:"text-white font-medium",children:a.caseTitle},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:234,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:232,columnNumber:17},void 0),a.category&&s.jsxDEV("div",{className:"flex justify-between",children:[s.jsxDEV("span",{className:"text-slate-400",children:"CatÃ©gorie :"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:239,columnNumber:19},void 0),s.jsxDEV("span",{className:"text-blue-400",children:a.category},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:240,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:238,columnNumber:17},void 0),a.fileSize&&s.jsxDEV("div",{className:"flex justify-between",children:[s.jsxDEV("span",{className:"text-slate-400",children:"Taille :"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:245,columnNumber:19},void 0),s.jsxDEV("span",{className:"text-slate-300",children:[(a.fileSize/1048576).toFixed(2)," Mo"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:246,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:244,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:230,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:228,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:176,columnNumber:9},void 0),s.jsxDEV("div",{className:"sticky bottom-0 bg-slate-800 border-t border-slate-700 px-6 py-4 flex gap-3 justify-end",children:[s.jsxDEV(o,{variant:"ghost",onClick:l,disabled:x,className:"text-slate-300 hover:text-white",children:"Annuler"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:257,columnNumber:11},void 0),s.jsxDEV(o,{onClick:async()=>{if(d){g(!0);try{const{data:s,error:o}=await n.from("tasks_files").select("id").eq("file_url",a.url).eq("task_id",d);if(o)throw new Error(`Erreur de vÃ©rification: ${o.message}`);if(s&&s.length>0)return t({title:"DÃ©jÃ  liÃ©",description:"Ce document est dÃ©jÃ  liÃ© Ã  cette tÃ¢che."}),void g(!1);const i={task_id:d,case_id:a.caseId,file_name:a.name,file_url:a.url,file_size:a.fileSize||null,file_type:a.fileType||null,document_category:a.category||null,created_by:a.createdBy||null};try{const{error:e}=await n.from("tasks_files").select("visible_for_assigned").limit(1);e||(i.visible_for_assigned=N)}catch(e){}const{data:r,error:m}=await n.from("tasks_files").insert(i).select("*").single();if(m)throw new Error(`Erreur d'insertion: ${m.message}`);t({title:"âœ… Document transfÃ©rÃ©",description:`Le document a Ã©tÃ© transfÃ©rÃ© vers la tÃ¢che${N?" et est visible pour l'assignÃ©":""}.`}),u(),l()}catch(s){t({variant:"destructive",title:"Erreur de transfert",description:s.message||"Impossible de transfÃ©rer le document."})}finally{g(!1)}}else t({variant:"destructive",title:"TÃ¢che requise",description:"Veuillez sÃ©lectionner une tÃ¢che."})},disabled:x||!d,className:"bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700",children:x?"Transfert...":"TransfÃ©rer le document"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:265,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:256,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:152,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TransferToTaskModal.jsx",lineNumber:145,columnNumber:5},void 0)},j=({currentUser:r})=>{const[c,j]=e.useState([]),[C,U]=e.useState(""),[z,E]=e.useState(null),[T,M]=e.useState(!1),[V,G]=e.useState(!1),[k,y]=e.useState(null),[w,_]=e.useState("all"),S=r&&("Gerant"===r.function||"Associe Emerite"===r.function||r.role&&"admin"===r.role.toLowerCase()),I=[{id:"all",label:"Tous les documents",icon:m},{id:"Documents de suivi et facturation",label:"Documents de suivi et facturation",icon:u},{id:"PiÃ¨ces",label:"PiÃ¨ces",icon:u},{id:"Ã‰critures",label:"Ã‰critures",icon:u},{id:"Courriers",label:"Courriers",icon:u},{id:"Observations et notes",label:"Observations et notes",icon:u},{id:"Autres",label:"Autres",icon:u}];e.useEffect(()=>{(async()=>{const{data:e}=await n.from("profiles").select("*").eq("id",r.id).single();E(e)})()},[r]),e.useEffect(()=>{z&&(async()=>{try{const{data:e,error:s}=await n.from("tasks_files").select("\n                id,\n                file_name,\n                file_url,\n                file_type,\n                file_size,\n                document_category,\n                created_at,\n                task_id,\n                case_id,\n                created_by\n              ").order("created_at",{ascending:!1});if(s)return"PGRST204"===s.code||s.code,void j([]);const o=[...new Set(e.filter(e=>e.case_id).map(e=>e.case_id))];let t={};if(o.length>0){const{data:e}=await n.from("cases").select("id, title").in("id",o);e&&(t=e.reduce((e,s)=>(e[s.id]=s.title,e),{}))}const a=[...new Set(e.filter(e=>e.task_id).map(e=>e.task_id))];let i={};if(a.length>0){const{data:e}=await n.from("tasks").select("id, title").in("id",a);e&&(i=e.reduce((e,s)=>(e[s.id]=s.title,e),{}))}const r=[...new Set(e.filter(e=>e.created_by).map(e=>e.created_by))];let l={};if(r.length>0){const{data:e}=await n.from("profiles").select("id, name").in("id",r);e&&(l=e.reduce((e,s)=>(e[s.id]=s.name,e),{}))}const m=(e||[]).map(e=>{let s="Documents sans tÃ¢che",o="standalone",n=null;return e.task_id&&e.case_id?(s=i[e.task_id]||"TÃ¢che supprimÃ©e",n=t[e.case_id]||null,o="task-and-case"):e.task_id?(s=i[e.task_id]||"TÃ¢che supprimÃ©e",o="task"):e.case_id&&(s=t[e.case_id]||"Dossier supprimÃ©",n=t[e.case_id]||null,o="case"),{id:e.id,name:e.file_name,path:e.file_url,url:e.file_url,taskTitle:s,taskId:e.task_id,caseId:e.case_id,caseTitle:n,source:o,date:e.created_at,fileType:e.file_type,fileSize:e.file_size,category:e.document_category,createdBy:e.created_by,createdByName:l[e.created_by]||null,timeSpent:0}}),c=Array.from(new Map(m.map(e=>[e.url,e])).values());j(c)}catch(e){j([])}})()},[r,z,S]);const L=e.useMemo(()=>{const e={all:c.length};return I.forEach(s=>{"all"!==s.id&&(e[s.id]=0)}),c.forEach(s=>{s.category?e[s.category]=(e[s.category]||0)+1:e.Autres=(e.Autres||0)+1}),e},[c,I]),q=c.filter(e=>{const s=e.name&&e.name.toLowerCase().includes(C.toLowerCase())||e.taskTitle&&e.taskTitle.toLowerCase().includes(C.toLowerCase());return"all"===w?s:"Autres"===w?s&&(!e.category||"Autres"===e.category):s&&e.category===w}),A=q.reduce((e,s)=>{const o=s.taskId||"no-task";return e[o]||(e[o]={taskTitle:s.taskTitle||`TÃ¢che #${s.taskId}`,taskId:s.taskId,files:[]}),e[o].files.push(s),e},{});return Object.values(A),s.jsxDEV("div",{className:"space-y-6",children:[s.jsxDEV("div",{className:"flex items-center justify-between",children:[s.jsxDEV("div",{children:[s.jsxDEV("h1",{className:"text-3xl font-bold text-white mb-2",children:"Gestion des Documents"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:389,columnNumber:15},void 0),s.jsxDEV("p",{className:"text-slate-400",children:"Retrouvez tous les fichiers liÃ©s Ã  vos tÃ¢ches"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:390,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:388,columnNumber:13},void 0),s.jsxDEV(o,{onClick:()=>M(!0),className:"bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700",children:[s.jsxDEV(l,{className:"w-4 h-4 mr-2"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:396,columnNumber:15},void 0),"TransfÃ©rer Document"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:392,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:387,columnNumber:11},void 0),s.jsxDEV("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[s.jsxDEV("div",{className:"lg:col-span-1",children:s.jsxDEV("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-4",children:[s.jsxDEV("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[s.jsxDEV(d,{className:"w-5 h-5"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:407,columnNumber:19},void 0),"CatÃ©gories"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:406,columnNumber:17},void 0),s.jsxDEV("div",{className:"space-y-2",children:I.map(e=>{const o=L[e.id]||0,n=w===e.id;return s.jsxDEV("button",{onClick:()=>_(e.id),className:"w-full text-left px-4 py-3 rounded-lg transition-all duration-200 flex items-center justify-between gap-3 "+(n?"bg-blue-600 text-white shadow-lg shadow-blue-500/20 font-semibold":"text-slate-300 hover:bg-slate-700/50 hover:text-white"),children:[s.jsxDEV("div",{className:"flex items-center gap-3",children:[s.jsxDEV(e.icon,{className:"w-4 h-4 "+(n?"text-white":"text-slate-400")},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:426,columnNumber:27},void 0),s.jsxDEV("span",{className:"text-sm",children:e.label},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:427,columnNumber:27},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:425,columnNumber:25},void 0),s.jsxDEV("span",{className:"text-xs px-2 py-1 rounded-full "+(n?"bg-white/20 text-white font-semibold":"bg-slate-700/50 text-slate-400"),children:o},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:429,columnNumber:25},void 0)]},e.id,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:416,columnNumber:23},void 0)})},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:410,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:405,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:404,columnNumber:13},void 0),s.jsxDEV("div",{className:"lg:col-span-3 space-y-4",children:[s.jsxDEV("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6",children:s.jsxDEV("div",{className:"relative",children:[s.jsxDEV(b,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:448,columnNumber:19},void 0),s.jsxDEV("input",{type:"text",placeholder:"Rechercher un document par nom ou par tÃ¢che...",value:C,onChange:e=>U(e.target.value),className:"w-full pl-12 pr-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:449,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:447,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:446,columnNumber:15},void 0),0===q.length?s.jsxDEV("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-12 text-center",children:[s.jsxDEV(N,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:462,columnNumber:19},void 0),s.jsxDEV("h3",{className:"text-xl font-semibold text-slate-400 mb-2",children:"Aucun document trouvÃ©"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:463,columnNumber:19},void 0),s.jsxDEV("p",{className:"text-slate-500",children:"Les fichiers que vous joignez aux tÃ¢ches apparaÃ®tront ici."},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:464,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:461,columnNumber:17},void 0):s.jsxDEV("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:q.map((e,r)=>s.jsxDEV(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*r},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl overflow-hidden hover:border-slate-600/50 transition-all",children:[s.jsxDEV("div",{className:"p-6 pb-4",children:s.jsxDEV("div",{className:"flex items-start gap-4",children:[s.jsxDEV("div",{className:"flex-shrink-0",children:s.jsxDEV("div",{className:"w-14 h-14 bg-blue-500/10 rounded-lg flex items-center justify-center",children:s.jsxDEV(m,{className:"w-7 h-7 text-blue-400"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:513,columnNumber:33},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:512,columnNumber:31},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:511,columnNumber:29},void 0),s.jsxDEV("div",{className:"flex-1 min-w-0",children:[s.jsxDEV("h3",{className:"text-base font-bold text-white mb-2 break-words",title:e.name,children:(e=>{if(!e)return"Document";if(e.length<=40)return e;const s=e.lastIndexOf(".");if(-1===s)return e.substring(0,37)+"...";const o=e.substring(s);return e.substring(0,s).substring(0,37-o.length)+"..."+o})(e.name)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:519,columnNumber:31},void 0),s.jsxDEV("div",{className:"text-sm text-slate-400 mb-1 font-medium",children:e.caseTitle?e.caseTitle:e.taskId?e.taskTitle:"Sans dossier"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:524,columnNumber:31},void 0),s.jsxDEV("div",{className:"flex flex-wrap items-center gap-3 text-xs text-slate-500 mb-2",children:[e.fileSize&&s.jsxDEV("span",{children:(e=>{if(!e)return"";const s=e/1048576,o=e/1024;return s>=1?`${s.toFixed(1)} Mo`:`${Math.round(o)} Ko`})(e.fileSize)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:531,columnNumber:35},void 0),s.jsxDEV("span",{children:"â€¢"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:533,columnNumber:33},void 0),s.jsxDEV("span",{children:new Date(e.date).toLocaleDateString("fr-FR")},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:534,columnNumber:33},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:529,columnNumber:31},void 0),e.createdByName&&s.jsxDEV("div",{className:"text-xs text-slate-500 mb-2",children:["Par ",e.createdByName]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:539,columnNumber:33},void 0),s.jsxDEV("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[e.category&&s.jsxDEV("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-blue-500/10 text-blue-400 text-xs rounded-full",children:[s.jsxDEV("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-400"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:548,columnNumber:37},void 0),e.category]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:547,columnNumber:35},void 0),e.taskId&&s.jsxDEV("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-500/10 text-green-400 text-xs rounded-full",children:[s.jsxDEV("span",{className:"w-1.5 h-1.5 rounded-full bg-green-400"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:554,columnNumber:37},void 0),"LiÃ© Ã  une tÃ¢che"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:553,columnNumber:35},void 0),e.caseId&&!e.taskId&&s.jsxDEV("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-slate-600/30 text-slate-400 text-xs rounded-full",children:[s.jsxDEV("span",{className:"w-1.5 h-1.5 rounded-full bg-slate-400"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:560,columnNumber:37},void 0),"Document de dossier"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:559,columnNumber:35},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:545,columnNumber:31},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:518,columnNumber:29},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:509,columnNumber:27},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:508,columnNumber:25},void 0),s.jsxDEV("div",{className:"px-6 py-4 bg-slate-700/30 border-t border-slate-700/50 flex items-center justify-center gap-2 flex-wrap",children:[s.jsxDEV(o,{variant:"ghost",size:"sm",onClick:()=>(e=>{if(e&&e.startsWith("http")){const s=e.includes("?")?`${e}&download=`:`${e}?download=`;window.open(s,"_blank","noopener,noreferrer")}else t({variant:"destructive",title:"Erreur",description:"URL du fichier invalide."})})(e.url),className:"text-slate-300 hover:text-white hover:bg-slate-600/50",children:[s.jsxDEV(f,{className:"w-4 h-4 mr-2"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:577,columnNumber:29},void 0),"Voir"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:571,columnNumber:27},void 0),s.jsxDEV(o,{variant:"ghost",size:"sm",onClick:()=>(async(e,s)=>{if(e&&e.startsWith("http"))try{new URL(e);const o=await a(e);if(!o||0===o.size)return void t({variant:"destructive",title:"Erreur",description:"Le fichier tÃ©lÃ©chargÃ© est vide ou corrompu."});const n=window.URL.createObjectURL(o),i=document.createElement("a");i.href=n;const r=g(s);i.download=r,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(n),document.body.removeChild(i)}catch(o){t({variant:"destructive",title:"Erreur",description:"Impossible de tÃ©lÃ©charger le fichier."})}else t({variant:"destructive",title:"Erreur",description:"URL du fichier invalide."})})(e.url,e.name),className:"text-slate-300 hover:text-white hover:bg-slate-600/50",children:[s.jsxDEV(p,{className:"w-4 h-4 mr-2"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:586,columnNumber:29},void 0),"TÃ©lÃ©charger"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:580,columnNumber:27},void 0),e.caseId&&s.jsxDEV(o,{variant:"ghost",size:"sm",onClick:()=>{y(e),G(!0)},className:"text-blue-400 hover:text-blue-300 hover:bg-blue-500/10",children:[s.jsxDEV(v,{className:"w-4 h-4 mr-2"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:599,columnNumber:31},void 0),"TransfÃ©rer vers tÃ¢che"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:590,columnNumber:29},void 0),s.jsxDEV(o,{variant:"ghost",size:"sm",onClick:()=>{window.confirm(`Voulez-vous vraiment supprimer le document "${e.name}" ?\n\nCette action est irrÃ©versible.`)&&(async e=>{try{const{error:s}=await n.from("tasks_files").delete().eq("id",e.id);if(s)return void t({variant:"destructive",title:"Erreur",description:"Impossible de supprimer le fichier."});j(c.filter(s=>s.id!==e.id)),t({title:"ðŸ—‘ï¸ Document supprimÃ©",description:`${e.name} a Ã©tÃ© supprimÃ©.`})}catch(s){t({variant:"destructive",title:"Erreur",description:"Impossible de supprimer le fichier."})}})(e)},className:"text-red-400 hover:text-red-300 hover:bg-red-500/10",children:[s.jsxDEV(x,{className:"w-4 h-4 mr-2"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:613,columnNumber:29},void 0),"Supprimer"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:603,columnNumber:27},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:570,columnNumber:25},void 0)]},e.id,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:500,columnNumber:23},void 0))},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:467,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:444,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:402,columnNumber:11},void 0),T&&s.jsxDEV(D,{currentUser:r,onCancel:()=>M(!1),onDocumentUploaded:async e=>{let s="Document indÃ©pendant";if(e.task_id){const{data:o}=await n.from("cases").select("title").eq("id",e.task_id).single();o&&(s=o.title)}const o={id:e.id,name:e.file_name,path:e.file_url,url:e.file_url,taskTitle:s,taskId:e.task_id,date:e.created_at,fileType:e.file_type,fileSize:e.file_size,category:e.document_category,timeSpent:0};j(e=>[o,...e])}},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:627,columnNumber:13},void 0),V&&k&&s.jsxDEV(h,{document:k,onCancel:()=>{G(!1),y(null)},onTransferred:()=>{window.location.reload()}},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:636,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/DocumentManager.jsx",lineNumber:386,columnNumber:9},void 0)};export{j as default};
