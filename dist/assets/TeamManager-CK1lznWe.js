import{r as e,j as s,P as t}from"./vendor-react-DYPeng9G.js";import{B as a,s as r,t as i}from"./index-0LlzAmpO.js";import{m as l,X as n,u as o,B as c,a1 as d,aa as m,a4 as x,J as u,b as h,w as p,n as j,ab as f,ac as b,l as g,$ as v,ad as N,_ as w}from"./vendor-ui-DYDeDtSQ.js";import{C as y}from"./ConfirmationModal-CduQsMHX.js";import"./vendor-supabase-DEEIiAjM.js";const C=({member:t,onSubmit:r,onCancel:i})=>{const[x,u]=e.useState({name:"",function:"",email:"",role:"Assistant(e)"});e.useEffect(()=>{t&&u({name:t.name||"",function:t.function||"",email:t.email||"",role:t.role||"Assistant(e)"})},[t]);const h=e=>{const{name:s,value:t}=e.target;u(e=>({...e,[s]:t}))};return s.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:s.jsxs(l.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-slate-800 border border-slate-700 rounded-xl p-6 w-full max-w-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-white",children:t?"Modifier le Collaborateur":"Nouveau Collaborateur"}),s.jsx(a,{variant:"ghost",size:"icon",onClick:i,className:"text-slate-400 hover:text-white",children:s.jsx(n,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:e=>{e.preventDefault(),r(x)},className:"space-y-5",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[s.jsx(o,{className:"w-4 h-4 inline mr-2"}),"Nom et Pr√©noms *"]}),s.jsx("input",{type:"text",name:"name",value:x.name,onChange:h,required:!0,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"Ex: Marie Dupont"})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[s.jsx(c,{className:"w-4 h-4 inline mr-2"}),"Titre / Fonction"]}),s.jsxs("select",{name:"function",value:x.function,onChange:h,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500 cursor-pointer",children:[s.jsx("option",{value:"",children:"S√©lectionner un titre"}),s.jsx("option",{value:"Associ√© principal",children:"Associ√© principal"}),s.jsx("option",{value:"Associ√©",children:"Associ√©"}),s.jsx("option",{value:"Avocat senior",children:"Avocat senior"}),s.jsx("option",{value:"Avocat",children:"Avocat"}),s.jsx("option",{value:"Avocat stagiaire",children:"Avocat stagiaire"}),s.jsx("option",{value:"Juriste senior",children:"Juriste senior"}),s.jsx("option",{value:"Juriste",children:"Juriste"}),s.jsx("option",{value:"Secr√©taire juridique",children:"Secr√©taire juridique"}),s.jsx("option",{value:"Secr√©taire",children:"Secr√©taire"}),s.jsx("option",{value:"Assistant(e) juridique",children:"Assistant(e) juridique"}),s.jsx("option",{value:"Assistant(e)",children:"Assistant(e)"}),s.jsx("option",{value:"Comptable",children:"Comptable"}),s.jsx("option",{value:"Responsable administratif",children:"Responsable administratif"})]}),s.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Position hi√©rarchique et r√¥le au cabinet"})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[s.jsx(d,{className:"w-4 h-4 inline mr-2"}),"Courriel *"]}),s.jsx("input",{type:"email",name:"email",value:x.email,onChange:h,required:!0,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"marie.dupont@cabinet.com"})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[s.jsx(m,{className:"w-4 h-4 inline mr-2"}),"R√¥le *"]}),s.jsxs("select",{name:"role",value:x.role,onChange:h,required:!0,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500 cursor-pointer",children:[s.jsx("option",{value:"",children:"S√©lectionner un r√¥le"}),s.jsx("option",{value:"Administrateur",children:"Administrateur"}),s.jsx("option",{value:"G√©rant",children:"G√©rant"}),s.jsx("option",{value:"Collaborateur",children:"Collaborateur"}),s.jsx("option",{value:"Assistant(e)",children:"Assistant(e)"}),s.jsx("option",{value:"Consultant",children:"Consultant"})]}),s.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Niveau d'acc√®s dans l'application"})]}),s.jsxs("div",{className:"flex gap-4 pt-6",children:[s.jsx(a,{type:"submit",className:"flex-1 bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700",children:t?"Mettre √† jour":"Ajouter le collaborateur"}),s.jsx(a,{type:"button",variant:"outline",onClick:i,className:"flex-1 border-slate-600 text-slate-300 hover:bg-slate-700",children:"Annuler"})]})]})]})})},k=({member:e,index:t,onEdit:r,onDelete:i,isCurrentUser:n})=>{if(!e)return null;const p=e=>{const s={admin:"bg-red-500/20 text-red-400",manager:"bg-purple-500/20 text-purple-400",lawyer:"bg-blue-500/20 text-blue-400",assistant:"bg-green-500/20 text-green-400",default:"bg-slate-500/20 text-slate-400"};return s[e?.toLowerCase()]||s.default};return s.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*t},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-lg p-4 hover:border-slate-600/50 transition-all duration-200",children:[s.jsxs("div",{className:"lg:hidden space-y-3",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[s.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-purple-700 flex items-center justify-center flex-shrink-0",children:s.jsx(o,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-white font-medium",children:e.name||"N/A"}),s.jsxs("div",{className:`inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium mt-1 ${p(e.role)}`,children:[s.jsx(m,{className:"w-3 h-3"}),s.jsx("span",{children:e.role||"Non sp√©cifi√©"})]})]})]}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx(a,{variant:"ghost",size:"icon",onClick:()=>r(e),className:"w-8 h-8 text-slate-400 hover:text-white",children:s.jsx(x,{className:"w-4 h-4"})}),!n&&s.jsx(a,{variant:"ghost",size:"icon",onClick:()=>i(e.id),className:"w-8 h-8 text-slate-400 hover:text-[#6D071A]",children:s.jsx(u,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{className:"space-y-2 pl-13",children:[e.function&&s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(c,{className:"w-4 h-4 text-slate-400"}),s.jsx("span",{className:"text-slate-300",children:e.function}),s.jsx("span",{className:"text-xs text-slate-500",children:"(Titre/Fonction)"})]}),e.email&&s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(d,{className:"w-4 h-4 text-slate-400"}),s.jsx("span",{className:"text-slate-300 truncate",children:e.email})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(h,{className:"w-4 h-4 text-slate-400"}),s.jsx("span",{className:"text-slate-400",children:(j=e.created_at,j?new Date(j).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A")})]})]})]}),s.jsxs("div",{className:"hidden lg:grid lg:grid-cols-4 gap-4 items-center",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-purple-700 flex items-center justify-center flex-shrink-0",children:s.jsx(o,{className:"w-5 h-5 text-white"})}),s.jsx("div",{children:s.jsx("div",{className:"text-white font-medium",children:e.name||"N/A"})})]}),s.jsx("div",{children:s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(c,{className:"w-4 h-4 text-slate-400"}),s.jsx("span",{className:"text-slate-300",children:e.function||"Non sp√©cifi√©"})]})}),s.jsx("div",{children:s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(d,{className:"w-4 h-4 text-slate-400"}),s.jsx("span",{className:"text-slate-300 truncate",children:e.email||"N/A"})]})}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:`inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium ${p(e.role)}`,children:[s.jsx(m,{className:"w-3 h-3"}),s.jsx("span",{children:e.role||"Non sp√©cifi√©"})]}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx(a,{variant:"ghost",size:"icon",onClick:()=>r(e),className:"w-8 h-8 text-slate-400 hover:text-white",children:s.jsx(x,{className:"w-4 h-4"})}),!n&&s.jsx(a,{variant:"ghost",size:"icon",onClick:()=>i(e.id),className:"w-8 h-8 text-slate-400 hover:text-[#6D071A]",children:s.jsx(u,{className:"w-4 h-4"})})]})]})]})]});var j},A=({isOpen:t,onClose:i,user:o,onConfirmDelete:c})=>{const[d,m]=e.useState([]),[x,u]=e.useState([]),[h,g]=e.useState(""),[v,N]=e.useState(!0),[w,y]=e.useState(!1);e.useEffect(()=>{t&&o&&(C(),k())},[t,o]);const C=async()=>{try{const{data:e,error:s}=await r.from("tasks").select("id, title, status").eq("assigned_to_id",o.id);if(s)throw s;m(e||[])}catch(e){}finally{N(!1)}},k=async()=>{try{const{data:e,error:s}=await r.from("profiles").select("id, name, email").neq("id",o.id).eq("admin_approved",!0);if(s)throw s;u(e||[])}catch(e){}};return t?s.jsx(p,{children:s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:s.jsxs(l.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-slate-800 border border-slate-700 rounded-xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-hidden",children:[s.jsx("div",{className:"bg-gradient-to-r from-red-500/20 to-rose-600/20 border-b border-red-500/30 px-6 py-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"bg-red-500/20 p-2 rounded-lg",children:s.jsx(j,{className:"w-5 h-5 text-red-400"})}),s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Supprimer ",o?.name]}),s.jsx("p",{className:"text-sm text-slate-400",children:o?.email})]})]}),s.jsx("button",{onClick:i,className:"text-slate-400 hover:text-white transition-colors",children:s.jsx(n,{className:"w-5 h-5"})})]})}),s.jsx("div",{className:"p-6 space-y-4 max-h-[calc(90vh-200px)] overflow-y-auto",children:v?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"})}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-4",children:s.jsxs("div",{className:"flex gap-3",children:[s.jsx(f,{className:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),s.jsx("div",{className:"flex-1",children:s.jsxs("p",{className:"text-sm text-slate-200",children:["Cette action est ",s.jsx("span",{className:"font-semibold text-red-400",children:"irr√©versible"}),". Le compte utilisateur sera supprim√© d√©finitivement."]})})]})}),d.length>0&&s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"bg-orange-500/10 border border-orange-500/30 rounded-lg p-4",children:[s.jsxs("p",{className:"text-sm text-slate-200 mb-3",children:[s.jsx("span",{className:"font-semibold text-orange-400",children:d.length})," t√¢che(s)",d.length>1?" sont assign√©es":" est assign√©e"," √† cet utilisateur :"]}),s.jsx("ul",{className:"space-y-1.5 text-xs text-slate-400 max-h-32 overflow-y-auto",children:d.map(e=>s.jsxs("li",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"w-1.5 h-1.5 bg-orange-400 rounded-full"}),s.jsx("span",{className:"truncate",children:e.title})]},e.id))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-slate-300",children:[s.jsx(b,{className:"w-4 h-4 text-blue-400"}),"R√©attribuer les t√¢ches √† :"]}),s.jsxs("select",{value:h,onChange:e=>g(e.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"",children:"-- S√©lectionner un collaborateur --"}),x.map(e=>s.jsxs("option",{value:e.id,children:[e.name," (",e.email,")"]},e.id))]}),!h&&s.jsx("p",{className:"text-xs text-red-400",children:"‚ö†Ô∏è Vous devez s√©lectionner un collaborateur pour r√©attribuer les t√¢ches"})]})]}),0===d.length&&s.jsx("div",{className:"text-center py-4",children:s.jsx("p",{className:"text-sm text-slate-400",children:"Aucune t√¢che assign√©e √† cet utilisateur."})})]})}),s.jsxs("div",{className:"bg-slate-900/50 border-t border-slate-700 px-6 py-4 flex justify-end gap-3",children:[s.jsx(a,{variant:"outline",onClick:i,disabled:w,className:"border-slate-600 text-slate-300 hover:bg-slate-700",children:"Annuler"}),s.jsx(a,{onClick:async()=>{if(!(d.length>0)||h){y(!0);try{if(d.length>0&&h){const e=x.find(e=>e.id===h),{error:s}=await r.from("tasks").update({assigned_to_id:h,assigned_to_name:e?.name||""}).eq("assigned_to_id",o.id);if(s)throw s}await c(o.id),i()}catch(e){}finally{y(!1)}}},disabled:w||d.length>0&&!h,className:"bg-gradient-to-r from-red-500 to-rose-600 hover:from-red-600 hover:to-rose-700 text-white",children:w?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Suppression..."]}):s.jsxs(s.Fragment,{children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),"Supprimer d√©finitivement"]})})]})]})})}):null};A.propTypes={isOpen:t.bool.isRequired,onClose:t.func.isRequired,user:t.shape({id:t.string,name:t.string,email:t.string}),onConfirmDelete:t.func.isRequired};const S=()=>{const[t,n]=e.useState([]),[c,d]=e.useState(!0),[m,x]=e.useState(!1),[u,h]=e.useState(null);e.useEffect(()=>{p()},[]);const p=async()=>{try{const{data:e,error:s}=await r.from("profiles").select('id, name, email, "function", role, created_at').eq("admin_approved",!1).neq("role","admin").order("created_at",{ascending:!1});if(s)throw s;n(e||[])}catch(e){i({variant:"destructive",title:"Erreur",description:"Impossible de charger les utilisateurs en attente."})}finally{d(!1)}};return c?s.jsx("div",{className:"flex items-center justify-center p-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):0===t.length?null:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"bg-gradient-to-r from-orange-500/20 to-amber-500/20 p-3 rounded-lg backdrop-blur-sm",children:s.jsx(g,{className:"w-5 h-5 text-orange-400"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-white",children:"Validations en attente"}),s.jsxs("p",{className:"text-sm text-slate-400",children:[t.length," ",t.length>1?"utilisateurs":"utilisateur"," √† approuver"]})]})]}),s.jsx("div",{className:"space-y-3",children:t.map((e,n)=>s.jsx(l.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1*n},className:"bg-slate-800/50 border border-orange-500/30 rounded-lg p-4 backdrop-blur-sm hover:border-orange-500/50 transition-all",children:s.jsxs("div",{className:"flex items-start justify-between gap-4",children:[s.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[s.jsx("div",{className:"bg-gradient-to-br from-orange-500 to-amber-600 rounded-full p-2.5 shadow-lg",children:s.jsx(o,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h4",{className:"font-semibold text-white truncate",children:e.name}),s.jsx("p",{className:"text-sm text-slate-300 truncate",children:e.email}),s.jsx("p",{className:"text-sm text-slate-400",children:e.function}),s.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Cr√©√© le ",new Date(e.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})]})]})]}),s.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[s.jsxs(a,{size:"sm",className:"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white border-0 shadow-lg",onClick:()=>(async(e,s)=>{try{const{error:t}=await r.from("profiles").update({admin_approved:!0}).eq("id",e);if(t)throw t;i({title:"‚úÖ Utilisateur approuv√©",description:`${s} peut maintenant se connecter.`}),p()}catch(t){i({variant:"destructive",title:"Erreur",description:"Impossible d'approuver cet utilisateur."})}})(e.id,e.name),children:[s.jsx(v,{className:"w-4 h-4 mr-1.5"}),"Approuver"]}),s.jsxs(a,{size:"sm",className:"bg-gradient-to-r from-red-500 to-rose-600 hover:from-red-600 hover:to-rose-700 text-white border-0 shadow-lg",onClick:()=>(e=>{const s=t.find(s=>s.id===e);s&&(h(s),x(!0))})(e.id,e.name),children:[s.jsx(N,{className:"w-4 h-4 mr-1.5"}),"Rejeter"]})]})]})},e.id))}),s.jsx(A,{isOpen:m,onClose:()=>{x(!1),h(null)},user:u,onConfirmDelete:async e=>{try{const{data:s,error:t}=await r.rpc("delete_user_account",{user_id:e});if(t)throw t;if(!s?.success)throw new Error(s?.error||"Erreur lors de la suppression");i({title:"‚ùå Utilisateur rejet√©",description:"L'utilisateur a √©t√© supprim√© compl√®tement."}),p()}catch(s){i({variant:"destructive",title:"Erreur",description:"Impossible de rejeter cet utilisateur."})}}})]})},_=({currentUser:t})=>{const[a,n]=e.useState([]),[d,m]=e.useState(null),[x,u]=e.useState(""),[h,p]=e.useState({open:!1,title:"",message:"",onConfirm:()=>{}}),[j,f]=e.useState(!1),[b,g]=e.useState(null);e.useEffect(()=>{v()},[]);const v=async()=>{const{data:e,error:s}=await r.from("profiles").select('id, name, email, "function", role, created_at');if(s)i({variant:"destructive",title:"Erreur",description:"Impossible de charger les collaborateurs."});else{const s=(e||[]).filter(e=>"admin"!==e.role);n(s)}},N=a.filter(e=>{if(!e)return!1;const s=x.toLowerCase();return e?.name?.toLowerCase().includes(s)||e?.email?.toLowerCase().includes(s)||e?.role?.toLowerCase().includes(s)}),_=a.reduce((e,s)=>{if(s?.role){const t=s.role.toLowerCase();e[t]=(e[t]||0)+1}return e},{});return s.jsxs("div",{className:"space-y-6",id:"team-manager-section",children:[s.jsx("div",{className:"flex items-center justify-between print:hidden",children:s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Gestion des Collaborateurs"}),s.jsx("p",{className:"text-slate-400",children:"G√©rez les membres de votre cabinet et leurs acc√®s"}),s.jsx("div",{className:"mt-2 inline-flex items-center gap-2 px-3 py-1.5 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:s.jsxs("span",{className:"text-xs text-blue-300",children:["üí° ",s.jsx("strong",{children:"Info :"})," Cette section g√®re le ",s.jsx("strong",{children:"personnel interne"})," du cabinet (avocats, assistants, etc.)"]})}),s.jsx("div",{className:"mt-2 inline-flex items-center gap-2 px-3 py-1.5 bg-orange-500/10 border border-orange-500/30 rounded-lg",children:s.jsxs("span",{className:"text-xs text-orange-300",children:["‚ÑπÔ∏è Pour ",s.jsx("strong",{children:"cr√©er un nouveau collaborateur"}),", rendez-vous dans ",s.jsx("strong",{children:"Param√®tres ‚Üí Permissions"})]})})]})}),s.jsx("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6 print:hidden",children:s.jsx(S,{})}),s.jsxs("div",{className:"print:hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-lg p-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-slate-400",children:"Total"}),s.jsx(c,{className:"w-6 h-6 text-slate-400"})]}),s.jsx("p",{className:"text-3xl font-bold text-white",children:a.length})]}),Object.entries(_).slice(0,3).map(([e,t],a)=>s.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*(a+1)},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-lg p-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-slate-400 capitalize",children:e}),s.jsx(o,{className:"w-6 h-6 text-green-400"})]}),s.jsx("p",{className:"text-3xl font-bold text-white",children:t})]},e))]}),s.jsx("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6 print:hidden",children:s.jsxs("div",{className:"relative",children:[s.jsx(w,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5"}),s.jsx("input",{type:"text",placeholder:"Rechercher un collaborateur par nom, email ou r√¥le...",value:x,onChange:e=>u(e.target.value),className:"w-full pl-12 pr-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-green-500"})]})}),s.jsxs("div",{className:"hidden lg:grid lg:grid-cols-4 gap-4 px-6 py-3 bg-slate-900/50 backdrop-blur-sm rounded-lg border border-slate-700/50 text-sm text-slate-400 font-medium",children:[s.jsx("div",{children:"Nom et Pr√©noms"}),s.jsx("div",{children:"Titre / Fonction"}),s.jsx("div",{children:"Courriel"}),s.jsx("div",{children:"R√¥le & Actions"})]}),s.jsx("div",{className:"space-y-4",children:N.map((e,r)=>s.jsx(k,{member:e,index:r,onEdit:e=>{m(e)},onDelete:e=>{const s=a.find(s=>s.id===e);p({open:!0,title:"Supprimer le collaborateur",message:`Voulez-vous vraiment supprimer le membre "${s?.name}" ?\n\nCette action est irr√©versible.`,onConfirm:()=>{(async e=>{const s=a.find(s=>s.id===e);s&&(g(s),f(!0))})(e),p({...h,open:!1})}})},isCurrentUser:e.id===t.id},e.id))}),0===N.length&&s.jsxs(l.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12 print:hidden",children:[s.jsx(c,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-slate-400 mb-2",children:"Aucun collaborateur trouv√©"}),s.jsx("p",{className:"text-slate-500",children:x?"Essayez de modifier votre recherche":"Commencez par ajouter un membre √† votre √©quipe"})]}),d&&s.jsx(C,{member:d,onSubmit:async e=>{if(!d)return;const{data:s,error:t}=await r.from("profiles").update({name:e.name,function:e.function,role:e.role}).eq("id",d.id).select('id, name, email, "function", role, created_at');t?i({variant:"destructive",title:"Erreur",description:`Impossible de modifier le collaborateur: ${t.message||"Erreur inconnue"}`}):(n(a.map(e=>e.id===d.id?s[0]:e)),m(null),i({title:"‚úÖ Collaborateur modifi√©",description:"Les informations ont √©t√© mises √† jour."}))},onCancel:()=>{m(null)}}),s.jsx(y,{open:h.open,onOpenChange:e=>p({...h,open:e}),title:h.title,message:h.message,onConfirm:h.onConfirm}),s.jsx(A,{isOpen:j,onClose:()=>{f(!1),g(null)},user:b,onConfirmDelete:async e=>{try{const{data:s,error:t}=await r.rpc("delete_user_account",{user_id:e});if(t)return void i({variant:"destructive",title:"Erreur",description:"Impossible de supprimer l'utilisateur."});if(!s?.success)return void i({variant:"destructive",title:"Erreur",description:s?.error||"Erreur lors de la suppression."});n(a.filter(s=>s.id!==e)),i({title:"‚úÖ Utilisateur supprim√©",description:"Le compte utilisateur a √©t√© supprim√© compl√®tement."})}catch(s){i({variant:"destructive",title:"Erreur",description:"Une erreur est survenue lors de la suppression."})}}})]})};_.propTypes={currentUser:t.shape({id:t.string,name:t.string,email:t.string,role:t.string,function:t.string})};export{_ as default};
