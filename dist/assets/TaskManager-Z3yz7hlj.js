const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BzUzpWLW.js","assets/vendor-react-CWhE6-Gf.js","assets/sentry-CxmcrLP_.js","assets/vendor-supabase-CR9Q8AJ3.js","assets/vendor-charts-BY8kkf7J.js","assets/vendor-ui-BBpB3Q8s.js","assets/index-3nJZp8WO.css"])))=>i.map(i=>d[i]);
import{_ as e}from"./vendor-supabase-CR9Q8AJ3.js";import{r as s,f as n,P as o}from"./vendor-react-CWhE6-Gf.js";import{B as i,t,s as a,g as r}from"./index-BzUzpWLW.js";import{C as l,L as m}from"./label-fotUBuUV.js";import{m as c,X as u,b as d,F as b,u as p,y as g,z as N,G as v,I as x,J as f,M as h,N as j,O as D,Z as C,Q as k,W as E,Y as T,_ as V,$ as _,l as z,n as U,q as y}from"./vendor-ui-BBpB3Q8s.js";import{h as w,d as G}from"./filePreviewUtils-C0dV8HzJ.js";import{A as F,a as M,b as S,c as P,d as A,e as $,f as L,g as I,C as R}from"./ConfirmationModal-By6tTfcV.js";import"./sentry-CxmcrLP_.js";import"./vendor-charts-BY8kkf7J.js";const O=[{name:"Mise en √©tat et suivi de dossiers",tasks:["Ouverture de dossier","Constitution et demande de pi√®ces","Recherches juridiques","Analyse de dossier","Collecte et gestion des preuves","Transfert ou cession de dossiers","D√©p√¥t et enr√¥lement d'acte de proc√©dure","D√©p√¥t et suivi de correspondance","Suivi des d√©lais judiciaires","(Re)programmation de dossier","Voies de recours (appel, pourvoi)","Cl√¥ture et archivage de dossier","Archivage de dossier"]},{name:"Conseil et assistance juridiques",tasks:["Consultation et r√©daction d'avis juridiques","R√©daction d'actes juridiques","R√©daction de note de synth√®se","Revue documentaire","Analyse de conformit√© l√©gislative et r√©glementaire","Veille l√©gislative et r√©glementaire"]},{name:"Conseil et assistance judiciaires",tasks:["Avis juridique ou note de synth√®se","R√©daction d'acte introductif d'instance","R√©daction d'actes de proc√©dure","D√©p√¥t et enr√¥lement d'actes de proc√©dure","Assistance √† la Police judiciaire","Assistance √† parquet","Assistance devant le Juge d'instruction ou la Chambre d'instruction","Assistance devant autre organisme ou administration","Audience de plaidoirie","Compte rendu d'audience","Compte rendu de suivi et de gestion de dossier","Suivi des d√©lais de proc√©dure","Collecte et gestion des preuves","Voies de recours","M√©diation, arbitrage et r√®glement amiable","Pr√©paration d'audience ou de plaidoirie","Assistance et repr√©sentation en justice","Veille jurisprudentielle et l√©gislative"]},{name:"Conseil et assistance fiscale",tasks:["Conseil en fiscalit√©","Contentieux fiscal et repr√©sentation devant les autorit√©s fiscales","D√©clarations fiscales","Assistance lors des contr√¥les fiscaux","Audit de conformit√© fiscale"]},{name:"Missions d'audit",tasks:["Audit juridique de l'entreprise","Audit de conformit√©","Audit de soci√©t√©s (due diligence pr√©-acquisition)","Audit fiscal","Audit social"]},{name:"Corporate (Droit des soci√©t√©s)",tasks:["Cr√©ation et dissolution de soci√©t√©s","R√©daction et mise √† jour des statuts et pactes d'actionnaires","Tenue des registres l√©gaux","R√©daction et suivi des proc√®s-verbaux d'assembl√©e g√©n√©rale","Op√©rations sur capital","Formalit√©s aupr√®s du RCCM et annonces l√©gales"]},{name:"Gestion des ressources humaines",tasks:["Recrutement et int√©gration des collaborateurs","Gestion de la paie, des cong√©s et des absences","√âvaluations annuelles et gestion de carri√®re","Plan de formation interne et continue","R√©daction et gestion des contrats de travail","Gestion des proc√©dures de licenciement"]},{name:"Secr√©tariat & Administration",tasks:["Gestion de l'agenda et des plannings","Gestion du courrier et des envois","Gestion des fournitures et des achats","Maintenance des locaux et logistique interne","Gestion des contrats avec les fournisseurs et prestataires","Traduction certifi√©e","Formalit√©s notariales et l√©galisations"]},{name:"Comptabilit√© & Finance",tasks:["√âmission et suivi des factures d'honoraires","Suivi des encaissements et des relances","Gestion des avances et des d√©p√¥ts","Rapprochement comptable","Pr√©visions budg√©taires","D√©claration et paiement des charges","Gestion du parc automobile du cabinet"]},{name:"Communication & D√©veloppement",tasks:["Veille et d√©veloppement commercial","R√©daction de propositions commerciales","Suivi des appels d'offres","Organisation d'√©v√©nements et de conf√©rences","R√©daction de contenu pour le site web et les r√©seaux sociaux"]},{name:"Community management",tasks:["Gestion des r√©seaux sociaux","Diffusion de veille juridique externe","Valorisation de l'image du cabinet","Suivi e-r√©putation et r√©ponses digitales"]},{name:"Relations avec experts et tiers",tasks:["Coordination avec huissiers, notaires, experts judiciaires","Transmission d'acte pour signification","Demande de constat","Transmission d'acte pour authentification","Suivi des rapports d'expertise","Gestion des consultants et experts externes"]},{name:"Conformit√© & Risques",tasks:["Mise en place des proc√©dures KYC (Know Your Customer) et LCB-FT (Lutte Contre le Blanchiment de capitaux et le Financement du Terrorisme)","Conformit√© l√©gislative et r√©glementaire, et protection des donn√©es","Audit de conformit√© interne","Gestion des incidents de s√©curit√© et des fuites de donn√©es","Gestion des risques op√©rationnels"]},{name:"Gestion Documentaire",tasks:["Num√©risation, classement et indexation des documents","Mise √† jour des mod√®les et templates de documents","Archivage et destruction programm√©e des dossiers","Sauvegarde et s√©curisation des donn√©es"]},{name:"IT & Syst√®mes d'Information",tasks:["Support informatique interne","Sauvegarde des donn√©es et syst√®mes","Gestion des acc√®s et des droits utilisateurs","S√©curit√© informatique et gestion des incidents"]}],q=({task:o,onSubmit:a,onCancel:r,teamMembers:j,cases:D,currentUser:C})=>{const[k,E]=s.useState({title:"",description:"",priority:"medium",status:"pending",deadline:"",assigned_to_id:"",assigned_to_ids:[],visible_by_ids:[],case_id:"",main_category:"",associated_tasks:[],attachments:[],filesToUpload:[],scannedFiles:[]}),[T,V]=s.useState(""),[_,z]=s.useState(!1),[U,y]=s.useState([]),[w,G]=s.useState(!1);s.useEffect(()=>{(async()=>{try{if("ImageCapture"in globalThis&&navigator.mediaDevices){const e=(await navigator.mediaDevices.enumerateDevices()).some(e=>"videoinput"===e.kind&&(e.label.toLowerCase().includes("scanner")||e.label.toLowerCase().includes("document")||e.label.toLowerCase().includes("scan")));G(e)}}catch(e){}})()},[]),s.useEffect(()=>{if(o&&(E({title:o.title||"",description:o.description||"",priority:o.priority||"medium",status:o.status||"pending",deadline:o.deadline?new Date(o.deadline).toISOString().substring(0,16):"",assigned_to_id:o.assigned_to_id||"",assigned_to_ids:o.assigned_to_ids||(o.assigned_to_id?[o.assigned_to_id]:[]),visible_by_ids:o.visible_by_ids||[],case_id:o.case_id||"",main_category:o.main_category||"",associated_tasks:o.associated_tasks||[],attachments:o.attachments||[],filesToUpload:[],scannedFiles:[]}),o.main_category)){const e=O.find(e=>e.name===o.main_category);y(e?e.tasks:[])}},[o]);const F=e=>{const{name:s,value:n}=e.target;if(E(e=>({...e,[s]:n})),"main_category"===s){const e=O.find(e=>e.name===n);y(e?e.tasks:[]),E(e=>({...e,associated_tasks:[]}))}},M=async(s,n)=>{if(o?.id)try{const{uploadMultipleTaskFilesWithCategory:i}=await e(async()=>{const{uploadMultipleTaskFilesWithCategory:e}=await import("./index-BzUzpWLW.js").then(e=>e.n);return{uploadMultipleTaskFilesWithCategory:e}},__vite__mapDeps([0,1,2,3,4,5,6]));t({title:"üì§ Upload en cours...",description:`T√©l√©versement de ${s.length} fichier(s) avec cat√©gorie "${n}"...`});const a=await i(s,o.id,C?.id,n);if(a.success)t({title:"‚úÖ Fichiers upload√©s",description:`${a.data.length} fichier(s) t√©l√©vers√©(s) avec cat√©gorie "${n}".`}),window.refreshTaskFiles&&window.refreshTaskFiles(o.id);else if(a.errors.length>0){const e=a.errors.some(e=>e.error?.includes("bucket 'attachments'")||e.error?.includes("n'est pas encore configur√©"));t(e?{title:"‚ö†Ô∏è Stockage non configur√©",description:"Le bucket 'attachments' doit √™tre cr√©√© dans Supabase Dashboard > Storage",variant:"destructive"}:{title:"‚ö†Ô∏è Erreur d'upload",description:a.summary,variant:"destructive"})}}catch(i){t({variant:"destructive",title:"‚ùå Erreur",description:"Impossible d'uploader les fichiers."})}else t({variant:"destructive",title:"‚ö†Ô∏è T√¢che non enregistr√©e",description:"Veuillez d'abord enregistrer la t√¢che avant d'ajouter des fichiers."})},S=C&&("Gerant"===C.function||"Associe Emerite"===C.function)||C.role&&"admin"===C.role.toLowerCase(),P=o&&(o.assigned_to_id===C.id||S);return n.jsxDEV(c.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:n.jsxDEV(c.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-slate-800 border border-slate-700 rounded-xl p-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[n.jsxDEV("div",{className:"flex items-center justify-between mb-6",children:[n.jsxDEV("h2",{className:"text-2xl font-bold text-white",children:o?"Modifier la T√¢che":"Nouvelle T√¢che"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:496,columnNumber:11},void 0),n.jsxDEV(i,{variant:"ghost",size:"icon",onClick:r,className:"text-slate-400 hover:text-white",children:n.jsxDEV(u,{className:"w-5 h-5"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:505,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:499,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:495,columnNumber:9},void 0),n.jsxDEV("form",{onSubmit:e=>{e.preventDefault(),a(k)},className:"space-y-6",children:[n.jsxDEV("div",{children:[n.jsxDEV("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Titre de la t√¢che *"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:511,columnNumber:13},void 0),n.jsxDEV("input",{type:"text",name:"title",value:k.title,onChange:F,required:!0,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ex: Pr√©parer les conclusions pour l'affaire Martin"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:514,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:510,columnNumber:11},void 0),n.jsxDEV("div",{children:[n.jsxDEV("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Description"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:526,columnNumber:13},void 0),n.jsxDEV("textarea",{name:"description",value:k.description,onChange:F,rows:3,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"D√©tails de la t√¢che..."},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:529,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:525,columnNumber:11},void 0),n.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxDEV("div",{children:[n.jsxDEV("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Cat√©gorie t√¢che"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:541,columnNumber:15},void 0),n.jsxDEV("select",{name:"main_category",value:k.main_category,onChange:F,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsxDEV("option",{value:"",children:"-- S√©lectionner une cat√©gorie --"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:550,columnNumber:17},void 0),O.map(e=>n.jsxDEV("option",{value:e.name,children:e.name},e.name,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:552,columnNumber:19},void 0))]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:544,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:540,columnNumber:13},void 0),n.jsxDEV("div",{children:[n.jsxDEV("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"T√¢ches Associ√©es"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:557,columnNumber:15},void 0),n.jsxDEV("div",{className:"p-3 bg-slate-700/50 border border-slate-600 rounded-lg max-h-40 overflow-y-auto",children:U.length>0?U.map(e=>n.jsxDEV("div",{className:"flex items-center space-x-2 py-1",children:[n.jsxDEV(l,{id:e,checked:k.associated_tasks.includes(e),onCheckedChange:()=>(e=>{E(s=>{const n=s.associated_tasks.includes(e)?s.associated_tasks.filter(s=>s!==e):[...s.associated_tasks,e];return{...s,associated_tasks:n}})})(e)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:564,columnNumber:23},void 0),n.jsxDEV(m,{htmlFor:e,className:"text-slate-300 font-normal",children:e},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:569,columnNumber:23},void 0)]},e,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:563,columnNumber:21},void 0)):n.jsxDEV("p",{className:"text-slate-400 text-sm",children:"S√©lectionnez d'abord une cat√©gorie principale."},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:573,columnNumber:19},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:560,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:556,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:539,columnNumber:11},void 0),n.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxDEV("div",{children:[n.jsxDEV("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Priorit√©"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:581,columnNumber:15},void 0),n.jsxDEV("select",{name:"priority",value:k.priority,onChange:F,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsxDEV("option",{value:"low",children:"üü¢ Faible"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:590,columnNumber:17},void 0),n.jsxDEV("option",{value:"medium",children:"üü° Moyenne"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:591,columnNumber:17},void 0),n.jsxDEV("option",{value:"high",children:"üü† √âlev√©e"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:592,columnNumber:17},void 0),n.jsxDEV("option",{value:"urgent",children:"üî¥ Urgente"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:593,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:584,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:580,columnNumber:13},void 0),n.jsxDEV("div",{children:[n.jsxDEV("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Statut t√¢che"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:598,columnNumber:15},void 0),n.jsxDEV("select",{name:"status",value:k.status,onChange:F,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsxDEV("option",{value:"pending",children:"En attente"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:607,columnNumber:17},void 0),n.jsxDEV("option",{value:"seen",children:"Vue"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:608,columnNumber:17},void 0),n.jsxDEV("option",{value:"in-progress",children:"En cours"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:609,columnNumber:17},void 0),n.jsxDEV("option",{value:"completed",children:"Termin√©e"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:610,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:601,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:597,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:579,columnNumber:11},void 0),n.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxDEV("div",{children:[n.jsxDEV("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[n.jsxDEV(d,{className:"w-4 h-4 inline mr-2"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:618,columnNumber:17},void 0),"√âch√©ance"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:617,columnNumber:15},void 0),n.jsxDEV("input",{type:"datetime-local",name:"deadline",value:k.deadline,onChange:F,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:621,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:616,columnNumber:13},void 0),n.jsxDEV("div",{children:[n.jsxDEV("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[n.jsxDEV(b,{className:"w-4 h-4 inline mr-2"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:631,columnNumber:17},void 0),"Dossier"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:630,columnNumber:15},void 0),n.jsxDEV("select",{name:"case_id",value:k.case_id,onChange:F,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsxDEV("option",{value:"",children:"Aucun dossier"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:640,columnNumber:17},void 0),D&&D.map(e=>n.jsxDEV("option",{value:e.id,children:e.title},e.id,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:642,columnNumber:19},void 0))]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:634,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:629,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:615,columnNumber:11},void 0),n.jsxDEV("div",{children:[n.jsxDEV("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[n.jsxDEV(p,{className:"w-4 h-4 inline mr-2"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:650,columnNumber:15},void 0),"Assign√© √† (multi-s√©lection)"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:649,columnNumber:13},void 0),n.jsxDEV("div",{className:"p-4 bg-slate-700/50 border border-slate-600 rounded-lg max-h-48 overflow-y-auto space-y-2",children:j&&j.length>0?j.map(e=>n.jsxDEV("div",{className:"flex items-center space-x-2",children:[n.jsxDEV(l,{id:`assign-${e.id}`,checked:k.assigned_to_ids.includes(e.id),onCheckedChange:s=>{E(n=>({...n,assigned_to_ids:s?[...n.assigned_to_ids,e.id]:n.assigned_to_ids.filter(s=>s!==e.id),assigned_to_id:s&&0===n.assigned_to_ids.length?e.id:n.assigned_to_ids.filter(s=>s!==e.id)[0]||""}))},disabled:!S&&!_&&o&&o.assigned_to_id!==C.id},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:657,columnNumber:21},void 0),n.jsxDEV(m,{htmlFor:`assign-${e.id}`,className:"text-slate-300 font-normal cursor-pointer flex-1",children:[e.name,e.role&&n.jsxDEV("span",{className:"ml-2 text-xs text-slate-500",children:["(",e.role,")"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:680,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:674,columnNumber:21},void 0)]},e.id,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:656,columnNumber:19},void 0)):n.jsxDEV("p",{className:"text-slate-400 text-sm",children:"Aucun membre d'√©quipe disponible"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:686,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:653,columnNumber:13},void 0),k.assigned_to_ids.length>0&&n.jsxDEV("div",{className:"mt-2 flex flex-wrap gap-2",children:k.assigned_to_ids.map(e=>{const s=j.find(s=>s.id===e);return s?n.jsxDEV("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs bg-blue-500/20 text-blue-300 border border-blue-500/30",children:[s.name,n.jsxDEV("button",{type:"button",onClick:()=>{E(s=>({...s,assigned_to_ids:s.assigned_to_ids.filter(s=>s!==e),assigned_to_id:s.assigned_to_ids.filter(s=>s!==e)[0]||""}))},className:"ml-2 text-blue-300 hover:text-blue-100",children:"√ó"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:696,columnNumber:23},void 0)]},e,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:694,columnNumber:21},void 0):null})},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:690,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:648,columnNumber:11},void 0),P&&!S&&!_&&n.jsxDEV(i,{type:"button",variant:"outline",onClick:()=>z(!0),children:[n.jsxDEV(g,{className:"w-4 h-4 mr-2"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:718,columnNumber:15},void 0)," R√©assigner la t√¢che"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:717,columnNumber:13},void 0),n.jsxDEV("div",{children:[n.jsxDEV("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[n.jsxDEV(N,{className:"w-4 h-4 inline mr-2"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:724,columnNumber:15},void 0),"Pi√®ces jointes"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:723,columnNumber:13},void 0),n.jsxDEV("div",{className:"mb-4 p-4 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:[n.jsxDEV("label",{className:"block text-sm font-medium text-blue-300 mb-2",children:"üìÅ Cat√©gorie du document *"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:730,columnNumber:15},void 0),n.jsxDEV("select",{value:T,onChange:e=>V(e.target.value),className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsxDEV("option",{value:"",children:"-- S√©lectionner une cat√©gorie --"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:738,columnNumber:17},void 0),[{value:"Documents de suivi et facturation",label:"Documents de suivi et facturation"},{value:"Pi√®ces",label:"Pi√®ces"},{value:"√âcritures",label:"√âcritures"},{value:"Courriers",label:"Courriers"},{value:"Observations et notes",label:"Observations et notes"},{value:"Autres",label:"Autres"}].map(e=>n.jsxDEV("option",{value:e.value,children:e.label},e.value,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:740,columnNumber:19},void 0))]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:733,columnNumber:15},void 0),n.jsxDEV("p",{className:"mt-2 text-xs text-slate-400",children:"‚ö†Ô∏è La cat√©gorie est obligatoire pour tous les documents ajout√©s √† cette t√¢che."},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:745,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:729,columnNumber:13},void 0),n.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[n.jsxDEV("label",{htmlFor:"file-internal",className:"cursor-pointer bg-blue-600 hover:bg-blue-700 border border-blue-500 rounded-lg px-4 py-3 text-white font-medium flex items-center justify-center gap-2 transition-colors",children:[n.jsxDEV(b,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:756,columnNumber:17},void 0),"Choisir des fichiers"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:752,columnNumber:15},void 0),n.jsxDEV("input",{id:"file-internal",type:"file",className:"sr-only",onChange:async e=>{if(e.target.files){const s=Array.from(e.target.files);if(!T)return t({variant:"destructive",title:"‚ö†Ô∏è Cat√©gorie requise",description:"Veuillez s√©lectionner une cat√©gorie de document avant d'ajouter des fichiers."}),void(e.target.value="");if(o?.id)await M(s,T);else{const e=s.map(e=>({file:e,category:T}));E(s=>({...s,filesToUpload:[...s.filesToUpload,...e]})),t({title:`üìé ${s.length} fichier(s) ajout√©(s)`,description:`Cat√©gorie: ${T} - Pr√™t(s) √† √™tre t√©l√©vers√©(s) lors de la sauvegarde.`})}e.target.value=""}},multiple:!0},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:759,columnNumber:15},void 0),n.jsxDEV(i,{type:"button",variant:"outline",onClick:async()=>{try{if("ImageCapture"in globalThis&&navigator.mediaDevices)try{const e=await navigator.mediaDevices.enumerateDevices(),s=e.filter(e=>"videoinput"===e.kind).find(e=>e.label.toLowerCase().includes("scanner")||e.label.toLowerCase().includes("document")||e.label.toLowerCase().includes("scan"));if(s){t({title:"‚úÖ Scanner d√©tect√©",description:`Connexion √† ${s.label}...`});const e=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:s.deviceId},width:{ideal:1920},height:{ideal:1080}}}),n=document.createElement("video");n.srcObject=e,n.autoplay=!0,n.playsInline=!0;const i=document.createElement("div");i.style.cssText="\n              position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n              background: rgba(0,0,0,0.95); display: flex; flex-direction: column;\n              align-items: center; justify-content: center; z-index: 9999;\n            ";const a=document.createElement("div");a.style.cssText="\n              color: white; font-size: 24px; font-weight: bold; margin-bottom: 20px;\n            ",a.textContent=`üñ®Ô∏è ${s.label}`,n.style.cssText="\n              max-width: 85%; max-height: 60vh; border: 3px solid #3b82f6;\n              border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.5);\n            ";const r=document.createElement("p");r.style.cssText="\n              color: #94a3b8; font-size: 14px; margin: 15px 0; max-width: 600px; text-align: center;\n            ",r.textContent='Placez votre document dans le scanner, puis cliquez sur "Capturer" pour num√©riser';const l=document.createElement("div");l.style.cssText="display: flex; gap: 15px; margin-top: 20px;";const m=document.createElement("button");m.innerHTML="üì∏ Capturer le document",m.style.cssText="\n              padding: 15px 40px; font-size: 16px; font-weight: 600;\n              background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n              color: white; border: none; border-radius: 8px;\n              cursor: pointer; transition: all 0.3s ease;\n              box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);\n            ",m.onmouseover=()=>{m.style.transform="scale(1.05)",m.style.boxShadow="0 6px 20px rgba(59, 130, 246, 0.6)"},m.onmouseout=()=>{m.style.transform="scale(1)",m.style.boxShadow="0 4px 12px rgba(59, 130, 246, 0.4)"};const c=document.createElement("button");return c.innerHTML="‚ùå Annuler",c.style.cssText="\n              padding: 15px 30px; font-size: 16px; font-weight: 600;\n              background: #475569; color: white; border: none; border-radius: 8px;\n              cursor: pointer; transition: all 0.3s ease;\n            ",c.onmouseover=()=>{c.style.background="#64748b"},c.onmouseout=()=>{c.style.background="#475569"},l.appendChild(m),l.appendChild(c),i.appendChild(a),i.appendChild(r),i.appendChild(n),i.appendChild(l),document.body.appendChild(i),await n.play(),m.onclick=async()=>{try{m.disabled=!0,m.innerHTML="‚è≥ Num√©risation en cours...";const s=document.createElement("canvas");s.width=n.videoWidth,s.height=n.videoHeight;s.getContext("2d").drawImage(n,0,0,s.width,s.height),s.toBlob(async s=>{if(!s)return t({variant:"destructive",title:"‚ùå Erreur de capture",description:"Impossible de capturer l'image. R√©essayez."}),m.disabled=!1,void(m.innerHTML="üì∏ Capturer le document");const n=Date.now(),a=new File([s],`scan_${n}.png`,{type:"image/png"});for(const o of e.getTracks())o.stop();i.remove(),T?o?.id?await M([a],T):(E(e=>({...e,scannedFiles:[...e.scannedFiles,{file:a,category:T}]})),t({title:"‚úÖ Document num√©ris√©",description:`${a.name} captur√© avec succ√®s (${(s.size/1024).toFixed(0)} Ko) - Cat√©gorie: ${T}`})):t({variant:"destructive",title:"‚ö†Ô∏è Cat√©gorie requise",description:"Veuillez s√©lectionner une cat√©gorie de document avant de num√©riser."})},"image/png",.95)}catch(s){t({variant:"destructive",title:"‚ùå Erreur",description:"√âchec de la num√©risation. V√©rifiez le scanner."}),m.disabled=!1,m.innerHTML="üì∏ Capturer le document"}},void(c.onclick=()=>{for(const s of e.getTracks())s.stop();i.remove(),t({title:"Num√©risation annul√©e",description:"Op√©ration interrompue par l'utilisateur"})})}}catch(e){}const s=document.createElement("input");s.type="file",s.accept="image/*,application/pdf",s.multiple=!1,s.setAttribute("webkitdirectory",!1),s.onchange=e=>{const s=e.target.files[0];if(s){if(!s.type.startsWith("image/")&&"application/pdf"!==s.type)return void t({variant:"destructive",title:"‚ùå Format non support√©",description:"Veuillez s√©lectionner une image ou un PDF."});o?.id?M([s]):(E(e=>({...e,scannedFiles:[...e.scannedFiles,s]})),t({title:"ÔøΩÔ∏è Document scann√©",description:`${s.name} ajout√© depuis le scanner. Il sera upload√© lors de la sauvegarde.`}))}},t({title:"üñ®Ô∏è Scanner",description:"S√©lectionnez un document depuis votre scanner ou un fichier d√©j√† scann√©."}),s.click()}catch(s){t({variant:"destructive",title:"‚ùå Erreur Scanner",description:"Impossible d'acc√©der au scanner. V√©rifiez les permissions du navigateur."})}},className:"flex items-center justify-center gap-2 border-slate-600 text-slate-300 hover:bg-slate-700 "+(w?"border-green-500 text-green-300 bg-green-500/10":""),title:w?"Scanner d√©tect√© - Cliquez pour num√©riser":"Num√©riser un document",children:[n.jsxDEV(v,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:777,columnNumber:17},void 0),w?"üñ®Ô∏è Num√©riser (Scanner actif)":"üñ®Ô∏è Num√©riser"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:768,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:750,columnNumber:13},void 0),n.jsxDEV("div",{className:"mt-2 space-y-2",children:[k.attachments.map((e,s)=>n.jsxDEV("div",{className:"flex items-center justify-between text-sm text-slate-400 bg-slate-700/30 p-2 rounded-md",children:[n.jsxDEV("span",{children:e.split("/").pop()},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:784,columnNumber:19},void 0),n.jsxDEV(i,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>(async()=>{t({variant:"destructive",title:"Bucket non configur√©",description:"Le bucket Storage 'attachments' doit √™tre cr√©√© dans Supabase Dashboard"})})(),children:n.jsxDEV(x,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:786,columnNumber:21},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:785,columnNumber:19},void 0)]},s,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:783,columnNumber:17},void 0)),k.filesToUpload.map((e,s)=>n.jsxDEV("div",{className:"flex items-center justify-between text-sm text-green-400 bg-green-900/30 p-2 rounded-md",children:[n.jsxDEV("div",{className:"flex-1",children:[n.jsxDEV("div",{children:["üìé ",e.file.name]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:793,columnNumber:21},void 0),n.jsxDEV("div",{className:"text-xs text-blue-300 mt-1",children:["üè∑Ô∏è ",e.category]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:794,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:792,columnNumber:19},void 0),n.jsxDEV(i,{variant:"ghost",size:"icon",className:"h-6 w-6 text-red-400 hover:text-red-300",onClick:()=>{E(e=>({...e,filesToUpload:e.filesToUpload.filter((e,n)=>n!==s)}))},children:n.jsxDEV(f,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:802,columnNumber:21},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:796,columnNumber:19},void 0)]},s,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:791,columnNumber:17},void 0)),k.scannedFiles.map((e,s)=>n.jsxDEV("div",{className:"flex items-center justify-between text-sm text-blue-400 bg-blue-900/30 p-2 rounded-md",children:[n.jsxDEV("div",{className:"flex-1",children:[n.jsxDEV("div",{children:["üì∑ ",e.file.name]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:809,columnNumber:21},void 0),n.jsxDEV("div",{className:"text-xs text-blue-300 mt-1",children:["üè∑Ô∏è ",e.category]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:810,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:808,columnNumber:19},void 0),n.jsxDEV(i,{variant:"ghost",size:"icon",className:"h-6 w-6 text-red-400 hover:text-red-300",onClick:()=>{E(e=>({...e,scannedFiles:e.scannedFiles.filter((e,n)=>n!==s)}))},children:n.jsxDEV(f,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:818,columnNumber:21},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:812,columnNumber:19},void 0)]},s,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:807,columnNumber:17},void 0))]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:781,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:722,columnNumber:11},void 0),n.jsxDEV("div",{children:[n.jsxDEV("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[n.jsxDEV(h,{className:"w-4 h-4 inline mr-2"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:828,columnNumber:15},void 0),"Visible par (permissions de consultation)"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:827,columnNumber:13},void 0),n.jsxDEV("div",{className:"p-4 bg-slate-700/50 border border-slate-600 rounded-lg max-h-48 overflow-y-auto space-y-2",children:j&&j.length>0?n.jsxDEV(n.Fragment,{children:[n.jsxDEV("div",{className:"flex items-center space-x-2 pb-2 border-b border-slate-600",children:[n.jsxDEV(l,{id:"visible-all",checked:k.visible_by_ids.length===j.length,onCheckedChange:e=>{E(s=>({...s,visible_by_ids:e?j.map(e=>e.id):[]}))}},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:835,columnNumber:21},void 0),n.jsxDEV(m,{htmlFor:"visible-all",className:"text-slate-300 font-semibold cursor-pointer flex-1",children:"Tous les membres"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:845,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:834,columnNumber:19},void 0),j.map(e=>n.jsxDEV("div",{className:"flex items-center space-x-2",children:[n.jsxDEV(l,{id:`visible-${e.id}`,checked:k.visible_by_ids.includes(e.id),onCheckedChange:s=>{E(n=>({...n,visible_by_ids:s?[...n.visible_by_ids,e.id]:n.visible_by_ids.filter(s=>s!==e.id)}))}},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:854,columnNumber:23},void 0),n.jsxDEV(m,{htmlFor:`visible-${e.id}`,className:"text-slate-300 font-normal cursor-pointer flex-1",children:[e.name,e.role&&n.jsxDEV("span",{className:"ml-2 text-xs text-slate-500",children:["(",e.role,")"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:872,columnNumber:27},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:866,columnNumber:23},void 0)]},e.id,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:853,columnNumber:21},void 0))]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:833,columnNumber:17},void 0):n.jsxDEV("p",{className:"text-slate-400 text-sm",children:"Aucun membre d'√©quipe disponible"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:879,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:831,columnNumber:13},void 0),k.visible_by_ids.length>0&&n.jsxDEV("div",{className:"mt-2 flex flex-wrap gap-2",children:k.visible_by_ids.map(e=>{const s=j.find(s=>s.id===e);return s?n.jsxDEV("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs bg-green-500/20 text-green-300 border border-green-500/30",children:[n.jsxDEV(h,{className:"w-3 h-3 mr-1"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:888,columnNumber:23},void 0),s.name,n.jsxDEV("button",{type:"button",onClick:()=>{E(s=>({...s,visible_by_ids:s.visible_by_ids.filter(s=>s!==e)}))},className:"ml-2 text-green-300 hover:text-green-100",children:"√ó"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:890,columnNumber:23},void 0)]},e,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:887,columnNumber:21},void 0):null})},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:883,columnNumber:15},void 0),n.jsxDEV("p",{className:"mt-2 text-xs text-slate-500",children:"üîí S√©lectionnez les personnes autoris√©es √† consulter cette t√¢che. Les administrateurs ont toujours acc√®s."},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:907,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:826,columnNumber:11},void 0),n.jsxDEV("div",{className:"flex gap-4 pt-6",children:[n.jsxDEV(i,{type:"submit",className:"flex-1 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700",children:o?"Mettre √† jour":"Cr√©er la t√¢che"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:913,columnNumber:13},void 0),n.jsxDEV(i,{type:"button",variant:"outline",onClick:r,className:"flex-1 border-slate-600 text-slate-300 hover:bg-slate-700",children:"Annuler"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:919,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:912,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:509,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:489,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskForm.jsx",lineNumber:483,columnNumber:5},void 0)},W=({fileUrl:e,fileName:o,onClose:t,onDownload:a})=>{const[r,l]=s.useState(null),[m,c]=s.useState(1),[d,b]=s.useState(0),[p,g]=s.useState(1.5),[N,v]=s.useState(!0),[f,h]=s.useState(null),E=s.useRef(null),T=s.useRef(null),V=s.useRef(null);s.useEffect(()=>(e&&(async()=>{try{v(!0),h(null);const s=(await(async()=>window.pdfjsLib?window.pdfjsLib:new Promise((e,s)=>{const n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",n.async=!0,n.onload=()=>{window.pdfjsLib?(window.pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js",e(window.pdfjsLib)):s(new Error("PDF.js not loaded"))},n.onerror=()=>s(new Error("Failed to load PDF.js")),document.head.appendChild(n)}))()).getDocument({url:e,withCredentials:!1,disableRange:!0,disableStream:!0}),n=await s.promise;l(n),b(n.numPages),v(!1)}catch(s){h("Impossible de charger le document PDF. Veuillez r√©essayer."),v(!1)}})(),()=>{r&&r.destroy()}),[e]),s.useEffect(()=>{let e=!1;return(async()=>{if(r&&E.current&&!e)try{if(V.current){try{await V.current.cancel()}catch(s){}V.current=null}if(e||!E.current)return;const n=await r.getPage(m);if(e||!E.current)return;const o=n.getViewport({scale:p}),i=E.current,t=i.getContext("2d");t.clearRect(0,0,i.width,i.height),i.height=o.height,i.width=o.width;const a={canvasContext:t,viewport:o};if(e)return;V.current=n.render(a),await V.current.promise,e||(V.current=null)}catch(n){if("RenderingCancelledException"===n.name||e)return;e||h("Erreur lors de l'affichage de la page.")}})(),()=>{if(e=!0,V.current){try{V.current.cancel()}catch(s){}V.current=null}}},[r,m,p]);const _=()=>{m>1&&c(m-1)},z=()=>{m<d&&c(m+1)},U=e=>{"Escape"===e.key?t():"ArrowLeft"===e.key?_():"ArrowRight"===e.key&&z()};return s.useEffect(()=>(document.addEventListener("keydown",U),()=>{document.removeEventListener("keydown",U)}),[m,d]),n.jsxDEV("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4",onClick:t,children:n.jsxDEV("div",{className:"bg-slate-900 rounded-xl shadow-2xl w-full max-w-6xl max-h-[95vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[n.jsxDEV("div",{className:"flex items-center justify-between p-4 border-b border-slate-700",children:[n.jsxDEV("div",{className:"flex items-center gap-3",children:[n.jsxDEV("h3",{className:"text-lg font-semibold text-white truncate max-w-md",children:o||"Document PDF"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:216,columnNumber:13},void 0),!N&&!f&&n.jsxDEV("span",{className:"text-sm text-slate-400",children:["Page ",m," / ",d]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:220,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:215,columnNumber:11},void 0),n.jsxDEV("button",{onClick:t,className:"text-slate-400 hover:text-white transition-colors p-2 hover:bg-slate-800 rounded-lg",title:"Fermer (Esc)",children:n.jsxDEV(u,{className:"w-5 h-5"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:230,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:225,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:214,columnNumber:9},void 0),n.jsxDEV("div",{className:"flex items-center justify-between p-3 border-b border-slate-700 bg-slate-800/50",children:[n.jsxDEV("div",{className:"flex items-center gap-2",children:[n.jsxDEV(i,{variant:"outline",size:"sm",onClick:_,disabled:m<=1||N,className:"h-8 w-8 p-0",title:"Page pr√©c√©dente (‚Üê)",children:n.jsxDEV(j,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:245,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:237,columnNumber:13},void 0),n.jsxDEV(i,{variant:"outline",size:"sm",onClick:z,disabled:m>=d||N,className:"h-8 w-8 p-0",title:"Page suivante (‚Üí)",children:n.jsxDEV(D,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:255,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:247,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:236,columnNumber:11},void 0),n.jsxDEV("div",{className:"flex items-center gap-2",children:[n.jsxDEV(i,{variant:"outline",size:"sm",onClick:()=>{g(e=>Math.max(e-.25,.5))},disabled:p<=.5||N,className:"h-8 w-8 p-0",title:"Zoom arri√®re",children:n.jsxDEV(C,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:268,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:260,columnNumber:13},void 0),n.jsxDEV("span",{className:"text-sm text-slate-300 min-w-[60px] text-center",children:[Math.round(100*p),"%"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:270,columnNumber:13},void 0),n.jsxDEV(i,{variant:"outline",size:"sm",onClick:()=>{g(e=>Math.min(e+.25,3))},disabled:p>=3||N,className:"h-8 w-8 p-0",title:"Zoom avant",children:n.jsxDEV(k,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:281,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:273,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:259,columnNumber:11},void 0),a&&n.jsxDEV(i,{variant:"outline",size:"sm",onClick:a,className:"flex items-center gap-2",title:"T√©l√©charger le fichier",children:[n.jsxDEV(x,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:293,columnNumber:15},void 0),n.jsxDEV("span",{className:"hidden sm:inline",children:"T√©l√©charger"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:294,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:286,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:235,columnNumber:9},void 0),n.jsxDEV("div",{ref:T,className:"flex-1 overflow-auto bg-slate-800 flex items-start justify-center p-6",children:[N&&n.jsxDEV("div",{className:"flex flex-col items-center justify-center h-full text-slate-400",children:[n.jsxDEV("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mb-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:306,columnNumber:15},void 0),n.jsxDEV("p",{children:"Chargement du document..."},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:307,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:305,columnNumber:13},void 0),f&&n.jsxDEV("div",{className:"flex flex-col items-center justify-center h-full text-red-400",children:n.jsxDEV("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-6 max-w-md",children:[n.jsxDEV("p",{className:"text-center mb-4",children:f},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:314,columnNumber:17},void 0),n.jsxDEV(i,{variant:"outline",onClick:t,className:"w-full",children:"Fermer"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:315,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:313,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:312,columnNumber:13},void 0),!N&&!f&&n.jsxDEV("canvas",{ref:E,className:"shadow-2xl border border-slate-700 bg-white"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:327,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:300,columnNumber:9},void 0),n.jsxDEV("div",{className:"p-3 border-t border-slate-700 bg-slate-800/50",children:n.jsxDEV("p",{className:"text-xs text-slate-500 text-center",children:"Utilisez les fl√®ches ‚Üê ‚Üí pour naviguer ‚Ä¢ Esc pour fermer ‚Ä¢ Molette pour zoomer"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:336,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:335,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:209,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/PdfViewer.jsx",lineNumber:205,columnNumber:5},void 0)};W.propTypes={fileUrl:o.string.isRequired,fileName:o.string,onClose:o.func.isRequired,onDownload:o.func};const B=({currentUser:o})=>{const[l,m]=s.useState([]),[u,g]=s.useState("suivi"),[v,h]=s.useState(null),[j,D]=s.useState(""),[C,k]=s.useState("all"),[O,B]=s.useState("all"),[H,Z]=s.useState([]),[K,Y]=s.useState([]),[J,Q]=s.useState(null),[X,ee]=s.useState(""),[se,ne]=s.useState({}),[oe,ie]=s.useState(null),[te,ae]=s.useState({open:!1,title:"",message:"",onConfirm:null}),[re,le]=s.useState(null),[me,ce]=s.useState(null),[ue,de]=s.useState(null),[be,pe]=s.useState({open:!1,file:null,taskId:null}),ge=o&&("Gerant"===o.function||"Associe Emerite"===o.function)||o.role&&"admin"===o.role.toLowerCase(),Ne=(e,s=25)=>{if(!e||e.length<=s)return e;const n=e.lastIndexOf(".");if(-1===n)return e.substring(0,s-3)+"...";const o=e.substring(0,n),i=e.substring(n),t=s-i.length-3;return t<=0?e.substring(0,s-3)+"...":o.substring(0,t)+"..."+i};s.useEffect(()=>{xe(),fe(),ge&&he();const e=async e=>{const{taskId:s}=e.detail||{};if(s)try{const e=await r(s);ne(n=>({...n,[s]:e}))}catch(n){}};return window.addEventListener("refreshTaskFiles",e),()=>{window.removeEventListener("refreshTaskFiles",e)}},[ge]);const ve=e=>{const s=Array.isArray(e.attachments)?e.attachments:e.attachments&&""!==e.attachments?JSON.parse(e.attachments):[],n=se[e.id]&&se[e.id].length>0;return s.length>0||n},xe=async()=>{let e=a.from("tasks").select("id,title,description,priority,status,deadline,assigned_to_id,assigned_to_ids,assigned_to_name,visible_by_ids,case_id,attachments,created_at,updated_at,created_by_id,created_by_name,assigned_at,main_category,seen_at,completion_comment");!ge&&o?.id&&(e=e.or(`assigned_to_id.eq.${o.id},assigned_to_ids.cs.{${o.id}},visible_by_ids.cs.{${o.id}}`));const{data:s,error:n}=await e.order("created_at",{ascending:!1});if(n)t({variant:"destructive",title:"Erreur",description:"Impossible de charger les t√¢ches."});else{const e=[...new Set((s||[]).filter(e=>e.case_id).map(e=>e.case_id))];let n={};if(e.length>0){const{data:s}=await a.from("cases").select("id, title").in("id",e);s&&(n=s.reduce((e,s)=>(e[s.id]=s.title,e),{}))}const o=(s||[]).map(e=>({...e,case_title:e.case_id&&n[e.case_id]||null}));m(o);try{const e=s.map(e=>e.id),{data:n}=await a.from("tasks_files").select("*").in("task_id",e).order("created_at",{ascending:!1});if(n&&n.length>0){const e={};n.forEach(s=>{e[s.task_id]||(e[s.task_id]=[]),e[s.task_id].push({...s,source:"tasks_files",is_accessible:!0,valid_url:s.file_url})}),ne(s=>({...s,...e}))}}catch(i){}}},fe=async()=>{const{data:e,error:s}=await a.from("profiles").select("id, name, role");if(s)t({variant:"destructive",title:"Erreur",description:"Impossible de charger les collaborateurs."});else{const s=(e||[]).filter(e=>"admin"!==e.role);Z(s)}},he=async()=>{const{data:e,error:s}=await a.from("cases").select("id, title");s?t({variant:"destructive",title:"Erreur",description:"Impossible de charger les dossiers."}):Y(e)},je=async(e,s)=>{try{const{data:n}=await a.storage.listBuckets(),i=n?.some(e=>"task-scans"===e.name),r=Date.now(),l=`scan_${r}_${e.name.replaceAll(/[^a-zA-Z0-9.-]/g,"_")}`;if(!i){const n={file_url:`pending_scan/${o.id}/${s}/${l}`,file_name:l,file_size:e.size,file_type:e.type,status:"pending_upload"};return t({title:"üì∑ Scan enregistr√©",description:`"${e.name}" sera upload√© une fois le syst√®me configur√©. M√©tadonn√©es sauvegard√©es.`}),n}const m=`${o.id}/${s}/${l}`,{error:c}=await a.storage.from("task-scans").upload(m,e,{cacheControl:"3600",upsert:!1});if(c)return t({title:"‚ö†Ô∏è Erreur d'upload du scan",description:`Impossible d'uploader le scan "${e.name}": ${c.message}`}),null;const{data:u}=a.storage.from("task-scans").getPublicUrl(m),d=u?.publicUrl||m;return t({title:"‚úÖ Scan upload√©",description:`"${e.name}" upload√© (table tasks_files non cr√©√©e)`}),{file_url:d,file_name:l}}catch(n){const i=`scan_${Date.now()}_${e.name.replaceAll(/[^a-zA-Z0-9.-]/g,"_")}`,a=`pending_scan/${o.id}/${s||"new"}/${i}`;return t({title:"üì∑ Scan en attente",description:`"${e.name}" sera trait√© une fois le syst√®me de scan disponible.`}),{file_url:a,file_name:i,status:"pending_upload"}}},De=async()=>!0,Ce=e=>{const{filesToUpload:s,scannedFiles:n,...o}=e;return""===o.case_id&&(o.case_id=null),{filesToUpload:s||[],scannedFiles:n||[],data:o}},ke=async(e,s,n=!1)=>{if("completed"===s)Q(e);else{const o={status:s};"seen"!==s&&"in-progress"!==s||(o.seen_at=(new Date).toISOString()),Ee(e,o,null,n)}},Ee=async(e,s,n=null,o=!1)=>{null!==n&&(s.completion_comment=n);const{data:i,error:r}=await a.from("tasks").update(s).eq("id",e).select("id,title,description,priority,status,deadline,assigned_to_id,assigned_to_ids,assigned_to_name,visible_by_ids,case_id,attachments,created_at,updated_at,created_by_id,created_by_name,assigned_at,main_category,seen_at,completion_comment");if(r)o||t({variant:"destructive",title:"Erreur",description:"Impossible de changer le statut."});else{let s=null;if(i[0].case_id){const{data:e}=await a.from("cases").select("title").eq("id",i[0].case_id).single();s=e?.title||null}const n={...i[0],case_title:s};m(l.map(s=>s.id===e?n:s)),o||t({title:"‚úÖ Statut mis √† jour"})}},Te=l.filter(e=>{if(!e||!e.title)return!1;const s=e.title.toLowerCase().includes(j.toLowerCase())||e.description?.toLowerCase().includes(j.toLowerCase()),n="all"===C||e.status===C,o="all"===O||e.priority===O;return s&&n&&o}),Ve={all:l.length,pending:l.filter(e=>"pending"===e.status).length,seen:l.filter(e=>"seen"===e.status).length,"in-progress":l.filter(e=>"in-progress"===e.status).length,completed:l.filter(e=>"completed"===e.status).length},_e=e=>{switch(e){case"pending":return"bg-blue-500/20 text-blue-300 border-blue-500/30";case"seen":return"bg-purple-500/20 text-purple-300 border-purple-500/30";case"in-progress":return"bg-yellow-500/20 text-yellow-300 border-yellow-500/30";case"completed":return"bg-green-500/20 text-green-300 border-green-500/30";default:return"bg-gray-500/20 text-gray-300 border-gray-500/30"}},ze=e=>{switch(e){case"pending":return"En attente";case"seen":return"Vue";case"in-progress":return"En cours";case"completed":return"Termin√©e";default:return e}};return n.jsxDEV("div",{className:"space-y-6",children:[n.jsxDEV("div",{className:"flex items-center justify-between",children:n.jsxDEV("div",{children:[n.jsxDEV("h1",{className:"text-3xl font-bold text-white mb-2",children:"Gestion des T√¢ches"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1119,columnNumber:11},void 0),n.jsxDEV("p",{className:"text-slate-400",children:"Organisez et suivez vos t√¢ches juridiques"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1120,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1118,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1117,columnNumber:7},void 0),n.jsxDEV("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-2",children:n.jsxDEV("div",{className:"flex space-x-2",children:[n.jsxDEV(i,{variant:"suivi"===u?"default":"ghost",onClick:()=>g("suivi"),className:"flex-1 justify-center gap-2 "+("suivi"===u?"bg-blue-600":""),children:[n.jsxDEV(E,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1131,columnNumber:13},void 0)," Suivi de T√¢ches"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1126,columnNumber:11},void 0),n.jsxDEV(i,{variant:"nouvelle"===u?"default":"ghost",onClick:()=>{g("nouvelle"),h(null)},className:"flex-1 justify-center gap-2 "+("nouvelle"===u?"bg-blue-600":""),children:[n.jsxDEV(T,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1141,columnNumber:13},void 0)," ",v?"Modifier la T√¢che":"Nouvelle T√¢che"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1133,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1125,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1124,columnNumber:7},void 0),"suivi"===u&&n.jsxDEV(c.div,{initial:{opacity:0},animate:{opacity:1},children:[n.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6",children:[{key:"all",label:"Total",color:"bg-slate-600"},{key:"pending",label:"En Attente",color:"bg-orange-500"},{key:"seen",label:"Vues",color:"bg-purple-500"},{key:"in-progress",label:"En Cours",color:"bg-blue-500"},{key:"completed",label:"Termin√©es",color:"bg-green-500"}].map(e=>n.jsxDEV(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-lg p-4",children:n.jsxDEV("div",{className:"flex items-center justify-between",children:[n.jsxDEV("div",{children:[n.jsxDEV("p",{className:"text-slate-400 text-sm",children:e.label},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1164,columnNumber:21},void 0),n.jsxDEV("p",{className:"text-2xl font-bold text-white",children:Ve[e.key]},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1165,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1163,columnNumber:19},void 0),n.jsxDEV("div",{className:`w-3 h-3 ${e.color} rounded-full`},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1167,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1162,columnNumber:17},void 0)},e.key,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1156,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1148,columnNumber:11},void 0),n.jsxDEV("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6 mb-6",children:n.jsxDEV("div",{className:"flex flex-col md:flex-row gap-4",children:[n.jsxDEV("div",{className:"flex-1",children:n.jsxDEV("div",{className:"relative",children:[n.jsxDEV(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1177,columnNumber:19},void 0),n.jsxDEV("input",{type:"text",placeholder:"Rechercher une t√¢che...",value:j,onChange:e=>D(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1178,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1176,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1175,columnNumber:15},void 0),n.jsxDEV("div",{className:"flex gap-4",children:[n.jsxDEV("select",{value:C,onChange:e=>k(e.target.value),className:"px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsxDEV("option",{value:"all",children:"Tous les statuts"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1193,columnNumber:19},void 0),n.jsxDEV("option",{value:"pending",children:"En attente"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1194,columnNumber:19},void 0),n.jsxDEV("option",{value:"seen",children:"Vue"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1195,columnNumber:19},void 0),n.jsxDEV("option",{value:"in-progress",children:"En cours"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1196,columnNumber:19},void 0),n.jsxDEV("option",{value:"completed",children:"Termin√©es"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1197,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1188,columnNumber:17},void 0),n.jsxDEV("select",{value:O,onChange:e=>B(e.target.value),className:"px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsxDEV("option",{value:"all",children:"Toutes les priorit√©s"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1204,columnNumber:19},void 0),n.jsxDEV("option",{value:"low",children:"Faible"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1205,columnNumber:19},void 0),n.jsxDEV("option",{value:"medium",children:"Moyenne"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1206,columnNumber:19},void 0),n.jsxDEV("option",{value:"high",children:"√âlev√©e"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1207,columnNumber:19},void 0),n.jsxDEV("option",{value:"urgent",children:"Urgente"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1208,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1199,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1187,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1174,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1173,columnNumber:11},void 0),n.jsxDEV("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl border border-slate-700/50 overflow-hidden",children:[n.jsxDEV("div",{className:"hidden lg:grid lg:grid-cols-12 gap-4 px-6 py-3 bg-slate-900/50 border-b border-slate-700/30",children:[n.jsxDEV("div",{className:"col-span-1 text-xs font-medium text-slate-400"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1216,columnNumber:15},void 0),n.jsxDEV("div",{className:"col-span-4 text-xs font-medium text-slate-300",children:"T√¢che"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1217,columnNumber:15},void 0),n.jsxDEV("div",{className:"col-span-2 text-xs font-medium text-slate-300",children:"Dossier"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1218,columnNumber:15},void 0),n.jsxDEV("div",{className:"col-span-2 text-xs font-medium text-slate-300",children:"√âch√©ance & Assign√©"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1219,columnNumber:15},void 0),n.jsxDEV("div",{className:"col-span-2 text-xs font-medium text-slate-300",children:"Statut"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1220,columnNumber:15},void 0),n.jsxDEV("div",{className:"col-span-1 text-xs font-medium text-slate-300 text-right",children:"Priorit√©"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1221,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1215,columnNumber:13},void 0),Te.map((s,u)=>{const v=(e=>{switch(e){case"urgent":case"high":return{label:"HAUTE",class:"bg-red-500/20 text-red-300 border-red-500/40"};case"medium":default:return{label:"MOYENNE",class:"bg-yellow-500/20 text-yellow-300 border-yellow-500/40"};case"low":return{label:"FAIBLE",class:"bg-slate-500/20 text-slate-400 border-slate-500/40"}}})(s.priority);return n.jsxDEV(c.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.03*u},className:"border-b border-slate-700/30 last:border-0 hover:bg-slate-700/30 transition-colors",children:[n.jsxDEV("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4 px-6 py-4 items-center",children:[n.jsxDEV("div",{className:"lg:col-span-1 flex items-center",children:n.jsxDEV("input",{type:"checkbox",checked:"completed"===s.status,onChange:()=>{"completed"===s.status?ke(s.id,"in-progress",!0):ke(s.id,"completed",!1)},className:"w-5 h-5 rounded border-slate-600 bg-slate-700/50 text-blue-500 focus:ring-blue-500 focus:ring-2 cursor-pointer"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1237,columnNumber:23},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1236,columnNumber:21},void 0),n.jsxDEV("div",{className:"lg:col-span-4",children:n.jsxDEV("div",{className:"flex items-start gap-2",children:[n.jsxDEV("h4",{className:"text-sm font-semibold text-white line-clamp-2 flex-1 "+("completed"===s.status?"line-through text-slate-500":""),children:s.title},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1253,columnNumber:25},void 0),ve(s)&&n.jsxDEV("button",{onClick:async()=>{const e=oe===s.id?null:s.id;if(ie(e),e&&!se[s.id]){const e=await(async(e,s=null)=>{try{return await r(e,s)}catch(n){return[]}})(s.id,s.attachments);ne(n=>({...n,[s.id]:e}))}},title:`${se[s.id]?.length||0} document(s) joint(s)`,className:"flex items-center gap-1 px-2 py-0.5 rounded-full bg-blue-500/20 text-blue-300 hover:bg-blue-500/30 transition-colors text-xs",children:[n.jsxDEV(N,{className:"w-3 h-3"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1273,columnNumber:29},void 0),se[s.id]?.length||0]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1261,columnNumber:27},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1252,columnNumber:23},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1251,columnNumber:21},void 0),n.jsxDEV("div",{className:"lg:col-span-2",children:s.case_title?n.jsxDEV("div",{className:"flex items-center gap-2 text-xs text-slate-300",children:[n.jsxDEV(b,{className:"w-3 h-3 text-slate-400"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1283,columnNumber:27},void 0),n.jsxDEV("span",{className:"truncate max-w-[200px]",title:s.case_title,children:s.case_title},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1284,columnNumber:27},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1282,columnNumber:25},void 0):n.jsxDEV("span",{className:"text-xs text-slate-500",children:"Aucun dossier"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1289,columnNumber:25},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1280,columnNumber:21},void 0),n.jsxDEV("div",{className:"lg:col-span-2 space-y-1",children:[n.jsxDEV("div",{className:"flex items-center gap-2 text-xs text-slate-300",children:[n.jsxDEV(d,{className:"w-3 h-3 text-slate-400"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1295,columnNumber:25},void 0),n.jsxDEV("span",{children:["√âch√©ance: ",s.deadline?(j=s.deadline,j?new Date(j).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A"):"N/A"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1296,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1294,columnNumber:23},void 0),n.jsxDEV("div",{className:"flex items-center gap-2 text-xs text-slate-300",children:[n.jsxDEV(p,{className:"w-3 h-3 text-slate-400"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1299,columnNumber:25},void 0),n.jsxDEV("span",{children:["Assign√© √†: ",s.assigned_to_name||"Non assign√©"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1300,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1298,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1293,columnNumber:21},void 0),n.jsxDEV("div",{className:"lg:col-span-2 flex items-center gap-2",children:n.jsxDEV("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium border ${_e(s.status)}`,children:["completed"===s.status&&n.jsxDEV(_,{className:"w-3 h-3 mr-1"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1310,columnNumber:57},void 0),"pending"===s.status&&n.jsxDEV(z,{className:"w-3 h-3 mr-1 text-blue-300"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1311,columnNumber:55},void 0),"in-progress"===s.status&&n.jsxDEV(U,{className:"w-3 h-3 mr-1 text-yellow-300"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1313,columnNumber:27},void 0),ze(s.status)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1305,columnNumber:23},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1304,columnNumber:21},void 0),n.jsxDEV("div",{className:"lg:col-span-1 flex items-center justify-end gap-2",children:[n.jsxDEV("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-bold border ${v.class}`,children:v.label},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1320,columnNumber:23},void 0),n.jsxDEV("div",{className:"flex items-center gap-1",children:[n.jsxDEV(i,{variant:"ghost",size:"sm",onClick:()=>(e=>{h(e),g("nouvelle")})(s),className:"h-7 w-7 p-0 text-slate-400 hover:text-white hover:bg-slate-700/50",title:"Modifier",children:n.jsxDEV(b,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1334,columnNumber:27},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1327,columnNumber:25},void 0),ge&&n.jsxDEV(i,{variant:"ghost",size:"sm",onClick:()=>{ae({open:!0,title:"Supprimer la t√¢che",message:`Voulez-vous vraiment supprimer la t√¢che "${s.title}" ?\n\nCette action est irr√©versible.`,onConfirm:()=>{(async e=>{const{error:s}=await a.from("tasks").delete().eq("id",e);if(s)t({variant:"destructive",title:"Erreur",description:"Impossible de supprimer la t√¢che."});else{m(l.filter(s=>s.id!==e));const s=new CustomEvent("taskDeleted",{detail:{taskId:e}});window.dispatchEvent(s),t({title:"üóëÔ∏è T√¢che supprim√©e",description:"La t√¢che a √©t√© supprim√©e."})}})(s.id),ae(e=>({...e,open:!1}))}})},className:"h-7 w-7 p-0 text-red-400 hover:text-red-300 hover:bg-red-500/20",title:"Supprimer",children:n.jsxDEV(f,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1355,columnNumber:29},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1338,columnNumber:27},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1326,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1319,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1235,columnNumber:19},void 0),oe===s.id&&(ve(s)||se[s.id]&&se[s.id].length>0)&&n.jsxDEV(c.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-4 pt-4 border-t border-slate-700/50",children:[n.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[n.jsxDEV("div",{className:"flex items-center gap-2",children:[n.jsxDEV(b,{className:"w-4 h-4 text-blue-400"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1373,columnNumber:29},void 0),n.jsxDEV("h5",{className:"text-sm font-semibold text-blue-400",children:["Documents li√©s (",se[s.id]?.length||0,")"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1374,columnNumber:29},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1372,columnNumber:27},void 0),n.jsxDEV(i,{variant:"ghost",size:"sm",onClick:()=>(s=>{const n=document.createElement("input");n.type="file",n.multiple=!0,n.accept=".pdf,.doc,.docx,.jpg,.jpeg,.png",n.onchange=async n=>{const i=Array.from(n.target.files);if(0!==i.length){de(s);try{const{uploadMultipleTaskFiles:n}=await e(async()=>{const{uploadMultipleTaskFiles:e}=await import("./index-BzUzpWLW.js").then(e=>e.n);return{uploadMultipleTaskFiles:e}},__vite__mapDeps([0,1,2,3,4,5,6])),a=await n(i,s,o?.id);if(a.success){const e=se[s]||[];ne(n=>({...n,[s]:[...a.data,...e]})),oe!==s&&ie(s),t({title:"‚úÖ Fichiers ajout√©s",description:`${a.data.length} fichier(s) ajout√©s √† la t√¢che.`})}else a.errors&&a.errors.length>0&&t({title:"‚ö†Ô∏è Erreur d'upload",description:a.summary,variant:"destructive"})}catch(a){t({variant:"destructive",title:"‚ùå Erreur d'upload",description:`√âchec de l'upload: ${a.message}`})}finally{de(null)}}},n.click()})(s.id),disabled:ue===s.id,className:"h-7 px-3 gap-1.5 text-blue-400 hover:text-blue-300 hover:bg-blue-500/20",title:"Ajouter un document",children:[n.jsxDEV(y,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1386,columnNumber:29},void 0),n.jsxDEV("span",{className:"text-xs font-medium",children:"Ajouter un fichier"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1387,columnNumber:29},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1378,columnNumber:27},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1371,columnNumber:25},void 0),n.jsxDEV("div",{className:"space-y-2",children:(se[s.id]||[]).map(o=>{const i="attachments"===o.source,r="tasks_files"===o.source,l=r?"üìÅ":i?"üìé":"üì∑",m=o.is_accessible&&(o.valid_url||o.file_url?.startsWith("http"));return n.jsxDEV("div",{className:"flex items-center justify-between p-3 bg-slate-700/30 rounded-lg border border-slate-600/30 hover:border-slate-500/50 transition-colors",children:[n.jsxDEV("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[n.jsxDEV(b,{className:"w-4 h-4 flex-shrink-0 "+(r?"text-green-400":i?"text-slate-400":"text-blue-400")},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1409,columnNumber:35},void 0),n.jsxDEV("div",{className:"flex-1 min-w-0",children:[n.jsxDEV("span",{className:"text-sm text-slate-200 block",title:o.file_name,children:[l," ",Ne(o.file_name)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1419,columnNumber:37},void 0),n.jsxDEV("div",{className:"flex items-center gap-2 mt-1",children:[o.file_size&&n.jsxDEV("span",{className:"text-xs text-slate-500",children:[Math.round(o.file_size/1024)," KB"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1427,columnNumber:41},void 0),n.jsxDEV("span",{className:"text-xs flex items-center gap-1 "+(o.document_category?"text-blue-400":"text-slate-500"),children:[n.jsxDEV("span",{className:"inline-block w-1.5 h-1.5 rounded-full "+(o.document_category?"bg-blue-400":"bg-slate-500")},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1432,columnNumber:41},void 0),o.document_category||"Non class√©"]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1431,columnNumber:39},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1425,columnNumber:37},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1418,columnNumber:35},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1408,columnNumber:33},void 0),m||w(o)?n.jsxDEV("div",{className:"flex items-center gap-2 flex-shrink-0",children:[n.jsxDEV("button",{onClick:async()=>{try{const n=(o.file_name||"").trim().replace(/[\)\]\}]+\s*$/g,""),i=n.lastIndexOf(".");let r="";if(i>0){r=n.substring(i+1).replace(/[^a-z0-9]/gi,"").toLowerCase()}const l=["doc","docx"].includes(r);let m=null;if("pdf"===r)m=await(async e=>{try{if(!e||!e.file_url)return null;let s="attachments",n="";if(e.file_url.startsWith("http")){const o=new URL(e.file_url).pathname.split("/"),i=o.indexOf("public");if(!(-1!==i&&o.length>i+1))return null;s=o[i+1],n=o.slice(i+2).join("/")}else{const o=e.file_url.replace(/^public\//,"").split("/");s=o[0]||"attachments",n=o.slice(1).join("/")}if(!n)return null;const{data:o,error:i}=await a.storage.from(s).createSignedUrl(n,3600,{download:!1});if(i||!o?.signedUrl)return null;const t=new URL(o.signedUrl);return t.searchParams.delete("download"),t.toString()}catch(s){return null}})(o);else{if(!l)return void t({variant:"destructive",title:"Format non support√©",description:"Seuls les fichiers PDF et Word (.doc, .docx) peuvent √™tre pr√©visualis√©s."});t({title:"Conversion en cours...",description:"Conversion du document Word en PDF pour pr√©visualisation"});try{const{getConvertedPdfUrl:s}=await e(async()=>{const{getConvertedPdfUrl:e}=await import("./index-BzUzpWLW.js").then(e=>e.n);return{getConvertedPdfUrl:e}},__vite__mapDeps([0,1,2,3,4,5,6]));m=await s(o)}catch(s){return void t({variant:"destructive",title:"Conversion impossible",description:"Le service de conversion Word ‚Üí PDF n'est pas disponible. Utilisez le bouton T√©l√©charger."})}}m?(le(o),ce(m)):t({variant:"destructive",title:"Erreur",description:"Impossible de g√©n√©rer l'URL de pr√©visualisation"})}catch(n){t({variant:"destructive",title:"Erreur",description:"Impossible d'ouvrir le fichier en pr√©visualisation"})}},className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",title:"Pr√©visualiser le fichier (PDF et Word support√©s)",children:"Pr√©visualiser"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1441,columnNumber:37},void 0),n.jsxDEV("button",{onClick:()=>G(o),className:"p-1.5 text-green-400 hover:text-green-300 transition-colors",title:"T√©l√©charger le fichier",children:n.jsxDEV(x,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1531,columnNumber:39},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1526,columnNumber:37},void 0),n.jsxDEV("button",{onClick:()=>{pe({open:!0,file:o,taskId:s.id})},className:"p-1.5 text-red-400 hover:text-red-300 hover:bg-red-500/20 rounded transition-colors",title:"Supprimer le fichier",children:n.jsxDEV(f,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1544,columnNumber:39},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1533,columnNumber:37},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1440,columnNumber:35},void 0):n.jsxDEV("span",{className:"text-red-500 text-xs flex-shrink-0",title:"Fichier non disponible (ni URL ni backup local)",children:"‚ùå Indisponible"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1548,columnNumber:35},void 0)]},`file-${o.id}`,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1404,columnNumber:31},void 0)})},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1390,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1365,columnNumber:23},void 0)]},s.id,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1228,columnNumber:17},void 0);var j}),0===Te.length&&n.jsxDEV("div",{className:"text-center py-16",children:[n.jsxDEV(E,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1567,columnNumber:17},void 0),n.jsxDEV("h3",{className:"text-lg font-semibold text-slate-400 mb-2",children:"Aucune t√¢che trouv√©e"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1568,columnNumber:17},void 0),n.jsxDEV("p",{className:"text-sm text-slate-500",children:j||"all"!==C||"all"!==O?"Essayez de modifier vos filtres de recherche":'Cliquez sur "Nouvelle T√¢che" pour commencer'},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1569,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1566,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1214,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1147,columnNumber:9},void 0),"nouvelle"===u&&n.jsxDEV(c.div,{initial:{opacity:0},animate:{opacity:1},children:n.jsxDEV(q,{task:v,onSubmit:v?async s=>{const{filesToUpload:n,scannedFiles:i,data:r}=Ce(s),c=H.find(e=>e.id===r.assigned_to_id);n&&n.length>0&&(async()=>{try{let s;if(n.length>0&&n[0]&&"object"==typeof n[0]&&"file"in n[0]&&"category"in n[0]){const{uploadMultipleTaskFilesWithCategory:i}=await e(async()=>{const{uploadMultipleTaskFilesWithCategory:e}=await import("./index-BzUzpWLW.js").then(e=>e.n);return{uploadMultipleTaskFilesWithCategory:e}},__vite__mapDeps([0,1,2,3,4,5,6])),t=n[0].category,a=n.map(e=>e.file);s=await i(a,v.id,o?.id,t)}else{const{uploadMultipleTaskFiles:i}=await e(async()=>{const{uploadMultipleTaskFiles:e}=await import("./index-BzUzpWLW.js").then(e=>e.n);return{uploadMultipleTaskFiles:e}},__vite__mapDeps([0,1,2,3,4,5,6]));s=await i(n,v.id,o?.id)}if(s.success){const e=se[v.id]||[];ne(n=>({...n,[v.id]:[...s.data,...e]})),t({title:"‚úÖ Fichiers upload√©s",description:`${s.data.length} fichier(s) ajout√©s.`})}else s.errors&&s.errors.length>0&&(s.errors.forEach(e=>{}),t({title:"‚ö†Ô∏è Erreur upload",description:s.summary,variant:"destructive"}))}catch(s){t({title:"‚ùå Erreur d'upload",description:`√âchec de l'upload : ${s.message||"Erreur inconnue"}`,variant:"destructive"})}})().catch(e=>{}),i&&i.length>0&&(async()=>{try{if(i.length>0&&i[0].file&&i[0].category){const{uploadMultipleTaskFilesWithCategory:s}=await e(async()=>{const{uploadMultipleTaskFilesWithCategory:e}=await import("./index-BzUzpWLW.js").then(e=>e.n);return{uploadMultipleTaskFilesWithCategory:e}},__vite__mapDeps([0,1,2,3,4,5,6])),n=i.reduce((e,s)=>(e[s.category]||(e[s.category]=[]),e[s.category].push(s.file),e),{});for(const[e,i]of Object.entries(n)){(await s(i,v.id,o?.id,e)).success}}else{if(!(await De()))return;for(const e of i){await je(e,v.id)}}}catch(s){t({title:"‚ö†Ô∏è Erreur upload scan",description:`Impossible d'uploader les scans : ${s.message||"Erreur inconnue"}`,variant:"destructive"})}})().catch(e=>{}),v.assigned_to_id!==r.assigned_to_id&&r.assigned_to_id?(r.assigned_at=(new Date).toISOString(),r.seen_at=null):r.assigned_to_id||(r.assigned_at=null);const{associated_tasks:u,attachments:d,...b}=r,p={...b,assigned_to_name:c?c.name:null,assigned_to_ids:r.assigned_to_id?[r.assigned_to_id]:[]};for(const e of Object.keys(p))""!==p[e]&&void 0!==p[e]||(p[e]=null);const{data:N,error:x}=await a.from("tasks").update(p).eq("id",v.id).select("id,title,description,priority,status,deadline,assigned_to_id,assigned_to_ids,assigned_to_name,visible_by_ids,case_id,created_at,updated_at,created_by_id,created_by_name,assigned_at,main_category,seen_at,completion_comment").single();if(x)t({variant:"destructive",title:"Erreur",description:`Impossible de modifier la t√¢che: ${x.message}`});else{let e=null;if(N.case_id){const{data:s}=await a.from("cases").select("title").eq("id",N.case_id).single();e=s?.title||null}const s={...N,case_title:e};if(m(l.map(e=>e.id===v.id?s:e)),h(null),g("suivi"),s?.deadline){const e=new CustomEvent("taskUpdated",{detail:{task:s,deadline:s.deadline}});window.dispatchEvent(e)}let o="La t√¢che a √©t√© mise √† jour.";i&&i.length>0&&(o+=` ${i.length} scan(s) en cours d'upload.`),n&&n.length>0&&(o+=` ${n.length} fichier(s) en cours d'upload.`),t({title:"‚úÖ T√¢che modifi√©e",description:o})}}:async s=>{const{filesToUpload:n,scannedFiles:i,data:r}=Ce(s),c=H.find(e=>e.id===r.assigned_to_id),u={...r,assigned_to_name:c?c.name:null,assigned_at:r.assigned_to_id?(new Date).toISOString():null,assigned_to_ids:r.assigned_to_id?[r.assigned_to_id]:[],created_by_id:o.id,created_by_name:o.name},{attachments:d,associated_tasks:b,...p}=u;for(const e of Object.keys(p))""!==p[e]&&void 0!==p[e]||(p[e]=null);const{data:N,error:v}=await a.from("tasks").insert([p]).select("id,title,description,priority,status,deadline,assigned_to_id,assigned_to_ids,assigned_to_name,visible_by_ids,case_id,created_at,updated_at,created_by_id,created_by_name,assigned_at,main_category,seen_at,completion_comment").single();if(v)return void t({variant:"destructive",title:"Erreur",description:`Impossible de cr√©er la t√¢che: ${v.message}`});let x=null;if(N.case_id){const{data:e}=await a.from("cases").select("title").eq("id",N.case_id).single();x=e?.title||null}const f={...N,case_title:x};if(n&&n.length>0&&(async()=>{try{let s;if(n.length>0&&n[0]&&"object"==typeof n[0]&&"file"in n[0]&&"category"in n[0]){const{uploadMultipleTaskFilesWithCategory:i}=await e(async()=>{const{uploadMultipleTaskFilesWithCategory:e}=await import("./index-BzUzpWLW.js").then(e=>e.n);return{uploadMultipleTaskFilesWithCategory:e}},__vite__mapDeps([0,1,2,3,4,5,6])),t=n[0].category,a=n.map(e=>e.file);s=await i(a,N.id,o?.id,t)}else{const{uploadMultipleTaskFiles:i}=await e(async()=>{const{uploadMultipleTaskFiles:e}=await import("./index-BzUzpWLW.js").then(e=>e.n);return{uploadMultipleTaskFiles:e}},__vite__mapDeps([0,1,2,3,4,5,6]));s=await i(n,N.id,o?.id)}if(s.success)ne(e=>({...e,[N.id]:s.data})),s.data&&s.data.length>0&&ie(N.id),t({title:"‚úÖ Fichiers upload√©s",description:`${s.data.length} fichier(s) ajout√©s √† la t√¢che.`});else if(s.errors&&s.errors.length>0){s.errors.forEach(e=>{});const e=s.errors.some(e=>e.error?.includes("bucket 'attachments'")||e.error?.includes("non configur"));t(e?{title:"‚ö†Ô∏è Stockage non configur√©",description:"Le bucket 'attachments' doit √™tre cr√©√© dans Supabase.",variant:"destructive"}:{title:"‚ö†Ô∏è Erreur upload",description:s.summary}),s.data&&s.data.length>0&&ne(e=>({...e,[N.id]:s.data}))}}catch(s){t({title:"‚ùå Erreur d'upload",description:`√âchec de l'upload des fichiers : ${s.message||"Erreur inconnue"}`,variant:"destructive"})}})().catch(e=>{t({title:"‚ùå Erreur critique",description:"Une erreur inattendue s'est produite lors de l'upload.",variant:"destructive"})}),i&&i.length>0&&(async()=>{try{if(i.length>0&&i[0].file&&i[0].category){const{uploadMultipleTaskFilesWithCategory:s}=await e(async()=>{const{uploadMultipleTaskFilesWithCategory:e}=await import("./index-BzUzpWLW.js").then(e=>e.n);return{uploadMultipleTaskFilesWithCategory:e}},__vite__mapDeps([0,1,2,3,4,5,6])),n=i.reduce((e,s)=>(e[s.category]||(e[s.category]=[]),e[s.category].push(s.file),e),{});for(const[e,i]of Object.entries(n)){(await s(i,N.id,o?.id,e)).success}}else{if(!(await De()))return;for(const e of i){await je(e,N.id)}}}catch(s){t({title:"‚ö†Ô∏è Erreur upload scan",description:`Impossible d'uploader les scans : ${s.message||"Erreur inconnue"}`,variant:"destructive"})}})().catch(e=>{}),m([f,...l]),n&&n.length>0&&ie(f.id),f.deadline){const e=new CustomEvent("taskCreated",{detail:{task:f,deadline:f.deadline}});window.dispatchEvent(e)}g("suivi");const h=n&&n.length>0?`La nouvelle t√¢che a √©t√© ajout√©e. Upload des ${n.length} fichier(s) en cours.`:"La nouvelle t√¢che a √©t√© ajout√©e.";t({title:"‚úÖ T√¢che cr√©√©e",description:h})},onCancel:()=>{g("suivi"),h(null)},teamMembers:H,cases:K,currentUser:o},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1582,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1581,columnNumber:9},void 0),n.jsxDEV(F,{open:null!==J,onOpenChange:()=>Q(null),children:n.jsxDEV(M,{children:[n.jsxDEV(S,{children:[n.jsxDEV(P,{children:"Ajouter un commentaire de cl√¥ture"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1599,columnNumber:13},void 0),n.jsxDEV(A,{children:"La t√¢che est termin√©e. Veuillez ajouter un commentaire pour r√©sumer le travail effectu√©."},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1600,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1598,columnNumber:11},void 0),n.jsxDEV("textarea",{value:X,onChange:e=>ee(e.target.value),placeholder:"Ex: Le rapport a √©t√© envoy√© au client pour validation.",className:"w-full mt-4 px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1604,columnNumber:11},void 0),n.jsxDEV($,{children:[n.jsxDEV(L,{onClick:()=>Ee(J,{status:"completed"},null,!1),children:"Passer"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1612,columnNumber:13},void 0),n.jsxDEV(I,{onClick:()=>{J&&(Ee(J,{status:"completed"},X,!1),Q(null),ee(""))},children:"Enregistrer"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1619,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1611,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1597,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1596,columnNumber:7},void 0),me&&re&&n.jsxDEV(W,{fileUrl:me,fileName:re.file_name,onClose:()=>{ce(null),le(null)},onDownload:()=>G(re)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1625,columnNumber:9},void 0),n.jsxDEV(F,{open:be.open,onOpenChange:e=>pe(s=>({...s,open:e})),children:n.jsxDEV(M,{children:[n.jsxDEV(S,{children:[n.jsxDEV(P,{children:"Supprimer le fichier"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1642,columnNumber:13},void 0),n.jsxDEV(A,{children:['Voulez-vous vraiment supprimer le fichier "',be.file?.file_name,'" ?',n.jsxDEV("br",{},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1645,columnNumber:15},void 0),n.jsxDEV("br",{},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1645,columnNumber:21},void 0),"Cette action est irr√©versible et le fichier sera supprim√© d√©finitivement."]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1643,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1641,columnNumber:11},void 0),n.jsxDEV($,{children:[n.jsxDEV(L,{onClick:()=>pe({open:!1,file:null,taskId:null}),children:"Annuler"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1650,columnNumber:13},void 0),n.jsxDEV(I,{onClick:()=>{be.file&&be.taskId&&(async(e,s)=>{try{if("tasks_files"===e.source&&e.id){const{error:s}=await a.from("tasks_files").delete().eq("id",e.id);if(s)return void t({variant:"destructive",title:"Erreur",description:`Impossible de supprimer le fichier: ${s.message}`})}if(e.file_url)try{let s="attachments",n="";if(e.file_url.startsWith("http")){const o=new URL(e.file_url).pathname.split("/"),i=o.indexOf("public");-1!==i&&o.length>i+1&&(s=o[i+1],n=o.slice(i+2).join("/"))}else{const o=e.file_url.replace(/^public\//,"").split("/");s=o[0]||"attachments",n=o.slice(1).join("/")}if(n){const{error:e}=await a.storage.from(s).remove([n])}}catch(n){}ne(n=>({...n,[s]:(n[s]||[]).filter(s=>s.id!==e.id)})),t({title:"‚úÖ Fichier supprim√©",description:`"${e.file_name}" a √©t√© supprim√© avec succ√®s.`})}catch(o){t({variant:"destructive",title:"‚ùå Erreur",description:`Impossible de supprimer le fichier: ${o.message}`})}})(be.file,be.taskId),pe({open:!1,file:null,taskId:null})},className:"bg-red-600 hover:bg-red-700",children:"Supprimer"},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1655,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1649,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1640,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1636,columnNumber:7},void 0),n.jsxDEV(R,{open:te.open,onOpenChange:e=>ae(s=>({...s,open:e})),title:te.title,message:te.message,onConfirm:te.onConfirm},void 0,!1,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1670,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/gouzman/Documents/Gestion-Cab/src/components/TaskManager.jsx",lineNumber:1116,columnNumber:5},void 0)};B.propTypes={currentUser:o.shape({id:o.string,name:o.string,email:o.string,role:o.string,function:o.string,permissions:o.object})};export{B as default};
