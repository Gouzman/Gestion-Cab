import{r as e,j as s,P as t}from"./vendor-react-DYPeng9G.js";import{B as i,s as l,t as a}from"./index-0LlzAmpO.js";import{m as r,X as n,F as o,u as c,a0 as d,U as u,b as m,M as x,z as h,l as p,q as g,f as b,$ as f,a6 as j,_ as v}from"./vendor-ui-DYDeDtSQ.js";import{g as N}from"./clientUtils-CA0eKa9v.js";import{C as y}from"./ConfirmationModal-CduQsMHX.js";import"./vendor-supabase-DEEIiAjM.js";const _=e=>{if(!e)return"";const s=Number(String(e).replace(/[^0-9]/g,""));return new Intl.NumberFormat("fr-FR").format(s)},w=({case:t,onSubmit:p,onCancel:g,currentUser:b})=>{const[f,j]=e.useState({title:"",code_dossier:"",case_type:"",client_id:"",objet_du_dossier:"",type_de_diligence:"",qualite_du_client:"personne_physique",opposing_party:"",assigned_to:"",next_hearing:"",description:"",status:"en-cours",priority:"medium",honoraire:"",notes:"",attachments:[],visible_to:[]}),[v,N]=e.useState([]),[y,w]=e.useState([]);e.useEffect(()=>{(async()=>{const{data:e,error:s}=await l.from("profiles").select("id, name, role");if(s)a({variant:"destructive",title:"Erreur",description:"Impossible de charger les membres de l'Ã©quipe."});else{const s=(e||[]).filter(e=>"admin"!==e.role);N(s.filter(e=>e.id!==b.id))}const{data:t,error:i}=await l.from("clients").select("id, client_code, name, type, first_name, last_name, company").order("client_code",{ascending:!0});i?a({variant:"destructive",title:"Erreur",description:"Impossible de charger les clients."}):w(t||[])})()},[b.id]),e.useEffect(()=>{t&&j({title:t.title||"",code_dossier:t.code_dossier||"",case_type:t.case_type||"",client_id:t.client_id||"",objet_du_dossier:t.objet_du_dossier||"",type_de_diligence:t.type_de_diligence||"",qualite_du_client:t.qualite_du_client||"personne_physique",opposing_party:t.opposing_party||"",assigned_to:t.assigned_to||"",next_hearing:t.next_hearing||"",description:t.description||"",status:t.status||"en-cours",priority:t.priority||"medium",honoraire:t.honoraire?_(t.honoraire):"",notes:t.notes||"",attachments:t.attachments||[],visible_to:t.visible_to||[]})},[t]);const C=e=>{const{name:s,value:t,type:i}=e.target;j("honoraire"===s?e=>({...e,honoraire:_(t)}):e=>({...e,[s]:"number"===i?parseFloat(t)||0:t}))},k=e=>{if(e.target.files&&e.target.files[0]){const s=e.target.files[0];j(e=>({...e,attachments:[...e.attachments,s.name]})),a({title:"ðŸ“Ž Fichier ajoutÃ©",description:`${s.name} a Ã©tÃ© ajoutÃ©.`}),e.target.value=""}};return s.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:s.jsxs(r.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-slate-800 border border-slate-700 rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-white",children:t?"Modifier le Dossier":"Nouveau Dossier"}),s.jsx(i,{variant:"ghost",size:"icon",onClick:g,className:"text-slate-400 hover:text-white",children:s.jsx(n,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:e=>{var s;e.preventDefault(),p({...f,honoraire:(s=f.honoraire,s?Number(String(s).replace(/[^0-9]/g,"")):0)})},className:"space-y-6",children:[t&&t.id_dossier&&s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[s.jsx(o,{className:"w-4 h-4 inline mr-2"}),"Id dossier"]}),s.jsx("input",{type:"text",value:t.id_dossier,disabled:!0,className:"w-full px-4 py-3 bg-slate-700/30 border border-slate-600 rounded-lg text-slate-400 cursor-not-allowed"}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Identifiant numÃ©rique gÃ©nÃ©rÃ© automatiquement (lecture seule)"})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[s.jsx(o,{className:"w-4 h-4 inline mr-2"}),"RÃ©f dossier *"]}),s.jsx("input",{type:"text",name:"code_dossier",value:f.code_dossier,onChange:C,required:!0,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Ex: REF-2025-001"}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"RÃ©fÃ©rence du dossier (saisie manuelle)"})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[s.jsx(o,{className:"w-4 h-4 inline mr-2"}),"Type de dossier *"]}),s.jsxs("select",{name:"case_type",value:f.case_type,onChange:C,required:!0,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[s.jsx("option",{value:"",children:"SÃ©lectionner un type..."}),s.jsx("option",{value:"Litige contractuel",children:"Litige contractuel"}),s.jsx("option",{value:"Planification successorale",children:"Planification successorale"}),s.jsx("option",{value:"Droit des sociÃ©tÃ©s",children:"Droit des sociÃ©tÃ©s"}),s.jsx("option",{value:"Droit Civil",children:"Droit Civil"}),s.jsx("option",{value:"Droit Commercial",children:"Droit Commercial"}),s.jsx("option",{value:"Droit PÃ©nal",children:"Droit PÃ©nal"}),s.jsx("option",{value:"Droit de la Famille",children:"Droit de la Famille"}),s.jsx("option",{value:"Droit du Travail",children:"Droit du Travail"}),s.jsx("option",{value:"Droit Immobilier",children:"Droit Immobilier"}),s.jsx("option",{value:"PropriÃ©tÃ© Intellectuelle",children:"PropriÃ©tÃ© Intellectuelle"}),s.jsx("option",{value:"Droit Administratif",children:"Droit Administratif"})]})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"client-id",className:"block text-sm font-medium text-slate-300 mb-2",children:[s.jsx(c,{className:"w-4 h-4 inline mr-2"}),"Client *"]}),s.jsxs("select",{id:"client-id",name:"client_id",value:f.client_id,onChange:C,required:!0,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[s.jsx("option",{value:"",children:"SÃ©lectionner un client..."}),y.map(e=>s.jsxs("option",{value:e.id,children:[e.client_code?`${e.client_code} - `:"",e.name]},e.id))]}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"SÃ©lectionnez le client associÃ© Ã  ce dossier"})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[s.jsx(d,{className:"w-4 h-4 inline mr-2"}),"QualitÃ© du client *"]}),s.jsxs("div",{className:"flex gap-4",children:[s.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[s.jsx("input",{type:"radio",name:"qualite_du_client",value:"personne_physique",checked:"personne_physique"===f.qualite_du_client,onChange:C,className:"w-4 h-4 text-indigo-600 focus:ring-indigo-500"}),s.jsx("span",{className:"text-slate-300",children:"Personne physique"})]}),s.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[s.jsx("input",{type:"radio",name:"qualite_du_client",value:"personne_morale",checked:"personne_morale"===f.qualite_du_client,onChange:C,className:"w-4 h-4 text-indigo-600 focus:ring-indigo-500"}),s.jsx("span",{className:"text-slate-300",children:"Personne morale"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Type de diligence"}),s.jsxs("select",{name:"type_de_diligence",value:f.type_de_diligence,onChange:C,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[s.jsx("option",{value:"",children:"SÃ©lectionner un type..."}),s.jsx("option",{value:"Consultation",children:"Consultation"}),s.jsx("option",{value:"Contentieux",children:"Contentieux"}),s.jsx("option",{value:"Conseil",children:"Conseil"}),s.jsx("option",{value:"RÃ©daction",children:"RÃ©daction d'actes"}),s.jsx("option",{value:"ReprÃ©sentation",children:"ReprÃ©sentation"}),s.jsx("option",{value:"MÃ©diation",children:"MÃ©diation"}),s.jsx("option",{value:"Arbitrage",children:"Arbitrage"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Objet du dossier"}),s.jsx("input",{type:"text",name:"objet_du_dossier",value:f.objet_du_dossier,onChange:C,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Ex: Litige commercial relatif Ã  un contrat de prestation"}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Objet juridique du dossier (diffÃ©rent de la description)"})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[s.jsx(o,{className:"w-4 h-4 inline mr-2"}),"Titre du dossier *"]}),s.jsx("input",{type:"text",name:"title",value:f.title,onChange:C,required:!0,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Ex: Affaire Martin vs. SociÃ©tÃ© ABC"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Description"}),s.jsx("textarea",{name:"description",value:f.description,onChange:C,rows:3,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Description dÃ©taillÃ©e de l'affaire..."})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[s.jsx(c,{className:"w-4 h-4 inline mr-2"}),"AssignÃ© Ã "]}),s.jsxs("select",{name:"assigned_to",value:f.assigned_to,onChange:C,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[s.jsx("option",{value:"",children:"SÃ©lectionner un collaborateur..."}),v.map(e=>s.jsx("option",{value:e.name,children:e.name},e.id))]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[s.jsx(u,{className:"w-4 h-4 inline mr-2"}),"Partie adverse"]}),s.jsx("input",{type:"text",name:"opposing_party",value:f.opposing_party,onChange:C,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Nom de la partie adverse"})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[s.jsx(m,{className:"w-4 h-4 inline mr-2"}),"Prochaine audience"]}),s.jsx("input",{type:"date",name:"next_hearing",value:f.next_hearing,onChange:C,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Statut"}),s.jsxs("select",{name:"status",value:f.status,onChange:C,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[s.jsx("option",{value:"en-cours",children:"En cours"}),s.jsx("option",{value:"juge-acheve",children:"JugÃ©/achevÃ©"}),s.jsx("option",{value:"cloture",children:"ClÃ´turÃ©"}),s.jsx("option",{value:"archive",children:"ArchivÃ© - En attente"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"PrioritÃ©"}),s.jsxs("select",{name:"priority",value:f.priority,onChange:C,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[s.jsx("option",{value:"low",children:"ðŸŸ¢ Faible"}),s.jsx("option",{value:"medium",children:"ðŸŸ¡ Moyenne"}),s.jsx("option",{value:"high",children:"ðŸŸ  Ã‰levÃ©e"}),s.jsx("option",{value:"urgent",children:"ðŸ”´ Urgente"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Honoraire"}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"text",name:"honoraire",value:f.honoraire,onChange:C,className:"w-full pl-4 pr-16 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Ex: 5 000 000"}),s.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-slate-400",children:"FCFA"})]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[s.jsx(x,{className:"w-4 h-4 inline mr-2"}),"AutorisÃ© Ã "]}),s.jsx("div",{className:"max-h-40 overflow-y-auto space-y-2 p-3 bg-slate-700/30 rounded-lg border border-slate-600",children:v.map(e=>s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",id:`authorized-${e.id}`,checked:f.visible_to.includes(e.id),onChange:()=>{return s=e.id,void j(e=>{const t=e.visible_to.includes(s)?e.visible_to.filter(e=>e!==s):[...e.visible_to,s];return{...e,visible_to:t}});var s},className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),s.jsx("label",{htmlFor:`authorized-${e.id}`,className:"ml-3 block text-sm text-slate-300",children:e.name})]},e.id))}),s.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"ðŸ”’ Seuls les utilisateurs sÃ©lectionnÃ©s et les administrateurs peuvent consulter le contenu complet."})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[s.jsx(h,{className:"w-4 h-4 inline mr-2"}),"PiÃ¨ces jointes"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[s.jsxs("label",{htmlFor:"file-internal-case",className:"cursor-pointer bg-blue-600 hover:bg-blue-700 border border-blue-500 rounded-lg px-4 py-3 text-white font-medium flex items-center justify-center gap-2 transition-colors",children:[s.jsx(o,{className:"w-4 h-4"}),"Choisir des fichiers"]}),s.jsx("input",{id:"file-internal-case",type:"file",className:"sr-only",onChange:k,multiple:!0}),s.jsxs("label",{htmlFor:"file-external-case",className:"cursor-pointer bg-green-600 hover:bg-green-700 border border-green-500 rounded-lg px-4 py-3 text-white font-medium flex items-center justify-center gap-2 transition-colors",children:[s.jsx(h,{className:"w-4 h-4"}),"Importer fichier"]}),s.jsx("input",{id:"file-external-case",type:"file",className:"sr-only",onChange:k,multiple:!0})]}),s.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:["ðŸ“ ",s.jsx("strong",{children:"Choisir"})," : sÃ©lection depuis l'application | ðŸ“Ž ",s.jsx("strong",{children:"Importer"})," : depuis l'ordinateur"]}),s.jsx("div",{className:"mt-3 space-y-2",children:f.attachments.map((e,t)=>s.jsxs("div",{className:"text-sm text-slate-300 bg-slate-700/30 p-2 rounded-md flex items-center gap-2",children:[s.jsx(o,{className:"w-4 h-4 text-blue-400"}),e]},t))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Notes"}),s.jsx("textarea",{name:"notes",value:f.notes,onChange:C,rows:3,className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Notes additionnelles..."})]}),s.jsxs("div",{className:"flex gap-4 pt-6",children:[s.jsx(i,{type:"submit",className:"flex-1 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700",children:t?"Mettre Ã  jour":"CrÃ©er le dossier"}),s.jsx(i,{type:"button",variant:"outline",onClick:g,className:"flex-1 border-slate-600 text-slate-300 hover:bg-slate-700",children:"Annuler"})]})]})]})})},C=({case:e,clients:t=[],index:l,onEdit:a,onDelete:n})=>{const c=t.find(s=>s.id===e.client_id),d=c?N(c):"Non assignÃ©",u=e=>e?new Date(e).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A",m=(e=>{switch(e){case"en-cours":default:return{label:"Actif",color:"bg-blue-500 text-white"};case"juge-acheve":case"cloture":return{label:"ClÃ´turÃ©",color:"bg-green-500 text-white"};case"archive":return{label:"En attente",color:"bg-yellow-500 text-white"}}})(e.status),x=(e=>{switch(e){case"urgent":case"high":return{label:"PRIORITÃ‰ HAUTE",color:"text-red-500"};case"medium":default:return{label:"PRIORITÃ‰ MOYENNE",color:"text-yellow-500"};case"low":return{label:"PRIORITÃ‰ BASSE",color:"text-green-500"}}})(e.priority);return s.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*l},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-lg p-6 hover:border-slate-600/50 transition-all duration-200",children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("h3",{className:"text-lg font-semibold text-white",children:e.title||"N/A"}),s.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-md text-xs font-medium ${m.color}`,children:[s.jsx(o,{className:"w-3 h-3"}),m.label]})]}),s.jsx("span",{className:`text-xs font-bold ${x.color}`,children:x.label})]}),s.jsx("div",{className:"mb-4",children:s.jsxs("p",{className:"text-sm text-slate-300",children:[s.jsx("span",{className:"font-medium text-slate-400",children:"ID du dossier:"})," ",e.code_dossier||"Non dÃ©fini",s.jsx("span",{className:"mx-3",children:"â€¢"}),s.jsx("span",{className:"font-medium text-slate-400",children:"RÃ©f dossier:"})," ",e.ref_dossier||"Non dÃ©fini"]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Type de dossier"}),s.jsx("p",{className:"text-sm text-slate-200 font-medium",children:e.case_type||"Non dÃ©fini"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Client"}),s.jsx("p",{className:"text-sm text-slate-200 font-medium",children:d})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"AssignÃ© Ã "}),s.jsx("p",{className:"text-sm text-slate-200 font-medium",children:e.assigned_to||"Non assignÃ©"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Date de dÃ©but"}),s.jsx("p",{className:"text-sm text-slate-200 font-medium",children:u(e.created_at)})]})]}),s.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-700/50",children:[s.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-300",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(o,{className:"w-4 h-4"}),s.jsxs("span",{children:[e.attachments?.length||0," documents"]})]}),e.next_hearing&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(p,{className:"w-4 h-4"}),s.jsxs("span",{children:["Prochaine audience: ",u(e.next_hearing)]})]})]}),s.jsx(i,{onClick:()=>a(e),className:"bg-slate-700 border border-slate-600 text-slate-200 hover:bg-slate-600 px-4 py-2 rounded-md text-sm font-medium",children:"Voir dÃ©tails"})]})]})},k=({currentUser:t})=>{const[n,c]=e.useState([]),[d,u]=e.useState([]),[m,x]=e.useState(!1),[h,N]=e.useState(null),[_,k]=e.useState(""),[D,E]=e.useState("all"),[S,q]=e.useState({open:!1,title:"",message:"",onConfirm:null}),A=t&&("Gerant"===t.function||"Associe Emerite"===t.function)||t.role&&"admin"===t.role.toLowerCase();e.useEffect(()=>{P(),I()},[]);const I=async()=>{const{data:e,error:s}=await l.from("clients").select("id, name, type, first_name, last_name, company");s||u(e||[])},P=async()=>{const{data:e,error:s}=await l.from("cases").select("*").order("created_at",{ascending:!1});if(s)a({variant:"destructive",title:"Erreur",description:"Impossible de charger les dossiers."});else if(A)c(e);else{const s=e.filter(e=>e.created_by&&e.created_by===t.id||e.visible_to&&e.visible_to.includes(t.id));c(s)}},R=n.filter(e=>{const s=e.title?.toLowerCase().includes(_.toLowerCase())||e.description?.toLowerCase().includes(_.toLowerCase())||e.id?.toLowerCase().includes(_.toLowerCase()),t="all"===D||e.status===D;return s&&t}),F={all:n.length,"en-cours":n.filter(e=>"en-cours"===e.status).length,"juge-acheve":n.filter(e=>"juge-acheve"===e.status).length,cloture:n.filter(e=>"cloture"===e.status).length,archive:n.filter(e=>"archive"===e.status).length};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Gestion des Dossiers"}),s.jsx("p",{className:"text-slate-400",children:"Suivez et gÃ©rez vos affaires juridiques"})]}),s.jsxs(i,{onClick:()=>{N(null),x(!0)},className:"bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700",children:[s.jsx(g,{className:"w-4 h-4 mr-2"}),"Nouveau Dossier"]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[{key:"all",label:"Total",icon:o},{key:"en-cours",label:"En cours",icon:b},{key:"juge-acheve",label:"JugÃ©/AchevÃ©",icon:f},{key:"cloture",label:"ClÃ´turÃ©",icon:p},{key:"archive",label:"ArchivÃ©",icon:j}].map(e=>{const t=e.icon;return s.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-slate-400 text-sm",children:e.label}),s.jsx("p",{className:"text-2xl font-bold text-white",children:F[e.key]||0})]}),s.jsx(t,{className:"w-6 h-6 text-slate-400"})]})},e.key)})}),s.jsx("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6",children:s.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"relative",children:[s.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),s.jsx("input",{type:"text",placeholder:"Rechercher un dossier par ID, titre...",value:_,onChange:e=>k(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})}),s.jsx("div",{children:s.jsxs("select",{value:D,onChange:e=>E(e.target.value),className:"px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[s.jsx("option",{value:"all",children:"Tous les statuts"}),s.jsx("option",{value:"en-cours",children:"En cours"}),s.jsx("option",{value:"juge-acheve",children:"JugÃ©/achevÃ©"}),s.jsx("option",{value:"cloture",children:"ClÃ´turÃ©"}),s.jsx("option",{value:"archive",children:"ArchivÃ© - En attente"})]})})]})}),s.jsx("div",{className:"space-y-4",children:R.map((e,t)=>s.jsx(C,{case:e,clients:d,index:t,onEdit:e=>{N(e),x(!0)},onDelete:e=>{const s=n.find(s=>s.id===e);q({open:!0,title:"Supprimer le dossier",message:`Voulez-vous vraiment supprimer le dossier "${s?.title}" ?\n\nCette action est irrÃ©versible.`,onConfirm:()=>{(async e=>{const{error:s}=await l.from("cases").delete().eq("id",e);s?a({variant:"destructive",title:"Erreur de suppression",description:s.message}):(c(n.filter(s=>s.id!==e)),a({title:"ðŸ—‘ï¸ Dossier supprimÃ©",description:"Le dossier a Ã©tÃ© supprimÃ© avec succÃ¨s."}))})(e),q({...S,open:!1})}})}},e.id))}),0===R.length&&s.jsxs(r.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12",children:[s.jsx(o,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-slate-400 mb-2",children:"Aucun dossier trouvÃ©"}),s.jsx("p",{className:"text-slate-500",children:_||"all"!==D?"Essayez de modifier vos filtres de recherche":"Commencez par crÃ©er votre premier dossier"})]}),m&&s.jsx(w,{case:h,onSubmit:h?async e=>{const s={};["title","case_type","client_id","opposing_party","assigned_to","next_hearing","description","status","priority","honoraire","notes","attachments","visible_to"].forEach(t=>{void 0!==e[t]&&(s[t]=e[t])});for(const l in s)"number"==typeof s[l]&&Number.isNaN(s[l])&&(s[l]=0),"next_hearing"!==l||""!==s[l]&&null!==s[l]&&void 0!==s[l]||delete s[l];const{data:t,error:i}=await l.from("cases").update(s).eq("id",h.id).select();i?a({variant:"destructive",title:"Erreur",description:"Impossible de modifier le dossier. VÃ©rifiez les champs et rÃ©essayez."}):(c(n.map(e=>e.id===h.id?t[0]:e)),N(null),x(!1),a({title:"âœ… Dossier modifiÃ©",description:"Le dossier a Ã©tÃ© mis Ã  jour avec succÃ¨s."}))}:async e=>{const s={};["title","case_type","client_id","opposing_party","assigned_to","next_hearing","description","status","priority","honoraire","notes","attachments","visible_to","created_by"].forEach(t=>{void 0!==e[t]&&(s[t]=e[t])}),s.created_by=t?.id;for(const t in s)"number"==typeof s[t]&&Number.isNaN(s[t])&&(s[t]=0),"next_hearing"!==t||""!==s[t]&&null!==s[t]&&void 0!==s[t]||delete s[t];const{data:i,error:r}=await l.from("cases").insert([s]).select();r?a({variant:"destructive",title:"Erreur",description:"Impossible d'ajouter le dossier. VÃ©rifiez les champs et rÃ©essayez."}):(c([i[0],...n]),x(!1),a({title:"âœ… Dossier crÃ©Ã©",description:`Le dossier ${i[0].id} a Ã©tÃ© crÃ©Ã© avec succÃ¨s.`}))},onCancel:()=>{x(!1),N(null)},currentUser:t}),s.jsx(y,{open:S.open,onOpenChange:e=>q({...S,open:e}),title:S.title,message:S.message,onConfirm:S.onConfirm})]})};k.propTypes={currentUser:t.shape({id:t.string,name:t.string,email:t.string,role:t.string,function:t.string})};export{k as default};
