import{r as e}from"./vendor-react-CWhE6-Gf.js";import{l as i,s as t}from"./index-BzUzpWLW.js";const s={admin:{dashboard:{visible:!0,actions:{}},tasks:{visible:!0,actions:{create:!0,edit:!0,delete:!0,reassign:!0}},clients:{visible:!0,actions:{create:!0,edit:!0,delete:!0}},cases:{visible:!0,actions:{create:!0,edit:!0,delete:!0}},calendar:{visible:!0,actions:{create:!0,edit:!0,delete:!0}},documents:{visible:!0,actions:{upload:!0,delete:!0}},billing:{visible:!0,actions:{create:!0,edit:!0,delete:!0}},team:{visible:!0,actions:{create:!0,edit:!0,delete:!0}},reports:{visible:!0,actions:{}},settings:{visible:!0,actions:{}}},gerant:{dashboard:{visible:!0,actions:{}},tasks:{visible:!0,actions:{create:!0,edit:!0,delete:!0,reassign:!0}},clients:{visible:!0,actions:{create:!0,edit:!0,delete:!0}},cases:{visible:!0,actions:{create:!0,edit:!0,delete:!0}},calendar:{visible:!0,actions:{create:!0,edit:!0,delete:!0}},documents:{visible:!0,actions:{upload:!0,delete:!0}},billing:{visible:!0,actions:{create:!0,edit:!0,delete:!0}},team:{visible:!0,actions:{create:!0,edit:!0,delete:!0}},reports:{visible:!0,actions:{}},settings:{visible:!0,actions:{}}},avocat:{dashboard:{visible:!0,actions:{}},tasks:{visible:!0,actions:{create:!0,edit:!0,delete:!1,reassign:!1}},clients:{visible:!0,actions:{create:!0,edit:!0,delete:!1}},cases:{visible:!0,actions:{create:!0,edit:!0,delete:!1}},calendar:{visible:!0,actions:{create:!0,edit:!0,delete:!1}},documents:{visible:!0,actions:{upload:!0,delete:!1}},billing:{visible:!0,actions:{create:!0,edit:!0,delete:!1}},team:{visible:!1,actions:{create:!1,edit:!1,delete:!1}},reports:{visible:!0,actions:{}},settings:{visible:!1,actions:{}}},secretaire:{dashboard:{visible:!0,actions:{}},tasks:{visible:!0,actions:{create:!0,edit:!1,delete:!1,reassign:!1}},clients:{visible:!0,actions:{create:!0,edit:!0,delete:!1}},cases:{visible:!0,actions:{create:!1,edit:!0,delete:!1}},calendar:{visible:!0,actions:{create:!0,edit:!0,delete:!1}},documents:{visible:!0,actions:{upload:!0,delete:!1}},billing:{visible:!0,actions:{create:!0,edit:!0,delete:!1}},team:{visible:!1,actions:{create:!1,edit:!1,delete:!1}},reports:{visible:!0,actions:{}},settings:{visible:!1,actions:{}}},user:{dashboard:{visible:!0,actions:{}},tasks:{visible:!0,actions:{create:!1,edit:!1,delete:!1,reassign:!1}},clients:{visible:!1,actions:{create:!1,edit:!1,delete:!1}},cases:{visible:!1,actions:{create:!1,edit:!1,delete:!1}},calendar:{visible:!0,actions:{create:!1,edit:!1,delete:!1}},documents:{visible:!1,actions:{upload:!1,delete:!1}},billing:{visible:!1,actions:{create:!1,edit:!1,delete:!1}},team:{visible:!1,actions:{create:!1,edit:!1,delete:!1}},reports:{visible:!1,actions:{}},settings:{visible:!1,actions:{}}}},a=()=>{const{toast:a}=i(),[r,c]=e.useState([]),[n,l]=e.useState(!1),o=async()=>{l(!0);try{const{data:e,error:i}=await t.from("profiles").select("id, email, name, role, function, created_at").order("name");if(i)return void a({variant:"destructive",title:"Erreur",description:"Impossible de charger les utilisateurs."});c(e||[])}catch(e){a({variant:"destructive",title:"Erreur",description:"Une erreur inattendue est survenue."})}finally{l(!1)}},d=async(e,i,s=null,r=null)=>{try{const{error:c}=await t.from("user_permissions").upsert({user_id:e,permissions:i},{onConflict:"user_id"});if(c)throw c;if(s||r){const i={};s&&(i.role=s),r&&(i.function=r);const{error:a}=await t.from("profiles").update(i).eq("id",e);if(a)throw a}return a({title:"✅ Permissions sauvegardées",description:"Les permissions ont été mises à jour avec succès."}),await o(),{success:!0}}catch(c){return a({variant:"destructive",title:"Erreur de sauvegarde",description:`Impossible de sauvegarder: ${c.message}`}),{success:!1,error:c}}},u=e=>s[e]||s.user;return{users:r,loading:n,fetchUsers:o,getUserPermissions:async e=>{try{const{data:i,error:s}=await t.from("user_permissions").select("permissions").eq("user_id",e).maybeSingle();return s?null:i?.permissions||null}catch(i){return null}},saveUserPermissions:d,createUser:async e=>{try{const{data:i,error:s}=await t.from("profiles").insert([{email:e.email,name:e.name,role:e.role||"user",function:e.function||null}]).select().single();if(s)throw s;const r=u(e.role||"user");return await d(i.id,r),a({title:"✅ Utilisateur créé",description:`L'utilisateur ${e.name} a été créé avec succès.`}),{success:!0,user:i}}catch(i){return a({variant:"destructive",title:"Erreur de création",description:`Impossible de créer l'utilisateur: ${i.message}`}),{success:!1,error:i}}},applyDefaultPermissions:u}},r=(e,i,t=null)=>{if(!e||!e[i])return!1;const s=e[i];return!!s.visible&&(!t||!s.actions||!0===s.actions[t])},c=e=>e&&("Gerant"===e.function||"Associe Emerite"===e.function||"admin"===e.role||"gerant"===e.role);export{s as d,r as h,c as i,a as u};
